## ë¡œê·¸ì¸ ì²˜ë¦¬í•˜ê¸° - ì„œë¸”ë¦¿ HTTP ì„¸ì…˜
ì„œë¸”ë¦¿ì€ ì„¸ì…˜ì„ ìœ„í•´ `HttpSession`ì´ë¼ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

### HttpSession ì†Œê°œ
- ì„œë¸”ë¦¿ì´ ì„¸ì…˜ì„ ìœ„í•´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥
- ì„œë¸”ë¦¿ì„ í†µí•´ `HttpSession`ì„ ìƒì„±í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¿ í‚¤ë¥¼ ìƒì„±í•œë‹¤. ì¿ í‚¤ ì´ë¦„ì´ `JSESSIONID`ì´ê³ , ê°’ì€ ì¶”ì • ë¶ˆê°€ëŠ¥í•œ ëœëŸ¼ ê°’ì´ë‹¤.
    ```text
    Cookie: JSESSIONID=5B78E23B513F50164D6FDD8C97B0AD05
    ```
  
### ì„œë¸”ë¦¿ì´ ì œê³µí•˜ëŠ” `HttpSession` ì‚¬ìš©í•˜ê¸°
#### `SessionConst.java` ìƒì„±
```java
public class SessionConst {
    public static final String LOGIN_MEMBER = "loginMember";
}
```
`HttpSession`ì— ë°ì´í„°ë¥¼ ë³´ê´€í•˜ê³  ì¡°íšŒí•  ë•Œ, ê°™ì€ ì´ë¦„ì´ ì¤‘ë³µë˜ì–´ ì‚¬ìš©ë˜ë¯€ë¡œ, ìƒìˆ˜ë¥¼ í•˜ë‚˜ ì •ì˜í•œ ê²ƒì´ë‹¤.

#### `LoginService.java` ìƒì„±
```java
@Service
@RequiredArgsConstructor
public class LoginService {
    
    private final MemberRepository memberRepository;

    /**
     * @return null: ë¡œê·¸ì¸ ì‹¤íŒ¨
     */
    public Member login(String loginId, String password) {
        return memberRepository.findByLoginId(loginId)
                .filter(m -> m.getPassword().equals(password))
                .orElse(null);
    }
}
```
#### `LoginController.java` ìƒì„±
```java
@Slf4j
@Controller
@RequiredArgsConstructor
public class LoginController {

    private final LoginService loginService;

    @GetMapping("/login")
    public String loginForm(@ModelAttribute("loginForm") LoginForm form) {
        return "login/loginForm";
    }

    @PostMapping("/login")
    public String login(@Valid @ModelAttribute LoginForm form, BindingResult bindingResult, HttpServletRequest request) {
        if (bindingResult.hasErrors()) {
            return "login/loginForm";
        }

        Member loginMember = loginService.login(form.getLoginId(), form.getPassword());

        if (loginMember == null) {
            bindingResult.reject("loginFail", "ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            return "login/loginForm";
        }

        //ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬
        //ì„¸ì…˜ì´ ìˆìœ¼ë©´ ìˆëŠ” ì„¸ì…˜ ë°˜í™˜, ì—†ìœ¼ë©´ ì‹ ê·œ ì„¸ì…˜ì„ ìƒì„±
        HttpSession session = request.getSession();
        
        //ì„¸ì…˜ì— ë¡œê·¸ì¸ íšŒì› ì •ë³´ ë³´ê´€
        session.setAttribute(SessionConst.LOGIN_MEMBER, loginMember);

        return "redirect:/";
    }
}
```

#### ì„¸ì…˜ ìƒì„±ê³¼ ì¡°íšŒ
ì„¸ì…˜ì„ ìƒì„±í•˜ë ¤ë©´ `request.getSession(true)`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.  
```java
public HttpSession getSession(boolean create);
```

##### ì„¸ì…˜ì˜ `create` ì˜µì…˜
- `request.getSession(true)`
  - ì„¸ì…˜ì´ ìˆìœ¼ë©´ ê¸°ì¡´ ì„¸ì…˜ì„ ë°˜í™˜í•œë‹¤.
  - ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ìƒˆë¡œìš´ ì„¸ì…˜ì„ ìƒì„±í•´ì„œ ë°˜í™˜í•œë‹¤.
- `request.getSession(false)`
  - ì„¸ì…˜ì´ ìˆìœ¼ë©´ ê¸°ì¡´ ì„¸ì…˜ì„ ë°˜í™˜í•œë‹¤.
  - ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ìƒˆë¡œìš´ ì„¸ì…˜ì„ ìƒì„±í•˜ì§€ ì•ŠëŠ”ë‹¤. `null`ì„ ë°˜í™˜í•œë‹¤.
- `request.getSession()`
  - ì‹ ê·œ ì„¸ì…˜ì„ ìƒì„±í•˜ëŠ” `request.getSession(true)`ì™€ ë™ì¼í•˜ë‹¤.
- 

##### ì„¸ì…˜ì— ë¡œê·¸ì¸ íšŒì› ì •ë³´ ë³´ê´€
```java
session.setAttribute(SessionConst.LOGIN_MEMEBER, loginMember);
```
ì„¸ì…˜ì— ë°ì´í„°ë¥¼ ë³´ê´€í•˜ëŠ” ë°©ë²•ì€ `request.setAttribute(...)`ì™€ ë¹„ìŠ·í•˜ë‹¤. í•˜ë‚˜ì˜ ì„¸ì…˜ì— ì—¬ëŸ¬ ê°’ì„ ì €ì¥í•  ìˆ˜ ìˆë‹¤.

#### ë¡œê·¸ì•„ì›ƒ - LoginController.javaì— logout() ìƒì„±
```java
@PostMapping("/logout")
public String logoutV3(HttpServletRequest request) {
    // ì„¸ì…˜ì„ ì‚­ì œí•œë‹¤.
    HttpSession session = request.getSession(false);

    if (session != null) {
        session.invalidate();
    }

    return "redirect:/";
}
```
`session.invalidate()`: ì„¸ì…˜ì„ ì œê±°í•œë‹¤.

#### HomeController.java ìƒì„±
```java
@Slf4j
@Controller
@RequiredArgsConstructor
public class HomeController {

  @GetMapping("/")
  public String home(HttpServletRequest request, Model model) {
    HttpSession session = request.getSession(false);

    // ì„¸ì…˜ì´ ì—†ìœ¼ë©´ home
    if (session == null) {
      return "home";
    }

    Member loginMember = (Member) session.getAttribute(SessionConst.LOGIN_MEMBER);
    // ì„¸ì…˜ì— íšŒì› ë°ì´í„°ê°€ ì—†ìœ¼ë©´ home
    if (loginMember == null) {
      return "home";
    }

    // ì„¸ì…˜ì´ ìœ ì§€ë˜ë©´ ë¡œê·¸ì¸ìœ¼ë¡œ ì´ë™
    model.addAttribute("member", loginMember);
    return "loginHome";
  }
}
```
- `request.getSession(false)`: `request.getSession()`ë¥¼ ì‚¬ìš©í•˜ë©´ ê¸°ë³¸ ê°’ì´ `create: true`ì´ë¯€ë¡œ, 
ë¡œê·¸ì¸í•˜ì§€ ì•Šì„ ì‚¬ìš©ìë„ ì˜ë¯¸ì—†ëŠ” ì„¸ì…˜ì´ ë§Œë“¤ì–´ì§„ë‹¤. ë”°ë¼ì„œ ì„¸ì…˜ì„ ì°¾ì•„ì„œ ì‚¬ìš©í•˜ëŠ” ì‹œì ì—ëŠ” `create:false`ì˜µì…˜ì„ ì‚¬ìš©í•´ì„œ ì„¸ì…˜ì„ ìƒì„±í•˜ì§€ ì•Šì•„ì•¼ í•œë‹¤.
- `session.getAttribute(SessionConst.LOGIN_MEMBER)`: ë¡œê·¸ì¸ ì‹œì ì— ì„¸ì…˜ì— ë³´ê´€í•œ íšŒì› ê°ì²´ë¥¼ ì°¾ëŠ”ë‹¤.

#### ì‹¤í–‰
`JSESSIONID` ì¿ í‚¤ê°€ ìƒì„±ëœë‹¤.

### @SessionAttribute
ìŠ¤í”„ë§ì€ ì„¸ì…˜ì„ ë” í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ `@SessionAttribute`ë¥¼ ì§€ì›í•œë‹¤.  
ì´ë¯¸ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìë¥¼ ì°¾ì„ ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ì°¸ê³ ë¡œ ì´ ê¸°ëŠ¥ì€ ì„¸ì…˜ì„ ìƒì„±í•˜ì§€ ì•ŠëŠ”ë‹¤.
`@SessionAttribute(name = "loginMember", required = false) Member loginMember`

### HomeController.java - home() ìˆ˜ì •
```java
@GetMapping("/")
public String home(@SessionAttribute(name = SessionConst.LOGIN_MEMBER, required = false) Member loginMember, Model model) {
    // ì„¸ì…˜ì— íšŒì› ë°ì´í„°ê°€ ì—†ìœ¼ë©´ home
    if (loginMember == null) {
        return "home";
    }

    // ì„¸ì…˜ì´ ìœ ì§€ë˜ë©´ ë¡œê·¸ì¸ìœ¼ë¡œ ì´ë™
    model.addAttribute("member", loginMember);
    return "loginHome";
}
```
ì„¸ì…˜ì„ ì°¾ê³ , ì„¸ì…˜ì— ë“¤ì–´ìˆëŠ” ë°ì´í„°ë¥¼ ì°¾ëŠ” ë²ˆê±°ë¡œìš´ ê³¼ì •ì„ ìŠ¤í”„ë§ì´ í•œ ë²ˆì— í¸ë¦¬í•˜ê²Œ ì²˜ë¦¬í•´ì¤€ë‹¤.

### TrackingModes
ë¡œê·¸ì¸ì„ ì²˜ìŒ ì‹œë„í•˜ë©´ URLì´ ë‹¤ìŒê³¼ ê°™ì´ `jsessionid`ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```text
http://localhost:8080/;jsessionid=B507F38494A29FDA213CA0A265B20661
```
ì´ê²ƒì€ ì›¹ ë¸Œë¼ìš°ì €ê°€ ì¿ í‚¤ë¥¼ ì§€ì›í•˜ì§€ ì•Šì„ ë•Œ ì¿ í‚¤ ëŒ€ì‹  URLì„ í†µí•´ì„œ ì„¸ì…˜ì„ ìœ ì§€í•˜ëŠ” ë°©ë²•ì´ë‹¤.
ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ë ¤ë©´ URLì— ì´ ê°’ì„ ê³„ì† í¬í•¨í•´ì„œ ì „ë‹¬í•´ì•¼ í•œë‹¤. íƒ€ì„ë¦¬í”„ ê°™ì€ ì—”ì§„ì„ í†µí•´ì„œ ë§í¬ë¥¼ ê±¸ë©´ `jsessionid`ë¥¼ URLì— ìë™ìœ¼ë¡œ í¬í•¨í•´ì¤€ë‹¤.
ì„œë²„ ì…ì¥ì—ì„œ ì›¹ ë¸Œë¼ìš°ì €ê°€ ì¿ í‚¤ë¥¼ ì§€ì›í•˜ëŠ”ì§€ í•˜ì§€ ì•ŠëŠ” ì§€ ìµœì´ˆì—ëŠ” íŒë‹¨í•˜ì§€ ëª»í•˜ë¯€ë¡œ, ì¿ í‚¤ ê°’ë„ ì „ë‹¬í•˜ê³ , URLì— `jsessionid`ë„ í•¨ê»˜ ì „ë‹¬í•œë‹¤.  
URL ì „ë‹¬ ë°©ì‹ì„ ë„ê³  í•­ìƒ ì¿ í‚¤ë¥¼ í†µí•´ì„œë§Œ ì„¸ì…˜ì„ ìœ ì§€í•˜ê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒ ì˜µì…˜ì„ ë„£ì–´ì£¼ë©´ ëœë‹¤. ì´ë ‡ê²Œí•˜ë©´ URLì— `jsessionid`ê°€ ë…¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.
```text
[application.properties]

server.servlet.session.tracking-modes=cookie
```

## ì„¸ì…˜ ì •ë³´ì™€ íƒ€ì„ì•„ì›ƒ ì„¤ì •
### ì„¸ì…˜ì´ ì œê³µí•˜ëŠ” ì •ë³´ë“¤ í™•ì¸í•˜ê¸° (`SessionInfoController.java` ìƒì„±)
```java
@Slf4j
@RestController
public class SessionInfoController {
    
    @GetMapping("/session-info")
    public String sessionInfo(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        if (session == null) {
            return "ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.";
        }

        //ì„¸ì…˜ ë°ì´í„° ì¶œë ¥
        session.getAttributeNames().asIterator().forEachRemaining(name -> log.info("session name={}, value={}", name, session.getAttribute(name)));

        log.info("sessionId={}", session.getId());
        log.info("getMaxInactiveInterval={}", session.getMaxInactiveInterval());
        log.info("creationTime={}", new Date(session.getCreationTime()));
        log.info("lastAccessedTime={}", new Date(session.getLastAccessedTime()));
        log.info("isNew={}", session.isNew());

        return "ì„¸ì…˜ ì¶œë ¥";
    }
}
```
- `sessionId`: ì„¸ì…˜Id, `JSESSIONID`ì˜ ê°’
- `maxInactiveInterval`: ì„¸ì…˜ì˜ ìœ íš¨ ì‹œê°„ (ì˜ˆ: 1800ì´ˆ, (30ë¶„))
- `creationTime`: ì„¸ì…˜ ìƒì„±ì¼ì‹œ
- `lastAccessedTime`: ì„¸ì…˜ê³¼ ì—°ê²°ëœ ì‚¬ìš©ìê°€ ìµœê·¼ì— ì„œë²„ì— ì ‘ê·¼í•œ ì‹œê°„, í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ `sessionId`(`JSESSIONID`)ë¥¼ ìš”ì²­í•œ ê²½ìš°ì— ê°±ì‹ ëœë‹¤.
- `isNew`: ìƒˆë¡œ ìƒì…©ëœ ì„¸ì…˜ì¸ì§€, ì•„ë‹ˆë©´ ì´ë¯¸ ê³¼ê±°ì— ë§Œë“¤ì–´ì¡Œê³ , í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ `sessionId`(`JSESSIONID`)ë¥¼ ìš”ì²­í•´ì„œ ì¡°íšŒëœ ì„¸ì…˜ì¸ì§€ ì—¬ë¶€

### ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ì„¤ì •
ì„¸ì…˜ì€ ì‚¬ìš©ìê°€ ë¡œê·¸ì•„ì›ƒì„ ì§ì ‘ í˜¸ì¶œí•´ì„œ `session.invalidate()`ê°€ í˜¸ì¶œë˜ëŠ” ê²½ìš°ì— ì‚­ì œëœë‹¤.
ê·¸ëŸ°ë° ëŒ€ë¶€ë¶„ì˜ ì‚¬ìš©ìëŠ” ë¡œê·¸ì•„ì›ƒì„ ì„ íƒí•˜ì§€ ì•Šê³ , ì›¹ ë¸Œë¼ìš°ì €ë¥¼ ì¢…ë£Œí•œë‹¤.
ë¬¸ì œëŠ” HTTPê°€ ë¹„ì—°ê²°ì„±(ConnectionLess)ì´ë¯€ë¡œ ì„œë²„ ì…ì¥ì—ì„œëŠ” í•´ë‹¹ ì‚¬ìš©ìê°€ ì›¹ ë¸Œë¼ìš°ì €ë¥¼ ì¢…ë£Œí•œ ê²ƒì¸ì§€ ì•„ë‹Œì§€ë¥¼ ì¸ì‹í•  ìˆ˜ ì—†ë‹¤.
ë”°ë¼ì„œ ì„œë²„ì—ì„œ ì„¸ì…˜ ë°ì´í„°ë¥¼ ì–¸ì œ ì‚­ì œí•´ì•¼ í•˜ëŠ”ì§€ íŒë‹¨í•˜ê¸° ì–´ë µë‹¤.
ì´ ê²½ìš° ë‚¨ì•„ìˆëŠ” ì„¸ì…˜ì„ ë¬´í•œì • ë³´ê´€í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
- ì„¸ì…˜ê³¼ ê´€ë ¨ëœ ì¿ í‚¤(`JSESSIONID`)ë¥¼ íƒˆì·¨ ë‹¹í–ˆì„ ê²½ìš° ì˜¤ëœ ì‹œê°„ì´ ì§€ë‚˜ë„ í•´ë‹¹ ì¿ í‚¤ë¡œ ì•…ì˜ì ì¸ ìš”ì²­ì„ í•  ìˆ˜ ìˆë‹¤.
- ì„¸ì…˜ì€ ê¸°ë³¸ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ì— ìƒì„±ëœë‹¤. ë©”ëª¨ë¦¬ì˜ í¬ê¸°ê°€ ë¬´í•œí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ê¼­ í•„ìš”í•œ ê²½ìš°ë§Œ ìƒì„±í•´ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

#### ì„¸ì…˜ì˜ ì¢…ë£Œ ì‹œì 
ì„¸ì…˜ì˜ ì¢…ë£Œ ì‹œì ì€ ì‚¬ìš©ìê°€ ì„œë²„ì— ìµœê·¼ì— ìš”ì²­í•œ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ 30ë¶„ ì •ë„ë¥¼ ìœ ì§€í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì‚¬ìš©ìê°€ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©´, ì„¸ì…˜ì˜ ìƒì¡´ ì‹œê°„ì´ 30ë¶„ìœ¼ë¡œ ê³„ì† ëŠ˜ì–´ë‚˜ê²Œ ëœë‹¤.
`HttpSession`ì€ ì´ ë°©ì‹ì„ ì‚¬ìš©í•œë‹¤.

#### ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ì„¤ì •
```text
[application.properties]

server.servlet.session.timeout=60
```
í•´ë‹¹ ë‚´ìš©ì€ 60ì´ˆë¡œ ì„¸íŒ…í•˜ëŠ” ê²ƒì´ê³ , ê¸°ë³¸ì€ 1800ì´ˆì´ë‹¤. (ê¸€ë¡œë²Œ ì„¤ì •ì€ ë¶„ ë‹¨ìœ„ë¡œ ì„¤ì •í•´ì•¼ í•œë‹¤.)
> ğŸ€ íŠ¹ì • ì„¸ì…˜ ë‹¨ìœ„ë¡œ ì‹œê°„ ì„¤ì •
> `session.setMaxInactiveInterval(1800);` // 1800ì´ˆ

#### ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ë°œìƒ
ì„¸ì…˜ì˜ íƒ€ì„ì•„ì›ƒ ì‹œê°„ì€ í•´ë‹¹ ì„¸ì…˜ê³¼ ê´€ë ¨ëœ `JSESSIONID`ë¥¼ ì „ë‹¬í•˜ëŠ” HTTP ìš”ì²­ì´ ìˆìœ¼ë©´ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ë‹¤ì‹œ ì´ˆê¸°í™”ëœë‹¤.
ì´ë ‡ê²Œ ì´ˆê¸°í™”ë˜ë©´ ì„¸ì…˜ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ì„¤ì •í•œ ì‹œê°„ë™ì•ˆ ì„¸ì…˜ì„ ì¶”ê°€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.  
`session.getLastAccessedTime()`: ìµœê·¼ ì„¸ì…˜ ì ‘ê·¼ ì‹œê°„  
`LastAccessedTime`ì´í›„ë¡œ timeoutì‹œê°„ì´ ì§€ë‚˜ë©´, WASê°€ ë‚´ë¶€ì—ì„œ í•´ë‹¹ ì„¸ì…˜ì„ ì œê±°í•œë‹¤.

## ì„œë¸”ë¦¿ í•„í„° - ì†Œê°œ
í˜„ì¬ ì½”ë“œëŠ”, ì‚¬ìš©ìì—ê²Œ ìƒí’ˆ ê´€ë¦¬ ë²„íŠ¼ì´ ë³´ì´ì§€ ì•Šê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ì—†ì–´ ë³´ì´ì§€ë§Œ, URL ì„ ì§ì ‘ í˜¸ì¶œí•˜ë©´ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤.  
ìƒí’ˆ ê´€ë¦¬ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” ë¡œì§ì„ í•˜ë‚˜í•˜ë‚˜ ì‘ì„±í•˜ë©´ ë˜ê² ì§€ë§Œ, ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ ì¡°ì§ì— ê³µí†µìœ¼ë¡œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ í™•ì¸í•´ì•¼ í•˜ê³ , í–¥í›„ ë¡œê·¸ì¸ê³¼ ê´€ë ¨ëœ ë¡œì§ì´ ë³€ê²½ë˜ë©´ ì‘ì„±í•œ ëª¨ë“  ë¡œì§ì„ ìˆ˜ì •í•´ì•¼ í•œë‹¤ëŠ” ë¬¸ì œì ì´ ìˆë‹¤.  
ì´ë ‡ê²Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì—¬ëŸ¬ ì¡°ì§ì—ì„œ ê³µí†µìœ¼ë¡œ ê´€ì‹¬ì´ ìˆëŠ” ê²ƒì„ ê³µí†µ ê´€ì‹¬ì‚¬(cross-cutting concern)ì´ë¼ê³  í•œë‹¤.
ì—¬ê¸°ì„œëŠ” ë“±ë¡, ìˆ˜ì •, ì‚­ì œ, ì¡°íšŒ ë“±ë“± ì—¬ëŸ¬ ë¡œì§ì—ì„œ ê³µí†µìœ¼ë¡œ ì¸ì¦ì— ëŒ€í•´ì„œ ê´€ì‹¬ì„ ê°€ì§€ê³  ìˆë‹¤.  
ì´ëŸ¬í•œ ê³µí†µ ê´€ì‹¬ì‚¬ëŠ” ìŠ¤í”„ë§ì˜ AOPë¡œë„ í•´ê²°í•  ìˆ˜ ìˆì§€ë§Œ, ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ëŠ” `ì„œë¸”ë¦¿ í•„í„°` í˜¹ì€ `ì„œë¸”ë¦¿ ì¸í„°ì…‰í„°`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ ì²˜ë¦¬í•  ë•ŒëŠ” HTTPì˜ í—¤ë”ë‚˜ URLì˜ ì •ë³´ë“¤ì´ í•„ìš”í•œë°, ì„œë¸”ë¦¿ í•„í„°ë‚˜ ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” `HttpServletRequest`ë¥¼ ì œê³µí•œë‹¤.

### ì„œë¸”ë¦¿ í•„í„°
í•„í„°ëŠ” ì„œë¸”ë¦¿ì´ ì§€ì›í•˜ëŠ” ìˆ˜ë¬¸ì¥ì´ë‹¤. í•„í„°ì˜ íŠ¹ì„±ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
#### í•„í„° íë¦„
```text
HTTP ìš”ì²­ > WAS > í•„í„° > ì„œë¸”ë¦¿ > ì»¨íŠ¸ë¡¤ëŸ¬
```
í•„í„°ë¥¼ ì ìš©í•˜ë©´ í•„í„°ê°€ í˜¸ì¶œëœ ë‹¤ìŒì— ì„œë¸”ë¦¿ì´ í˜¸ì¶œëœë‹¤.
ê·¸ë˜ì„œ ëª¨ë“  ê³ ê°ì˜ ìš”ì²­ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ìš”êµ¬ì‚¬í•­ì´ ìˆë‹¤ë©´ í•„í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
ì°¸ê³ ë¡œ í•„í„°ëŠ” íŠ¹ì • URL íŒ¨í„´ì— ì ìš©í•  ìˆ˜ ìˆë‹¤. (`/*`ì´ë¼ê³  í•˜ë©´ ëª¨ë“  ìš”ì²­ì— í•„í„°ê°€ ì ìš©ëœë‹¤.)  
ì°¸ê³ ë¡œ ìŠ¤í”„ë§ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì—¬ê¸°ì„œ ë§í•˜ëŠ” ì„œë¸”ë¦¿ì€ ìŠ¤í”„ë§ì˜ ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ìœ¼ë¡œ ìƒê°í•˜ë©´ ëœë‹¤.

#### í•„í„° ì œí•œ
```text
ë¡œê·¸ì¸ ì‚¬ìš©ì: HTTP ìš”ì²­ > WAS > í•„í„° > ì„œë¸”ë¦¿ > ì»¨íŠ¸ë¡¤ëŸ¬
ë¹„ ë¡œê·¸ì¸ ì‚¬ìš©ì: HTTP ìš”ì²­ > WAS > í•„í„°(ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ê³  íŒë‹¨í•˜ë©´ ì„œë¸”ë¦¿ì„ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤.)
```

#### í•„í„° ì²´ì¸
```text
HTTP ìš”ì²­ > WAS > í•„í„°1 > í•„í„°2 > í•„í„°3 > ì„œë¸”ë¦¿ > ì»¨íŠ¸ë¡¤ëŸ¬
```
í•„í„°ëŠ” ì²´ì¸ìœ¼ë¡œ êµ¬ì„±ë˜ëŠ”ë°, ì¤‘ê°„ì— í•„í„°ë¥¼ ììœ ë¡­ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” í•„í„°ë¥¼ ë¨¼ì € ì ìš©í•˜ê³ , ê·¸ ë‹¤ìŒì— ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” í•„í„°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

#### í•„í„° ì¸í„°í˜ì´ìŠ¤
```java
public interface Filter {

  public void init(FilterConfig filterConfig) throws ServletException {  }

  public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {  }

  public void destroy() {  }  
}
```
í•„í„° ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ë“±ë¡í•˜ë©´ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ í•„í„°ë¥¼ ì‹±ê¸€í†¤ ê°ì²´ë¡œ ìƒì„±í•˜ê³ , ê´€ë¦¬í•œë‹¤.
- `init()`: í•„í„° ì´ˆê¸°í™” ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë  ë•Œ í˜¸ì¶œëœë‹¤.
- `doFilter()`: ê³ ê°ì˜ ìš”ì²­ì´ ì˜¬ ë•Œ ë§ˆë‹¤ í•´ë‹¹ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤. í•„í„°ì˜ ë¡œì§ì„ êµ¬í˜„í•˜ë©´ ëœë‹¤.
- `destroy()`: í•„í„° ì¢…ë£Œ ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œ í˜¸ì¶œëœë‹¤.

### ì„œë¸”ë¦¿ í•„í„° - ìš”ì²­ ë¡œê·¸
í•„í„°ê°€ ì •ë§ ìˆ˜ë¬¸ì¥ ì—­í• ì„ ì˜ í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ëª¨ë“  ìš”ì²­ì„ ë¡œê·¸ë¡œ ë‚¨ê¸°ëŠ” í•„í„°ë¥¼ ê°œë°œí•˜ê³  ì ìš©í•´ë³´ì.

#### `LogFilter.java` ìƒì„±
```java
@Slf4j
public class LogFilter implements Filter {
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        log.info("log filter init");
    }

    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        HttpServletRequest httpRequest = (HttpServletRequest) servletRequest;
        String requestURI = httpRequest.getRequestURI();
        
        String uuid = UUID.randomUUID().toString();

        try {
            log.info("REQUEST   [{}][{}]", uuid, requestURI);
            filterChain.doFilter(servletRequest, servletResponse);
        } catch (Exception e) {
            throw e;
        } finally {
            log.info("RESPONSE  [{}][{}]", uuid, requestURI);
        }
    }

    @Override
    public void destroy() {
        log.info("log filter destroy");
    }
}
```
- `public class LogFilter implements Filter`
  - í•„í„°ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„  í•„í„° ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
- `doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)`
  - HTTP ìš”ì²­ì´ ì˜¤ë©´ `doFilter`ê°€ í˜¸ì¶œëœë‹¤.
  - `ServletRequest servletRequest`ëŠ” HTTP ìš”ì²­ì´ ì•„ë‹Œ ê²½ìš°ê¹Œì§€ ê³ ë ¤í•´ì„œ ë§Œë“  ì¸í„°í˜ì´ìŠ¤ì´ë‹¤. HTTPë¥¼ ì‚¬ìš©í•˜ë©´ `HttpServletRequest httpRequest = (HttpServletRequest) servletRequest;`ì™€ ê°™ì´ ë‹¤ìš´ ìºìŠ¤íŒ…í•˜ë©´ ëœë‹¤.
- `String uuid = UUID.randomUUID().toString();`
  - HTTP ìš”ì²­ì„ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ìš”ì²­ë‹¹ ì„ì˜ì˜ `uuid`ë¥¼ ìƒì„±í•œë‹¤.
- `log.info("REQUEST   [{}][{}]", uuid, requestURI);`
  - `uuid`, `requestURI`ë¥¼ ì¶œë ¥í•œë‹¤.
- `filterChain.doFilter(servletRequest, servletResponse);`
  - ì´ ë¶€ë¶„ì´ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤. ë‹¤ìŒ í•„í„°ê°€ ìˆìœ¼ë©´ í•„í„°ë¥¼ í˜¸ì¶œí•˜ê³ , í•„í„°ê°€ ì—†ìœ¼ë©´ ì„œë¸”ë¦¿ì„ í˜¸ì¶œí•œë‹¤. **ë§Œì•½ ì´ ë¡œì§ì„ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.**

#### `WebConfig.java` ìƒì„± (í•„í„° ì„¤ì •)
```java
@Configuration
public class WebConfig {
    
    @Bean
    public FilterRegistrationBean logFilter() {
        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();
        filterRegistrationBean.setFilter(new LogFilter());
        filterRegistrationBean.setOrder(1);
        filterRegistrationBean.addUrlPatterns("/*");
        
        return filterRegistrationBean;
    }
}
```
í•„í„°ë¥¼ ë“±ë¡í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆì§€ë§Œ, ìŠ¤í”„ë§ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ `FilterRegistrationBean`ì„ ì‚¬ìš©í•´ì„œ ë“±ë¡í•˜ë©´ ëœë‹¤.
- `setFilter(new LogFilter())`: ë“±ë¡í•  í•„í„°ë¥¼ ì§€ì •í•œë‹¤.
- `setOrder(1)`: í•„í„°ëŠ” ì²´ì¸ìœ¼ë¡œ ë™ì‘í•˜ê¸°ì— ìˆœì„œê°€ í•„ìš”í•˜ë‹¤. (ë‚®ì„ ìˆ˜ë¡ ë¨¼ì € ë™ì‘)
- `addUrlPatterns("/*")`: í•„í„°ë¥¼ ì ìš©í•  URL íŒ¨í„´ì„ ì§€ì •í•œë‹¤. (í˜„ì¬ëŠ” ëª¨ë“  ìš”ì²­ì— í•„í„°ë¥¼ ì ìš©í•œë‹¤.)

> ğŸ€ URL íŒ¨í„´ì— ëŒ€í•œ ë£°ì€ í•„í„°ë„ ì„œë¸”ë¦¿ê³¼ ë™ì¼í•˜ë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ì„œë¸”ë¦¿ URL íŒ¨í„´ìœ¼ë¡œ ê²€ìƒ‰í•˜ì.

> ğŸ€ `@ServletComponentScan`, `WebFilter(filterName = "logFilter", urlPatterns = "/*")`ë¡œ í•„í„° ë“±ë¡ì´ ê°€ëŠ¥í•˜ì§€ë§Œ í•„í„° ìˆœì„œ ì¡°ì ˆì´ ì•ˆëœë‹¤. ë”°ë¼ì„œ `FilterRegistrationBean`ì„ ì‚¬ìš©í•˜ì.


#### ì‹¤í–‰ ë¡œê·¸
```text
hello.itemservice.web.filter.LogFilter   : REQUEST   [0f057e43-a652-406b-973c-72bafe3fe3e7][/items]
hello.itemservice.web.filter.LogFilter   : RESPONSE  [0f057e43-a652-406b-973c-72bafe3fe3e7][/items]
```

> ğŸ€ ì‹¤ë¬´ì—ì„œ HTTP ìš”ì²­ ì‹œ ê°™ì€ ìš”ì²­ì˜ ë¡œê·¸ì— ëª¨ë‘ ê°™ì€ ì‹ë³„ìë¥¼ ìë™ìœ¼ë¡œ ë‚¨ê¸°ëŠ” ë°©ë²•ì€ `logback mdc` ë¡œ ê²€ìƒ‰í•´ë³´ê¸°.

## ì„œë¸”ë¦¿ í•„í„° - ì¸ì¦ ì²´í¬
ë¡œê·¸ì¸ ë˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ìƒí’ˆ ê´€ë¦¬ ë¿ë§Œ ì•„ë‹ˆë¼ ë¯¸ë˜ì— ê°œë°œë  í˜ì´ì§€ì—ë„ ì ‘ê·¼í•˜ì§€ ëª»í•˜ë„ë¡ í•˜ê¸°
### LoginCheckFilter.java ìƒì„± (ì¸ì¦ ì²´í¬ í•„í„°)
```java
@Slf4j
public class LoginCheckFilter implements Filter {
    
    private static final String[] whiteList = {"/", "/members/add", "/login", "/logout", "/css/*"};
    
    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        HttpServletRequest httpRequest = (HttpServletRequest) servletRequest;
        String requestURI = httpRequest.getRequestURI();

        HttpServletResponse httpResponse = (HttpServletResponse) servletResponse;
        
        try {
            log.info("ì¸ì¦ ì²´í¬ í•„í„° ì‹œì‘ {}", requestURI);

            if (isLoginCheckPath(requestURI)) {
                log.info("ì¸ì¦ ì²´í¬ ë¡œì§ ì‹¤í–‰ {}", requestURI);
                HttpSession session = httpRequest.getSession(false);

                if (session == null || session.getAttribute(SessionConst.LOGIN_MEMBER) == null) {
                    log.info("ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­ {}", requestURI);
                    
                    // ë¡œê·¸ì¸ìœ¼ë¡œ redirect
                    httpResponse.sendRedirect("/login?redirectURL=" + requestURI);
                    
                    return; // ì—¬ê¸°ê°€ ì¤‘ìš”, ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ë‹¤ìŒìœ¼ë¡œ ì§„í–‰í•˜ì§€ ì•Šê³  ë!
                }
            }
            
            filterChain.doFilter(servletRequest, servletResponse);
        } catch(Exception e) {
            throw e; // ì˜ˆì™¸ ë¡œê¹… ê°€ëŠ¥ í•˜ì§€ë§Œ, í†°ìº£ê¹Œì§€ ì˜ˆì™¸ë¥¼ ë³´ë‚´ì£¼ì–´ì•¼ í•œë‹¤.
        } finally {
            log.info("ì¸ì¦ ì²´í¬ í•„í„° ì¢…ë£Œ {}", requestURI);
        }
    }

    private boolean isLoginCheckPath(String requestURI) {
        return !PatternMatchUtils.simpleMatch(whiteList, requestURI);
    }
}
```
- `whitelist = {"/", "/members/add", "/login", "/logout","/css/*"};`
  - ì¸ì¦ í•„í„°ë¥¼ ì ìš©í•´ë„ í™ˆ, íšŒì›ê°€ì…, ë¡œê·¸ì¸ í™”ë©´, css ê°™ì€ ë¦¬ì†ŒìŠ¤ì—ëŠ” ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. ì´ë ‡ê²Œ í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ ê²½ë¡œëŠ” ì¸ì¦ê³¼ ë¬´ê´€í•˜ê²Œ í•­ìƒ í—ˆìš©í•œë‹¤.
- `if (isLoginCheckPath(requestURI)) { ... }`
  - í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ì œì™¸í•œ ëª¨ë“  ê²½ìš°ì—ëŠ” ì¸ì¦ ì²´í¬ ë¡œì§ì„ ì ìš©í•œë‹¤.
- `httpResponse.sendRedirect("/login?redirectURL=" + requestURI);`
  - ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•œë‹¤.
  - ë¡œê·¸ì¸ ì´í›„ì— ë‹¤ì‹œ í™ˆìœ¼ë¡œ ì´ë™í•˜ì§€ ì•Šê¸° ìœ„í•´ redirectURLì„ ë„˜ê²¨ì¤€ë‹¤.
  - ë¬¼ë¡ , `/login` ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¡œê·¸ì¸ ì„±ê³µ ì‹œ í•´ë‹¹ ê²½ë¡œë¡œ ì´ë™í•˜ëŠ” ê¸°ëŠ¥ì€ ì¶”ê°€ë¡œ ê°œë°œí•´ì•¼ í•œë‹¤.
- `return;`
  - ì—¬ê¸°ê°€ ì¤‘ìš”í•˜ë‹¤. í•„í„°ë¥¼ ë”ëŠ” ì§„í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´í›„ í•„í„°ëŠ” ë¬¼ë¡  ì„œë¸”ë¦¿, ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë”ëŠ” í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤. ì•ì„œ `redirect`ë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— `redirect`ê°€ ì‘ë‹µìœ¼ë¡œ ì ìš©ë˜ê³  ìš”ì²­ì´ ëë‚œë‹¤.

### `Webconfig.java`ì— loginCheckFilter() ì¶”ê°€
```java
@Bean
public FilterRegistrationBean loginCheckFilter() {
    FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();
    
    filterRegistrationBean.setFilter(new LoginCheckFilter());
    filterRegistrationBean.setOrder(2);
    filterRegistrationBean.addUrlPatterns("/*");
    return filterRegistrationBean;
}
```
- `setFilter(new LoginCheckFilter())`: ë¡œê·¸ì¸ í•„í„°ë¥¼ ë“±ë¡í•œë‹¤.
- `setOrder(2)`: ìˆœì„œë¥¼ 2ë²ˆìœ¼ë¡œ ì¡ì•˜ë‹¤. ë¡œê·¸ í•„í„° ë‹¤ìŒì— ë¡œê·¸ì¸ í•„í„°ê°€ ì ìš©ëœë‹¤.
- `addUrlPatterns("/*")`: ëª¨ë“  ìš”ì²­ì— ë¡œê·¸ì¸ í•„í„°ë¥¼ ì ìš©í•œë‹¤.

### RedirectURL ì²˜ë¦¬
ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ ì²˜ìŒ ìš”ì²­í•œ URLë¡œ ì´ë™í•˜ëŠ” ê¸°ëŠ¥ì„ ê°œë°œí•˜ì.
#### `LoginController.java`ì˜ login() ìˆ˜ì •
```java
@PostMapping("/login")
public String login(@Valid @ModelAttribute LoginForm form, 
                    BindingResult bindingResult,
                    @RequestParam(defaultValue = "/") String redirectURL,
                    HttpServletRequest request) {
    
    if (bindingResult.hasErrors()) {
        return "login/loginForm";
    }

    Member loginMember = loginService.login(form.getLoginId(), form.getPassword());
    log.info("login? {}", loginMember);

    if (loginMember == null) {
        bindingResult.reject("loginFail", "ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        return "login/loginForm";
    }

    //ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬
    //ì„¸ì…˜ì´ ìˆìœ¼ë©´ ìˆëŠ” ì„¸ì…˜ ë°˜í™˜, ì—†ìœ¼ë©´ ì‹ ê·œ ì„¸ì…˜ì„ ìƒì„±
    HttpSession session = request.getSession();

    //ì„¸ì…˜ì— ë¡œê·¸ì¸ íšŒì› ì •ë³´ ë³´ê´€
    session.setAttribute(SessionConst.LOGIN_MEMBER, loginMember);

    return "redirect:" + redirectURL;
}
```

### ì •ë¦¬
ì„œë¸”ë¦¿ í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ë‚˜ë¨¸ì§€ ê²½ë¡œì— ë“¤ì–´ê°ˆ ìˆ˜ ì—†ê²Œ ë˜ì—ˆë‹¤.

> ğŸ€ ì°¸ê³   
> í•„í„°ì—ëŠ” ë‹¤ìŒì— ì„¤ëª…í•  ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ì œê³µí•˜ì§€ ì•ŠëŠ” ì•„ì£¼ ê°•ë ¥í•œ ê¸°ëŠ¥ì´ ìˆë‹¤.  
> `filterChain.doFilter(servletRequest, servletResponse);`ë¥¼ í˜¸ì¶œí•´ì„œ ë‹¤ìŒ í•„í„° ë˜ëŠ” ì„œë¸”ë¦¿ì„ í˜¸ì¶œí•  ë•Œ `servletRequest`, `servletResponse`ë¥¼ ë‹¤ë¥¸ ê°ì²´ë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤.
> ê·¸ëŸ¬ë©´, í•´ë‹¹ ê°ì²´ê°€ ë‹¤ìŒ í•„í„° ë˜ëŠ” ì„œë¸”ë¦¿ì—ì„œ ì‚¬ìš©ëœë‹¤. ì˜ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì€ ì•„ë‹ˆë‹ˆ ì°¸ê³ í•´ë‘ì.

## ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì†Œê°œ
ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ë„ ì„œë¸”ë¦¿ í•„í„°ì™€ ê°™ì´ ì›¹ ê´€ë ¨ ê³µí†µ ê´€ì‹¬ ì‚¬í•­ì„ íš¨ê³¼ì ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆëŠ” ê¸°ìˆ ì´ë‹¤.  
ì„œë¸”ë¦¿ í•„í„°ê°€ ì„œë¸”ë¦¿ì´ ì œê³µí•˜ëŠ” ê¸°ìˆ ì´ë¼ë©´, ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ìŠ¤í”„ë§ MVCê°€ ì œê³µí•˜ëŠ” ê¸°ìˆ ì´ë‹¤. ë‘˜ë‹¤ ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ ì‚¬í•­ì„ ì²˜ë¦¬í•˜ì§€ë§Œ, ì ìš©ë˜ëŠ” ìˆœì„œì™€ ë²”ìœ„, ê·¸ë¦¬ê³  ì‚¬ìš© ë°©ë²•ì´ ë‹¤ë¥´ë‹¤.

### ìŠ¤í”„ë§ ì¸í„°ì…‰í„° íë¦„
```text
HTTP ìš”ì²­ > WAS > í•„í„° > ì„œë¸”ë¦¿ > ìŠ¤í”„ë§ ì¸í„°ì…‰í„° > ì»¨íŠ¸ë¡¤ëŸ¬
```
- ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ê³¼ ì»¨íŠ¸ë¡¤ëŸ¬ ì‚¬ì´ì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì§ì „ì— í˜¸ì¶œëœë‹¤.
- ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ìŠ¤í”„ë§ MVCê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì´ê¸° ë•Œë¬¸ì—, ê²°êµ­ ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ ì´í›„ì— ë“±ì¥í•˜ê²Œ ëœë‹¤.
ìŠ¤í”„ë§ MVCì˜ ì‹œì‘ì ì´ ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ì´ë¼ê³  ìƒê°í•˜ë©´ ì´í•´í•˜ê¸° ì‰½ë‹¤.
- ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ì—ë„ URL íŒ¨í„´ì„ ì ìš©í•  ìˆ˜ ìˆëŠ”ë°, ì„œë¸”ë¦¿ URL íŒ¨í„´ê³¼ ë‹¤ë¥´ê³ , ë§¤ìš° ì •ë°€í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

### ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì œí•œ
```text
ë¡œê·¸ì¸ ì‚¬ìš©ì: HTTP ìš”ì²­ > WAS > í•„í„° > ì„œë¸”ë¦¿ > ìŠ¤í”„ë§ ì¸í„°ì…‰í„° > ì»¨íŠ¸ë¡¤ëŸ¬
ë¹„ ë¡œê·¸ì¸ ì‚¬ìš©ì: HTTP ìš”ì²­ > WAS > í•„í„° > ì„œë¸”ë¦¿ > ìŠ¤í”„ë§ ì¸í„°ì…‰í„°(ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤.)
```
ë¡œê·¸ì¸ ì—¬ë¶€ ì²´í¬í•˜ê¸° ì¢‹ë‹¤.

### ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì²´ì¸
```text
HTTP ìš”ì²­ > WAS > í•„í„° > ì„œë¸”ë¦¿ > ìŠ¤í”„ë§ ì¸í„°ì…‰í„°1 > ìŠ¤í”„ë§ ì¸í„°ì…‰í„°2 > ì»¨íŠ¸ë¡¤ëŸ¬
```
ì„œë¸”ë¦¿ í•„í„°ì™€ í˜¸ì¶œë˜ëŠ” ìˆœì„œë§Œ ë‹¤ë¥´ê³  ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì€ ë¹„ìŠ·í•˜ë‹¤. ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ì„œë¸”ë¦¿ í•„í„°ë³´ë‹¤ í¸ë¦¬í•˜ê³ , ë” ì •êµí•˜ê³  ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì§€ì›í•œë‹¤.

### ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì¸í„°í˜ì´ìŠ¤
ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ `HandlerInterceptor` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë©´ ëœë‹¤.
```java
public interface HandlerInterceptor {
    default boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        return true;
    }

    default void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable ModelAndView modelAndView) throws Exception {
    }

    default void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable Exception ex) throws Exception {
    }
}
```
- ì„œë¸”ë¦¿ í•„í„°ì˜ ê²½ìš° ë‹¨ìˆœí•˜ê²Œ `doFilter()`í•˜ë‚˜ë§Œ ì œê³µëœë‹¤. ì¸í„°ì…‰í„°ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „(`preHandle`), í˜¸ì¶œ í›„ (`postHandle`), ìš”ì²­ ì™„ë£Œ ì´í›„ (`afterCompletion`)ì™€ ê°™ì´ ë‹¨ê³„ì ìœ¼ë¡œ ì„¸ë¶„í™”ë˜ì–´ ìˆë‹¤.  
- ì„œë¸”ë¦¿ í•„í„°ì˜ ê²½ìš° ë‹¨ìˆœíˆ `servletRequest`, `servletResponse`ë§Œ ì œê³µí–ˆì§€ë§Œ, ì¸í„°ì…‰í„°ëŠ” ì–´ë–¤ ì»¨íŠ¸ë¡¤ëŸ¬(`handler`)ê°€ í˜¸ì¶œë˜ëŠ” ì§€ í˜¸ì¶œ ì •ë³´ë„ ë°›ì„ ìˆ˜ ìˆë‹¤.
ê·¸ë¦¬ê³  ì–´ë–¤ `modelAndView`ê°€ ë°˜í™˜ë˜ëŠ”ì§€ ì‘ë‹µ ì •ë³´ë„ ë°›ì„ ìˆ˜ ìˆë‹¤.  
![ìŠ¤í”„ë§ ì¸í„°ì…‰í„° í˜¸ì¶œ íë¦„.png](imgs%2F%EC%8A%A4%ED%94%84%EB%A7%81%20%EC%9D%B8%ED%84%B0%EC%85%89%ED%84%B0%20%ED%98%B8%EC%B6%9C%20%ED%9D%90%EB%A6%84.png)  

ì •ìƒ íë¦„
- `preHandle`: ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „ì— í˜¸ì¶œëœë‹¤. (í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° í˜¸ì¶œ ì „ì— í˜¸ì¶œëœë‹¤.)
  - `preHandle`ì˜ ì‘ë‹µ ê°’ì´ `true`ì´ë©´ ë‹¤ìŒìœ¼ë¡œ ì§„í–‰í•˜ê³ , `false`ì´ë©´ ë”ëŠ” ì§„í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. `false`ì¸ ê²½ìš° ë‚˜ë¨¸ì§€ ì¸í„°ì…‰í„°ëŠ” ë¬¼ë¡ ì´ê³ , í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ë„ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤. (ê·¸ë¦¼ 1ë²ˆì—ì„œ ëë‚œë‹¤.)
- `postHandle`: ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ í›„ì— í˜¸ì¶œëœë‹¤. (í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° í˜¸ì¶œ í›„ì— í˜¸ì¶œëœë‹¤.)
- `afterCompletion`: ë·°ê°€ ë Œë”ë§ ëœ ì´í›„ì— í˜¸ì¶œëœë‹¤.

### ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì˜ˆì™¸ ìƒí™©
![ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì˜ˆì™¸.png](imgs%2F%EC%8A%A4%ED%94%84%EB%A7%81%20%EC%9D%B8%ED%84%B0%EC%85%89%ED%84%B0%20%EC%98%88%EC%99%B8.png)

ì˜ˆì™¸ ë°œìƒ ì‹œ
- `preHandle`: ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „ì— í˜¸ì¶œëœë‹¤.
- `postHandle`: ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ `postHandle`ì€ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.
- `afterCompletion`: í•­ìƒ í˜¸ì¶œëœë‹¤. ì´ ê²½ìš° ì˜ˆì™¸(`ex`)ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì„œ ì–´ë–¤ ì˜ˆì™¸ê°€ ë°œìƒí–ˆëŠ”ì§€ ë¡œê·¸ë¡œ ì¶œë ¥í•  ìˆ˜ ìˆë‹¤.

#### afterCompletionì€ ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ í˜¸ì¶œëœë‹¤.
- ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ `postHandle()`ëŠ” í˜¸ì¶œë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì˜ˆì™¸ì™€ ë¬´ê´€í•˜ê²Œ ê³µí†µ ì²˜ë¦¬ë¥¼ í•˜ë ¤ë©´ `afterCompletion()`ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
- ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ `afterCompletion()`ì— ì˜ˆì™¸ ì •ë³´(`ex`)ë¥¼ í¬í•¨í•´ì„œ í˜¸ì¶œëœë‹¤.

### ì •ë¦¬
ì¸í„°ì…‰í„°ëŠ” ìŠ¤í”„ë§ MVC êµ¬ì¡°ì— íŠ¹í™”ëœ í•„í„° ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤ê³  ì´í•´í•˜ë©´ ëœë‹¤. ìŠ¤í”„ë§ MVCë¥¼ ì‚¬ìš©í•˜ê³ , íŠ¹ë³„íˆ í•„í„°ë¥¼ ê¼­ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ì•„ë‹ˆë¼ë©´ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•œ ê²ƒì´ ë” í¸ë¦¬í•˜ë‹¤.

## ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ìš”ì²­ ë¡œê·¸
### `LogInterceptor.java` ìƒì„± (ìš”ì²­ ë¡œê·¸ ì¸í„°ì…‰í„°)
```java
@Slf4j
public class LogInterceptor implements HandlerInterceptor {

    public static final String LOG_ID = "logId";

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        String requestURI = request.getRequestURI();
        
        String uuid = UUID.randomUUID().toString();
        request.setAttribute(LOG_ID, uuid);
        
        // @RequestMapping: HandlerMethod
        // ì •ì  ë¦¬ì†ŒìŠ¤: ResourceHttpRequestHandler
        if (handler instanceof HandlerMethod) {
            HandlerMethod hm = (HandlerMethod) handler; // í˜¸ì¶œí•  ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì˜ ëª¨ë“  ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.
        }
        
        log.info("REQUEST [{}][{}][{}]", uuid, requestURI, handler);
        return true; 
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable ModelAndView modelAndView) throws Exception {
        log.info("postHandle [{}]", modelAndView);
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable Exception ex) throws Exception {
        String requestURI = request.getRequestURI();

        String logId = (String) request.getAttribute(LOG_ID);
        log.info("RESPONSE [{}][{}]", logId, requestURI);

        if (ex != null) {
            log.error("afterCompletion error!!", ex);
        }
    }
}
```

- `String uuid = UUID.RandomUUID().toString();`
  - ìš”ì²­ ë¡œê·¸ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•œ `uuid`ë¥¼ ìƒì„±
- `request.setAttribute(LOG_ID, uuid)`
  - ì„œë¸”ë¦¿ í•„í„°ì˜ ê²½ìš° ì§€ì—­ë³€ìˆ˜ë¡œ í•´ê²°ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” í˜¸ì¶œ ì‹œì ì´ ì™„ì „íˆ ë¶„ë¦¬ë˜ì–´ìˆë‹¤.
ë”°ë¼ì„œ `preHandle`ì—ì„œ ì§€ì •í•œ ê°’ì„ `postHandle`, `afterCompletion`ì—ì„œ í•¨ê»˜ ì‚¬ìš©í•˜ë ¤ë©´ ì–´ë”˜ê°€ì— ë‹´ì•„ë‘ì–´ì•¼ í•œë‹¤.
`LogInterceptor`ë„ ì‹±ê¸€í†¤ì²˜ëŸ¼ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— ë©¤ë²„ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ìœ„í—˜í•˜ì—¬ `request`ì— ë‹´ì•„ë‘ì—ˆë‹¤. ì´ ê°’ì€ `afterCompletion`ì—ì„œ `request.getAttribute(LOG_ID)`ë¡œ ì°¾ì•„ì„œ ì‚¬ìš©í•œë‹¤.
- `return true`
  - `true`ë©´ ì •ìƒ í˜¸ì¶œì´ë‹¤. ë‹¤ìŒ ì¸í„°ì…‰í„°ë‚˜ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í˜¸ì¶œëœë‹¤.

```java
if (handler instanceof HandlerMethod) {
    HandlerMethod hm = (HandlerMethod) handler;  
}
```

### HandlerMethod
í•¸ë“¤ëŸ¬ ì •ë³´ëŠ” ì–´ë–¤ í•¸ë“¤ëŸ¬ ë§¤í•‘ì„ ì‚¬ìš©í•˜ëŠ”ê°€ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤. ìŠ¤í”„ë§ì„ ì‚¬ìš©í•˜ë©´ ì¼ë°˜ì ìœ¼ë¡œ `@Controller`, `@RequestMapping`ì„ í™œìš©í•œ í•¸ë“¤ëŸ¬ ë§¤í•‘ì„ ì‚¬ìš©í•˜ëŠ”ë°, ì´ ê²½ìš° í•¸ë“¤ëŸ¬ ì •ë³´ë¡œ `HandlerMethod`ê°€ ë„˜ì–´ì˜¨ë‹¤.

### ResourceHttpRequestHandler
`@Controller`ê°€ ì•„ë‹ˆë¼ `/resources/static`ì™€ ê°™ì€ ì •ì  ë¦¬ì†ŒìŠ¤ê°€ í˜¸ì¶œë˜ëŠ” ê²½ìš° `ResourceHttpRequestHandler`ê°€ í•¸ë“¤ëŸ¬ ì •ë³´ë¡œ ë„˜ì–´ì˜¤ê¸° ë•Œë¬¸ì— íƒ€ì…ì— ë”°ë¼ì„œ ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤.

### postHandle, afterCompletion
ì¢…ë£Œ ë¡œê·¸ë¥¼ `postHandle`ì´ ì•„ë‹ˆë¼ `afterCompletion`ì—ì„œ ì‹¤í–‰í•œ ì´ìœ ëŠ”, ì˜ˆì™¸ê°€ ë°œìƒí•œ ê²½ìš° `postHandle`ê°€ í˜¸ì¶œë˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.
`afterCompletion`ì€ ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ í˜¸ì¶œë˜ëŠ” ê²ƒì„ ë³´ì¥í•œë‹¤.

### WebConfig.javaì— ì¸í„°ì…‰í„° ë“±ë¡
```java
@Override
public void addInterceptors(InterceptorRegistry registry) {
  registry.addInterceptor(new LogInterceptor())
          .order(1)
          .addPathPatterns("/**")
          .excludePathPatterns("/css/**", "/*.ico", "/error");
}
```
ì¸í„°ì…‰í„°ì™€ í•„í„°ê°€ ì¤‘ë³µë˜ì§€ ì•Šë„ë¡ í•„í„°ë¥¼ ë“±ë¡í•˜ê¸° ìœ„í•œ `logFilter()`ì˜ `@Bean`ì€ ì£¼ì„ì²˜ë¦¬  
`WebMvcConfigurer`ê°€ ì œê³µí•˜ëŠ” `addInterceptors()`ë¥¼ ì‚¬ìš©í•´ì„œ ì¸í„°ì…‰í„°ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë‹¤.

- `registry.addInterceptor(new LogInterceptor())`: ì¸í„°ì…‰í„°ë¥¼ ë“±ë¡í•œë‹¤.
- `order(1)`: ì¸í„°ì…‰í„°ì˜ í˜¸ì¶œ ìˆœì„œë¥¼ ì§€ì •í•œë‹¤. ë‚®ì„ ìˆ˜ë¡ ë¨¼ì € í˜¸ì¶œëœë‹¤.
- `addPathPateerns("/**")`: ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•  URL íŒ¨í„´ì„ ì§€ì •í•œë‹¤.
- `excludePatterns("/css/**", "/*.ico", "/error")`: ì¸í„°ì…‰í„°ì—ì„œ ì œì™¸í•  íŒ¨í„´ì„ ì§€ì •í•œë‹¤.

í•„í„°ì™€ ë¹„êµí•´ë³´ë©´ ì¸í„°ì…‰í„°ëŠ” `addPathPateerns`, `excludePathPatterns`ë¡œ ë§¤ìš° ì •ë°€í•˜ê²Œ URL íŒ¨í„´ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

### ì‹¤í–‰ ë¡œê·¸
```text
RESPONSE [66311141-b364-469a-9941-3d8dfa7863b9][/items]
REQUEST [38b6c8a6-afbf-4a6f-b409-bffef28c7234][/items/1][hello.itemservice.web.controller.ItemController#item(long, Model)]
postHandle [ModelAndView [view="items/item"; model={item=Item(id=1, itemName=itemA, price=10000, quantity=10), org.springframework.validation.BindingResult.item=org.springframework.validation.BeanPropertyBindingResult: 0 errors}]]
RESPONSE [38b6c8a6-afbf-4a6f-b409-bffef28c7234][/items/1]
```

### ìŠ¤í”„ë§ì˜ URL ê²½ë¡œ
ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” URL ê²½ë¡œëŠ” ì„œë¸”ë¦¿ ê¸°ìˆ ì´ ì œê³µí•˜ëŠ” URL ê²½ë¡œì™€ ì™„ì „íˆ ë‹¤ë¥´ë‹¤. ë”ìš± ìì„¸í•˜ê³  ì„¸ë°€í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
[PathPattern ê³µì‹ ë¬¸ì„œ](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/util/pattern/PathPattern.html)
```text
? í•œ ë¬¸ì ì¼ì¹˜
* ê²½ë¡œ(/) ì•ˆì—ì„œ 0ê°œ ì´ìƒì˜ ë¬¸ì ì¼ì¹˜
** ê²½ë¡œ ëê¹Œì§€ 0ê°œ ì´ìƒì˜ ê²½ë¡œ(/) ì¼ì¹˜
{spring} ê²½ë¡œ(/)ì™€ ì¼ì¹˜í•˜ê³  springì´ë¼ëŠ” ë³€ìˆ˜ë¡œ ìº¡ì²˜
{spring:[a-z]+} matches the regexp [a-z]+ as a path variable named "spring" {spring:[a-z]+} regexp [a-z]+ ì™€ ì¼ì¹˜í•˜ê³ , "spring" ê²½ë¡œ ë³€ìˆ˜ë¡œ ìº¡ì²˜
{*spring} ê²½ë¡œê°€ ëë‚  ë•Œ ê¹Œì§€ 0ê°œ ì´ìƒì˜ ê²½ë¡œ(/)ì™€ ì¼ì¹˜í•˜ê³  springì´ë¼ëŠ” ë³€ìˆ˜ë¡œ ìº¡ì²˜

/pages/t?st.html â€” matches /pages/test.html, /pages/tXst.html but not /pages/
toast.html
/resources/*.png â€” matches all .png files in the resources directory
/resources/** â€” matches all files underneath the /resources/ path, including /
resources/image.png and /resources/css/spring.css
/resources/{*path} â€” matches all files underneath the /resources/ path and
captures their relative path in a variable named "path"; /resources/image.png
will match with "path" â†’ "/image.png", and /resources/css/spring.css will match
with "path" â†’ "/css/spring.css"
/resources/{filename:\\w+}.dat will match /resources/spring.dat and assign the
value "spring" to the filename variable
```

## ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì¸ì¦ ì²´í¬
### `LoginCheckInterceptor.java` ìƒì„±
```java
@Slf4j
public class LoginCheckInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        String requestURI = request.getRequestURI();
        
        log.info("ì¸ì¦ ì²´í¬ ì¸í„°ì…‰í„° ì‹¤í–‰ {}", requestURI);
        HttpSession session = request.getSession(false);

        if (session == null || session.getAttribute(SessionConst.LOGIN_MEMBER) == null) {
            log.info("ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­");
            
            // ë¡œê·¸ì¸ìœ¼ë¡œ redirect
            response.sendRedirect("/login?redirectURL=" + requestURI);
            return false;
        }
        
        return true;
    }
}
```
ì„œë¸”ë¦¿ í•„í„°ì™€ ë¹„êµí•´ì„œ ì½”ë“œê°€ ë§¤ìš° ê°„ê²°í•˜ë‹¤. ì¸ì¦ì€ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „ì—ë§Œ í˜¸ì¶œë˜ë©´ ëœë‹¤. ë”°ë¼ì„œ `preHandle`ë§Œ êµ¬í˜„í•˜ë©´ ëœë‹¤.

### ìˆœì„œ ì£¼ì˜, ì„¸ë°€í•œ ì„¤ì • ê°€ëŠ¥ - WebConfing.java - addInterceptors() ìˆ˜ì •
```java
@Override
public void addInterceptors(InterceptorRegistry registry) {
    registry.addInterceptor(new LogInterceptor())
            .order(1)
            .addPathPatterns("/**")
            .excludePathPatterns("/css/**", "/*.ico", "/error");

    registry.addInterceptor(new LoginCheckInterceptor())
            .order(2)
            .addPathPatterns("/**")
            .excludePathPatterns("/", "/members/add", "/login", "/logout", "/css/**", "/*.ico", "/error");
}
```
ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•˜ê±°ë‚˜ í•˜ì§€ ì•Šì„ ë¶€ë¶„ì€ `addPathPatterns`ì™€ `excludePathPatterns`ì— ì‘ì„±í•˜ë©´ ëœë‹¤.
ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ê²½ë¡œì— í•´ë‹¹ ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•˜ë˜ (`/**`), í™ˆ(`/`), íšŒì›ê°€ì…(`/members/add`), ë¡œê·¸ì¸(`/login`), ë¦¬ì†ŒìŠ¤ ì¡°íšŒ(`/css/**`), ì˜¤ë¥˜ (`/error`)ì™€ ê°™ì€ ë¶€ë¶„ì€ ë¡œê·¸ì¸ ì²´í¬ ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.

### ì •ë¦¬
ì„œë¸”ë¦¿ í•„í„°ì™€ ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ê¸°ìˆ ì´ë‹¤.  
ì„œë¸”ë¦¿ í•„í„°ì™€ ë¹„êµí•´ì„œ ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ê°€ ê°œë°œì ì…ì¥ì—ì„œ í›¨ì”¬ í¸ë¦¬í•˜ë‹¤.  
íŠ¹ë³„í•œ ë¬¸ì œê°€ ì—†ë‹¤ë©´ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

