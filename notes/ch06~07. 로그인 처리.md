## ë¡œê·¸ì¸ ì²˜ë¦¬í•˜ê¸° - ì„œë¸”ë¦¿ HTTP ì„¸ì…˜
ì„œë¸”ë¦¿ì€ ì„¸ì…˜ì„ ìœ„í•´ `HttpSession`ì´ë¼ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

### HttpSession ì†Œê°œ
- ì„œë¸”ë¦¿ì´ ì„¸ì…˜ì„ ìœ„í•´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥
- ì„œë¸”ë¦¿ì„ í†µí•´ `HttpSession`ì„ ìƒì„±í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¿ í‚¤ë¥¼ ìƒì„±í•œë‹¤. ì¿ í‚¤ ì´ë¦„ì´ `JSESSIONID`ì´ê³ , ê°’ì€ ì¶”ì • ë¶ˆê°€ëŠ¥í•œ ëœëŸ¼ ê°’ì´ë‹¤.
    ```text
    Cookie: JSESSIONID=5B78E23B513F50164D6FDD8C97B0AD05
    ```
  
### ì„œë¸”ë¦¿ì´ ì œê³µí•˜ëŠ” `HttpSession` ì‚¬ìš©í•˜ê¸°
#### `SessionConst.java` ìƒì„±
```java
public class SessionConst {
    public static final String LOGIN_MEMBER = "loginMember";
}
```
`HttpSession`ì— ë°ì´í„°ë¥¼ ë³´ê´€í•˜ê³  ì¡°íšŒí•  ë•Œ, ê°™ì€ ì´ë¦„ì´ ì¤‘ë³µë˜ì–´ ì‚¬ìš©ë˜ë¯€ë¡œ, ìƒìˆ˜ë¥¼ í•˜ë‚˜ ì •ì˜í•œ ê²ƒì´ë‹¤.

#### `LoginService.java` ìƒì„±
```java
@Service
@RequiredArgsConstructor
public class LoginService {
    
    private final MemberRepository memberRepository;

    /**
     * @return null: ë¡œê·¸ì¸ ì‹¤íŒ¨
     */
    public Member login(String loginId, String password) {
        return memberRepository.findByLoginId(loginId)
                .filter(m -> m.getPassword().equals(password))
                .orElse(null);
    }
}
```
#### `LoginController.java` ìƒì„±
```java
@Slf4j
@Controller
@RequiredArgsConstructor
public class LoginController {

    private final LoginService loginService;

    @GetMapping("/login")
    public String loginForm(@ModelAttribute("loginForm") LoginForm form) {
        return "login/loginForm";
    }

    @PostMapping("/login")
    public String login(@Valid @ModelAttribute LoginForm form, BindingResult bindingResult, HttpServletRequest request) {
        if (bindingResult.hasErrors()) {
            return "login/loginForm";
        }

        Member loginMember = loginService.login(form.getLoginId(), form.getPassword());

        if (loginMember == null) {
            bindingResult.reject("loginFail", "ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            return "login/loginForm";
        }

        //ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬
        //ì„¸ì…˜ì´ ìˆìœ¼ë©´ ìˆëŠ” ì„¸ì…˜ ë°˜í™˜, ì—†ìœ¼ë©´ ì‹ ê·œ ì„¸ì…˜ì„ ìƒì„±
        HttpSession session = request.getSession();
        
        //ì„¸ì…˜ì— ë¡œê·¸ì¸ íšŒì› ì •ë³´ ë³´ê´€
        session.setAttribute(SessionConst.LOGIN_MEMBER, loginMember);

        return "redirect:/";
    }
}
```

#### ì„¸ì…˜ ìƒì„±ê³¼ ì¡°íšŒ
ì„¸ì…˜ì„ ìƒì„±í•˜ë ¤ë©´ `request.getSession(true)`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.  
```java
public HttpSession getSession(boolean create);
```

##### ì„¸ì…˜ì˜ `create` ì˜µì…˜
- `request.getSession(true)`
  - ì„¸ì…˜ì´ ìˆìœ¼ë©´ ê¸°ì¡´ ì„¸ì…˜ì„ ë°˜í™˜í•œë‹¤.
  - ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ìƒˆë¡œìš´ ì„¸ì…˜ì„ ìƒì„±í•´ì„œ ë°˜í™˜í•œë‹¤.
- `request.getSession(false)`
  - ì„¸ì…˜ì´ ìˆìœ¼ë©´ ê¸°ì¡´ ì„¸ì…˜ì„ ë°˜í™˜í•œë‹¤.
  - ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ìƒˆë¡œìš´ ì„¸ì…˜ì„ ìƒì„±í•˜ì§€ ì•ŠëŠ”ë‹¤. `null`ì„ ë°˜í™˜í•œë‹¤.
- `request.getSession()`
  - ì‹ ê·œ ì„¸ì…˜ì„ ìƒì„±í•˜ëŠ” `request.getSession(true)`ì™€ ë™ì¼í•˜ë‹¤.
- 

##### ì„¸ì…˜ì— ë¡œê·¸ì¸ íšŒì› ì •ë³´ ë³´ê´€
```java
session.setAttribute(SessionConst.LOGIN_MEMEBER, loginMember);
```
ì„¸ì…˜ì— ë°ì´í„°ë¥¼ ë³´ê´€í•˜ëŠ” ë°©ë²•ì€ `request.setAttribute(...)`ì™€ ë¹„ìŠ·í•˜ë‹¤. í•˜ë‚˜ì˜ ì„¸ì…˜ì— ì—¬ëŸ¬ ê°’ì„ ì €ì¥í•  ìˆ˜ ìˆë‹¤.

#### ë¡œê·¸ì•„ì›ƒ - LoginController.javaì— logout() ìƒì„±
```java
@PostMapping("/logout")
public String logoutV3(HttpServletRequest request) {
    // ì„¸ì…˜ì„ ì‚­ì œí•œë‹¤.
    HttpSession session = request.getSession(false);

    if (session != null) {
        session.invalidate();
    }

    return "redirect:/";
}
```
`session.invalidate()`: ì„¸ì…˜ì„ ì œê±°í•œë‹¤.

#### HomeController.java ìƒì„±
```java
@Slf4j
@Controller
@RequiredArgsConstructor
public class HomeController {

  @GetMapping("/")
  public String home(HttpServletRequest request, Model model) {
    HttpSession session = request.getSession(false);

    // ì„¸ì…˜ì´ ì—†ìœ¼ë©´ home
    if (session == null) {
      return "home";
    }

    Member loginMember = (Member) session.getAttribute(SessionConst.LOGIN_MEMBER);
    // ì„¸ì…˜ì— íšŒì› ë°ì´í„°ê°€ ì—†ìœ¼ë©´ home
    if (loginMember == null) {
      return "home";
    }

    // ì„¸ì…˜ì´ ìœ ì§€ë˜ë©´ ë¡œê·¸ì¸ìœ¼ë¡œ ì´ë™
    model.addAttribute("member", loginMember);
    return "loginHome";
  }
}
```
- `request.getSession(false)`: `request.getSession()`ë¥¼ ì‚¬ìš©í•˜ë©´ ê¸°ë³¸ ê°’ì´ `create: true`ì´ë¯€ë¡œ, 
ë¡œê·¸ì¸í•˜ì§€ ì•Šì„ ì‚¬ìš©ìë„ ì˜ë¯¸ì—†ëŠ” ì„¸ì…˜ì´ ë§Œë“¤ì–´ì§„ë‹¤. ë”°ë¼ì„œ ì„¸ì…˜ì„ ì°¾ì•„ì„œ ì‚¬ìš©í•˜ëŠ” ì‹œì ì—ëŠ” `create:false`ì˜µì…˜ì„ ì‚¬ìš©í•´ì„œ ì„¸ì…˜ì„ ìƒì„±í•˜ì§€ ì•Šì•„ì•¼ í•œë‹¤.
- `session.getAttribute(SessionConst.LOGIN_MEMBER)`: ë¡œê·¸ì¸ ì‹œì ì— ì„¸ì…˜ì— ë³´ê´€í•œ íšŒì› ê°ì²´ë¥¼ ì°¾ëŠ”ë‹¤.

#### ì‹¤í–‰
`JSESSIONID` ì¿ í‚¤ê°€ ìƒì„±ëœë‹¤.

### @SessionAttribute
ìŠ¤í”„ë§ì€ ì„¸ì…˜ì„ ë” í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ `@SessionAttribute`ë¥¼ ì§€ì›í•œë‹¤.  
ì´ë¯¸ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìë¥¼ ì°¾ì„ ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ì°¸ê³ ë¡œ ì´ ê¸°ëŠ¥ì€ ì„¸ì…˜ì„ ìƒì„±í•˜ì§€ ì•ŠëŠ”ë‹¤.
`@SessionAttribute(name = "loginMember", required = false) Member loginMember`

### HomeController.java - home() ìˆ˜ì •
```java
@GetMapping("/")
public String home(@SessionAttribute(name = SessionConst.LOGIN_MEMBER, required = false) Member loginMember, Model model) {
    // ì„¸ì…˜ì— íšŒì› ë°ì´í„°ê°€ ì—†ìœ¼ë©´ home
    if (loginMember == null) {
        return "home";
    }

    // ì„¸ì…˜ì´ ìœ ì§€ë˜ë©´ ë¡œê·¸ì¸ìœ¼ë¡œ ì´ë™
    model.addAttribute("member", loginMember);
    return "loginHome";
}
```
ì„¸ì…˜ì„ ì°¾ê³ , ì„¸ì…˜ì— ë“¤ì–´ìˆëŠ” ë°ì´í„°ë¥¼ ì°¾ëŠ” ë²ˆê±°ë¡œìš´ ê³¼ì •ì„ ìŠ¤í”„ë§ì´ í•œ ë²ˆì— í¸ë¦¬í•˜ê²Œ ì²˜ë¦¬í•´ì¤€ë‹¤.

### TrackingModes
ë¡œê·¸ì¸ì„ ì²˜ìŒ ì‹œë„í•˜ë©´ URLì´ ë‹¤ìŒê³¼ ê°™ì´ `jsessionid`ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```text
http://localhost:8080/;jsessionid=B507F38494A29FDA213CA0A265B20661
```
ì´ê²ƒì€ ì›¹ ë¸Œë¼ìš°ì €ê°€ ì¿ í‚¤ë¥¼ ì§€ì›í•˜ì§€ ì•Šì„ ë•Œ ì¿ í‚¤ ëŒ€ì‹  URLì„ í†µí•´ì„œ ì„¸ì…˜ì„ ìœ ì§€í•˜ëŠ” ë°©ë²•ì´ë‹¤.
ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ë ¤ë©´ URLì— ì´ ê°’ì„ ê³„ì† í¬í•¨í•´ì„œ ì „ë‹¬í•´ì•¼ í•œë‹¤. íƒ€ì„ë¦¬í”„ ê°™ì€ ì—”ì§„ì„ í†µí•´ì„œ ë§í¬ë¥¼ ê±¸ë©´ `jsessionid`ë¥¼ URLì— ìë™ìœ¼ë¡œ í¬í•¨í•´ì¤€ë‹¤.
ì„œë²„ ì…ì¥ì—ì„œ ì›¹ ë¸Œë¼ìš°ì €ê°€ ì¿ í‚¤ë¥¼ ì§€ì›í•˜ëŠ”ì§€ í•˜ì§€ ì•ŠëŠ” ì§€ ìµœì´ˆì—ëŠ” íŒë‹¨í•˜ì§€ ëª»í•˜ë¯€ë¡œ, ì¿ í‚¤ ê°’ë„ ì „ë‹¬í•˜ê³ , URLì— `jsessionid`ë„ í•¨ê»˜ ì „ë‹¬í•œë‹¤.  
URL ì „ë‹¬ ë°©ì‹ì„ ë„ê³  í•­ìƒ ì¿ í‚¤ë¥¼ í†µí•´ì„œë§Œ ì„¸ì…˜ì„ ìœ ì§€í•˜ê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒ ì˜µì…˜ì„ ë„£ì–´ì£¼ë©´ ëœë‹¤. ì´ë ‡ê²Œí•˜ë©´ URLì— `jsessionid`ê°€ ë…¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.
```text
[application.properties]

server.servlet.session.tracking-modes=cookie
```

## ì„¸ì…˜ ì •ë³´ì™€ íƒ€ì„ì•„ì›ƒ ì„¤ì •
### ì„¸ì…˜ì´ ì œê³µí•˜ëŠ” ì •ë³´ë“¤ í™•ì¸í•˜ê¸° (`SessionInfoController.java` ìƒì„±)
```java
@Slf4j
@RestController
public class SessionInfoController {
    
    @GetMapping("/session-info")
    public String sessionInfo(HttpServletRequest request) {
        HttpSession session = request.getSession(false);
        if (session == null) {
            return "ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.";
        }

        //ì„¸ì…˜ ë°ì´í„° ì¶œë ¥
        session.getAttributeNames().asIterator().forEachRemaining(name -> log.info("session name={}, value={}", name, session.getAttribute(name)));

        log.info("sessionId={}", session.getId());
        log.info("getMaxInactiveInterval={}", session.getMaxInactiveInterval());
        log.info("creationTime={}", new Date(session.getCreationTime()));
        log.info("lastAccessedTime={}", new Date(session.getLastAccessedTime()));
        log.info("isNew={}", session.isNew());

        return "ì„¸ì…˜ ì¶œë ¥";
    }
}
```
- `sessionId`: ì„¸ì…˜Id, `JSESSIONID`ì˜ ê°’
- `maxInactiveInterval`: ì„¸ì…˜ì˜ ìœ íš¨ ì‹œê°„ (ì˜ˆ: 1800ì´ˆ, (30ë¶„))
- `creationTime`: ì„¸ì…˜ ìƒì„±ì¼ì‹œ
- `lastAccessedTime`: ì„¸ì…˜ê³¼ ì—°ê²°ëœ ì‚¬ìš©ìê°€ ìµœê·¼ì— ì„œë²„ì— ì ‘ê·¼í•œ ì‹œê°„, í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ `sessionId`(`JSESSIONID`)ë¥¼ ìš”ì²­í•œ ê²½ìš°ì— ê°±ì‹ ëœë‹¤.
- `isNew`: ìƒˆë¡œ ìƒì…©ëœ ì„¸ì…˜ì¸ì§€, ì•„ë‹ˆë©´ ì´ë¯¸ ê³¼ê±°ì— ë§Œë“¤ì–´ì¡Œê³ , í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ `sessionId`(`JSESSIONID`)ë¥¼ ìš”ì²­í•´ì„œ ì¡°íšŒëœ ì„¸ì…˜ì¸ì§€ ì—¬ë¶€

### ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ì„¤ì •
ì„¸ì…˜ì€ ì‚¬ìš©ìê°€ ë¡œê·¸ì•„ì›ƒì„ ì§ì ‘ í˜¸ì¶œí•´ì„œ `session.invalidate()`ê°€ í˜¸ì¶œë˜ëŠ” ê²½ìš°ì— ì‚­ì œëœë‹¤.
ê·¸ëŸ°ë° ëŒ€ë¶€ë¶„ì˜ ì‚¬ìš©ìëŠ” ë¡œê·¸ì•„ì›ƒì„ ì„ íƒí•˜ì§€ ì•Šê³ , ì›¹ ë¸Œë¼ìš°ì €ë¥¼ ì¢…ë£Œí•œë‹¤.
ë¬¸ì œëŠ” HTTPê°€ ë¹„ì—°ê²°ì„±(ConnectionLess)ì´ë¯€ë¡œ ì„œë²„ ì…ì¥ì—ì„œëŠ” í•´ë‹¹ ì‚¬ìš©ìê°€ ì›¹ ë¸Œë¼ìš°ì €ë¥¼ ì¢…ë£Œí•œ ê²ƒì¸ì§€ ì•„ë‹Œì§€ë¥¼ ì¸ì‹í•  ìˆ˜ ì—†ë‹¤.
ë”°ë¼ì„œ ì„œë²„ì—ì„œ ì„¸ì…˜ ë°ì´í„°ë¥¼ ì–¸ì œ ì‚­ì œí•´ì•¼ í•˜ëŠ”ì§€ íŒë‹¨í•˜ê¸° ì–´ë µë‹¤.
ì´ ê²½ìš° ë‚¨ì•„ìˆëŠ” ì„¸ì…˜ì„ ë¬´í•œì • ë³´ê´€í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
- ì„¸ì…˜ê³¼ ê´€ë ¨ëœ ì¿ í‚¤(`JSESSIONID`)ë¥¼ íƒˆì·¨ ë‹¹í–ˆì„ ê²½ìš° ì˜¤ëœ ì‹œê°„ì´ ì§€ë‚˜ë„ í•´ë‹¹ ì¿ í‚¤ë¡œ ì•…ì˜ì ì¸ ìš”ì²­ì„ í•  ìˆ˜ ìˆë‹¤.
- ì„¸ì…˜ì€ ê¸°ë³¸ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ì— ìƒì„±ëœë‹¤. ë©”ëª¨ë¦¬ì˜ í¬ê¸°ê°€ ë¬´í•œí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ê¼­ í•„ìš”í•œ ê²½ìš°ë§Œ ìƒì„±í•´ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

#### ì„¸ì…˜ì˜ ì¢…ë£Œ ì‹œì 
ì„¸ì…˜ì˜ ì¢…ë£Œ ì‹œì ì€ ì‚¬ìš©ìê°€ ì„œë²„ì— ìµœê·¼ì— ìš”ì²­í•œ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ 30ë¶„ ì •ë„ë¥¼ ìœ ì§€í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì‚¬ìš©ìê°€ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©´, ì„¸ì…˜ì˜ ìƒì¡´ ì‹œê°„ì´ 30ë¶„ìœ¼ë¡œ ê³„ì† ëŠ˜ì–´ë‚˜ê²Œ ëœë‹¤.
`HttpSession`ì€ ì´ ë°©ì‹ì„ ì‚¬ìš©í•œë‹¤.

#### ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ì„¤ì •
```text
[application.properties]

server.servlet.session.timeout=60
```
í•´ë‹¹ ë‚´ìš©ì€ 60ì´ˆë¡œ ì„¸íŒ…í•˜ëŠ” ê²ƒì´ê³ , ê¸°ë³¸ì€ 1800ì´ˆì´ë‹¤. (ê¸€ë¡œë²Œ ì„¤ì •ì€ ë¶„ ë‹¨ìœ„ë¡œ ì„¤ì •í•´ì•¼ í•œë‹¤.)
> ğŸ€ íŠ¹ì • ì„¸ì…˜ ë‹¨ìœ„ë¡œ ì‹œê°„ ì„¤ì •
> `session.setMaxInactiveInterval(1800);` // 1800ì´ˆ

#### ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ë°œìƒ
ì„¸ì…˜ì˜ íƒ€ì„ì•„ì›ƒ ì‹œê°„ì€ í•´ë‹¹ ì„¸ì…˜ê³¼ ê´€ë ¨ëœ `JSESSIONID`ë¥¼ ì „ë‹¬í•˜ëŠ” HTTP ìš”ì²­ì´ ìˆìœ¼ë©´ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ë‹¤ì‹œ ì´ˆê¸°í™”ëœë‹¤.
ì´ë ‡ê²Œ ì´ˆê¸°í™”ë˜ë©´ ì„¸ì…˜ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ì„¤ì •í•œ ì‹œê°„ë™ì•ˆ ì„¸ì…˜ì„ ì¶”ê°€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.  
`session.getLastAccessedTime()`: ìµœê·¼ ì„¸ì…˜ ì ‘ê·¼ ì‹œê°„  
`LastAccessedTime`ì´í›„ë¡œ timeoutì‹œê°„ì´ ì§€ë‚˜ë©´, WASê°€ ë‚´ë¶€ì—ì„œ í•´ë‹¹ ì„¸ì…˜ì„ ì œê±°í•œë‹¤.

## ì„œë¸”ë¦¿ í•„í„° - ì†Œê°œ
í˜„ì¬ ì½”ë“œëŠ”, ì‚¬ìš©ìì—ê²Œ ìƒí’ˆ ê´€ë¦¬ ë²„íŠ¼ì´ ë³´ì´ì§€ ì•Šê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ì—†ì–´ ë³´ì´ì§€ë§Œ, URL ì„ ì§ì ‘ í˜¸ì¶œí•˜ë©´ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤.  
ìƒí’ˆ ê´€ë¦¬ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” ë¡œì§ì„ í•˜ë‚˜í•˜ë‚˜ ì‘ì„±í•˜ë©´ ë˜ê² ì§€ë§Œ, ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ ì¡°ì§ì— ê³µí†µìœ¼ë¡œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ í™•ì¸í•´ì•¼ í•˜ê³ , í–¥í›„ ë¡œê·¸ì¸ê³¼ ê´€ë ¨ëœ ë¡œì§ì´ ë³€ê²½ë˜ë©´ ì‘ì„±í•œ ëª¨ë“  ë¡œì§ì„ ìˆ˜ì •í•´ì•¼ í•œë‹¤ëŠ” ë¬¸ì œì ì´ ìˆë‹¤.  
ì´ë ‡ê²Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì—¬ëŸ¬ ì¡°ì§ì—ì„œ ê³µí†µìœ¼ë¡œ ê´€ì‹¬ì´ ìˆëŠ” ê²ƒì„ ê³µí†µ ê´€ì‹¬ì‚¬(cross-cutting concern)ì´ë¼ê³  í•œë‹¤.
ì—¬ê¸°ì„œëŠ” ë“±ë¡, ìˆ˜ì •, ì‚­ì œ, ì¡°íšŒ ë“±ë“± ì—¬ëŸ¬ ë¡œì§ì—ì„œ ê³µí†µìœ¼ë¡œ ì¸ì¦ì— ëŒ€í•´ì„œ ê´€ì‹¬ì„ ê°€ì§€ê³  ìˆë‹¤.  
ì´ëŸ¬í•œ ê³µí†µ ê´€ì‹¬ì‚¬ëŠ” ìŠ¤í”„ë§ì˜ AOPë¡œë„ í•´ê²°í•  ìˆ˜ ìˆì§€ë§Œ, ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ëŠ” `ì„œë¸”ë¦¿ í•„í„°` í˜¹ì€ `ì„œë¸”ë¦¿ ì¸í„°ì…‰í„°`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ ì²˜ë¦¬í•  ë•ŒëŠ” HTTPì˜ í—¤ë”ë‚˜ URLì˜ ì •ë³´ë“¤ì´ í•„ìš”í•œë°, ì„œë¸”ë¦¿ í•„í„°ë‚˜ ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” `HttpServletRequest`ë¥¼ ì œê³µí•œë‹¤.

### ì„œë¸”ë¦¿ í•„í„°
í•„í„°ëŠ” ì„œë¸”ë¦¿ì´ ì§€ì›í•˜ëŠ” ìˆ˜ë¬¸ì¥ì´ë‹¤. í•„í„°ì˜ íŠ¹ì„±ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
#### í•„í„° íë¦„
```text
HTTP ìš”ì²­ > WAS > í•„í„° > ì„œë¸”ë¦¿ > ì»¨íŠ¸ë¡¤ëŸ¬
```
í•„í„°ë¥¼ ì ìš©í•˜ë©´ í•„í„°ê°€ í˜¸ì¶œëœ ë‹¤ìŒì— ì„œë¸”ë¦¿ì´ í˜¸ì¶œëœë‹¤.
ê·¸ë˜ì„œ ëª¨ë“  ê³ ê°ì˜ ìš”ì²­ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ìš”êµ¬ì‚¬í•­ì´ ìˆë‹¤ë©´ í•„í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
ì°¸ê³ ë¡œ í•„í„°ëŠ” íŠ¹ì • URL íŒ¨í„´ì— ì ìš©í•  ìˆ˜ ìˆë‹¤. (`/*`ì´ë¼ê³  í•˜ë©´ ëª¨ë“  ìš”ì²­ì— í•„í„°ê°€ ì ìš©ëœë‹¤.)  
ì°¸ê³ ë¡œ ìŠ¤í”„ë§ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì—¬ê¸°ì„œ ë§í•˜ëŠ” ì„œë¸”ë¦¿ì€ ìŠ¤í”„ë§ì˜ ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ìœ¼ë¡œ ìƒê°í•˜ë©´ ëœë‹¤.

#### í•„í„° ì œí•œ
```text
ë¡œê·¸ì¸ ì‚¬ìš©ì: HTTP ìš”ì²­ > WAS > í•„í„° > ì„œë¸”ë¦¿ > ì»¨íŠ¸ë¡¤ëŸ¬
ë¹„ ë¡œê·¸ì¸ ì‚¬ìš©ì: HTTP ìš”ì²­ > WAS > í•„í„°(ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ê³  íŒë‹¨í•˜ë©´ ì„œë¸”ë¦¿ì„ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤.)
```

#### í•„í„° ì²´ì¸
```text
HTTP ìš”ì²­ > WAS > í•„í„°1 > í•„í„°2 > í•„í„°3 > ì„œë¸”ë¦¿ > ì»¨íŠ¸ë¡¤ëŸ¬
```
í•„í„°ëŠ” ì²´ì¸ìœ¼ë¡œ êµ¬ì„±ë˜ëŠ”ë°, ì¤‘ê°„ì— í•„í„°ë¥¼ ììœ ë¡­ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” í•„í„°ë¥¼ ë¨¼ì € ì ìš©í•˜ê³ , ê·¸ ë‹¤ìŒì— ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” í•„í„°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

#### í•„í„° ì¸í„°í˜ì´ìŠ¤
```java
public interface Filter {

  public void init(FilterConfig filterConfig) throws ServletException {  }

  public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {  }

  public void destroy() {  }  
}
```
í•„í„° ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ë“±ë¡í•˜ë©´ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ í•„í„°ë¥¼ ì‹±ê¸€í†¤ ê°ì²´ë¡œ ìƒì„±í•˜ê³ , ê´€ë¦¬í•œë‹¤.
- `init()`: í•„í„° ì´ˆê¸°í™” ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë  ë•Œ í˜¸ì¶œëœë‹¤.
- `doFilter()`: ê³ ê°ì˜ ìš”ì²­ì´ ì˜¬ ë•Œ ë§ˆë‹¤ í•´ë‹¹ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤. í•„í„°ì˜ ë¡œì§ì„ êµ¬í˜„í•˜ë©´ ëœë‹¤.
- `destroy()`: í•„í„° ì¢…ë£Œ ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œ í˜¸ì¶œëœë‹¤.

### ì„œë¸”ë¦¿ í•„í„° - ìš”ì²­ ë¡œê·¸
í•„í„°ê°€ ì •ë§ ìˆ˜ë¬¸ì¥ ì—­í• ì„ ì˜ í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ëª¨ë“  ìš”ì²­ì„ ë¡œê·¸ë¡œ ë‚¨ê¸°ëŠ” í•„í„°ë¥¼ ê°œë°œí•˜ê³  ì ìš©í•´ë³´ì.

#### `LogFilter.java` ìƒì„±
```java
@Slf4j
public class LogFilter implements Filter {
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        log.info("log filter init");
    }

    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        HttpServletRequest httpRequest = (HttpServletRequest) servletRequest;
        String requestURI = httpRequest.getRequestURI();
        
        String uuid = UUID.randomUUID().toString();

        try {
            log.info("REQUEST   [{}][{}]", uuid, requestURI);
            filterChain.doFilter(servletRequest, servletResponse);
        } catch (Exception e) {
            throw e;
        } finally {
            log.info("RESPONSE  [{}][{}]", uuid, requestURI);
        }
    }

    @Override
    public void destroy() {
        log.info("log filter destroy");
    }
}
```
- `public class LogFilter implements Filter`
  - í•„í„°ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„  í•„í„° ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
- `doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)`
  - HTTP ìš”ì²­ì´ ì˜¤ë©´ `doFilter`ê°€ í˜¸ì¶œëœë‹¤.
  - `ServletRequest servletRequest`ëŠ” HTTP ìš”ì²­ì´ ì•„ë‹Œ ê²½ìš°ê¹Œì§€ ê³ ë ¤í•´ì„œ ë§Œë“  ì¸í„°í˜ì´ìŠ¤ì´ë‹¤. HTTPë¥¼ ì‚¬ìš©í•˜ë©´ `HttpServletRequest httpRequest = (HttpServletRequest) servletRequest;`ì™€ ê°™ì´ ë‹¤ìš´ ìºìŠ¤íŒ…í•˜ë©´ ëœë‹¤.
- `String uuid = UUID.randomUUID().toString();`
  - HTTP ìš”ì²­ì„ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ìš”ì²­ë‹¹ ì„ì˜ì˜ `uuid`ë¥¼ ìƒì„±í•œë‹¤.
- `log.info("REQUEST   [{}][{}]", uuid, requestURI);`
  - `uuid`, `requestURI`ë¥¼ ì¶œë ¥í•œë‹¤.
- `filterChain.doFilter(servletRequest, servletResponse);`
  - ì´ ë¶€ë¶„ì´ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤. ë‹¤ìŒ í•„í„°ê°€ ìˆìœ¼ë©´ í•„í„°ë¥¼ í˜¸ì¶œí•˜ê³ , í•„í„°ê°€ ì—†ìœ¼ë©´ ì„œë¸”ë¦¿ì„ í˜¸ì¶œí•œë‹¤. **ë§Œì•½ ì´ ë¡œì§ì„ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.**

#### `WebConfig.java` ìƒì„± (í•„í„° ì„¤ì •)
```java
@Configuration
public class WebConfig {
    
    @Bean
    public FilterRegistrationBean logFilter() {
        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();
        filterRegistrationBean.setFilter(new LogFilter());
        filterRegistrationBean.setOrder(1);
        filterRegistrationBean.addUrlPatterns("/*");
        
        return filterRegistrationBean;
    }
}
```
í•„í„°ë¥¼ ë“±ë¡í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆì§€ë§Œ, ìŠ¤í”„ë§ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ `FilterRegistrationBean`ì„ ì‚¬ìš©í•´ì„œ ë“±ë¡í•˜ë©´ ëœë‹¤.
- `setFilter(new LogFilter())`: ë“±ë¡í•  í•„í„°ë¥¼ ì§€ì •í•œë‹¤.
- `setOrder(1)`: í•„í„°ëŠ” ì²´ì¸ìœ¼ë¡œ ë™ì‘í•˜ê¸°ì— ìˆœì„œê°€ í•„ìš”í•˜ë‹¤. (ë‚®ì„ ìˆ˜ë¡ ë¨¼ì € ë™ì‘)
- `addUrlPatterns("/*")`: í•„í„°ë¥¼ ì ìš©í•  URL íŒ¨í„´ì„ ì§€ì •í•œë‹¤. (í˜„ì¬ëŠ” ëª¨ë“  ìš”ì²­ì— í•„í„°ë¥¼ ì ìš©í•œë‹¤.)

> ğŸ€ URL íŒ¨í„´ì— ëŒ€í•œ ë£°ì€ í•„í„°ë„ ì„œë¸”ë¦¿ê³¼ ë™ì¼í•˜ë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ì„œë¸”ë¦¿ URL íŒ¨í„´ìœ¼ë¡œ ê²€ìƒ‰í•˜ì.

> ğŸ€ `@ServletComponentScan`, `WebFilter(filterName = "logFilter", urlPatterns = "/*")`ë¡œ í•„í„° ë“±ë¡ì´ ê°€ëŠ¥í•˜ì§€ë§Œ í•„í„° ìˆœì„œ ì¡°ì ˆì´ ì•ˆëœë‹¤. ë”°ë¼ì„œ `FilterRegistrationBean`ì„ ì‚¬ìš©í•˜ì.


#### ì‹¤í–‰ ë¡œê·¸
```text
hello.itemservice.web.filter.LogFilter   : REQUEST   [0f057e43-a652-406b-973c-72bafe3fe3e7][/items]
hello.itemservice.web.filter.LogFilter   : RESPONSE  [0f057e43-a652-406b-973c-72bafe3fe3e7][/items]
```

> ğŸ€ ì‹¤ë¬´ì—ì„œ HTTP ìš”ì²­ ì‹œ ê°™ì€ ìš”ì²­ì˜ ë¡œê·¸ì— ëª¨ë‘ ê°™ì€ ì‹ë³„ìë¥¼ ìë™ìœ¼ë¡œ ë‚¨ê¸°ëŠ” ë°©ë²•ì€ `logback mdc` ë¡œ ê²€ìƒ‰í•´ë³´ê¸°.