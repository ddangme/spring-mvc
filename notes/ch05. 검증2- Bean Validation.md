## Bean Validation ì†Œê°œ
- íŠ¹ì •í•œ êµ¬í˜„ì²´ê°€ ì•„ë‹ˆë¼ Bean Validation 2.0(JSR-380)ì´ë¼ëŠ” ê¸°ìˆ  í‘œì¤€ì´ë‹¤. ì¦‰, ê²€ì¦ ì• ë…¸í…Œì´ì…˜ê³¼ ì—¬ëŸ¬ ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ìŒì´ë‹¤. (ë§ˆì¹˜ JPAê°€ í‘œì¤€ ê¸°ìˆ ì´ê³  ê·¸ êµ¬í˜„ì²´ë¡œ í•˜ì´ë²„ë„¤ì´íŠ¸ê°€ ìˆëŠ” ê²ƒê³¼ ê°™ë‹¤.)
- êµ¬í˜„í•œ ê¸°ìˆ  ì¤‘ì— ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” êµ¬í˜„ì²´ëŠ” í•˜ì´ë²„ë„¤ì´í¬ Validatorì´ë‹¤. (ORMê³¼ëŠ” ê´€ë ¨ì´ ì—†ë‹¤.)
- ê²€ì¦ ë¡œì§ì„ ëª¨ë“  í”„ë¡œì íŠ¸ì— ì ìš©í•  ìˆ˜ ìˆê²Œ ê³µí†µí™”í•˜ê³  í‘œì¤€í™” í•œ ê²ƒ

> **ğŸ€ í•˜ì´ë²„ë„¤ì´íŠ¸ Validator ê´€ë ¨ ë§í¬**  
> - [ê³µì‹ ì‚¬ì´íŠ¸](http://hibernate.org/validator/)
> - [ê³µì‹ ë©”ë‰´ì–¼](https://docs.jboss.org/hibernate/validator/6.2/reference/en-US/html_single/)
> - [ê²€ì¦ ì• ë…¸í…Œì´ì…˜ ëª¨ìŒ](https://docs.jboss.org/hibernate/validator/6.2/reference/en-US/html_single/#validator-defineconstraints-spec)

## ìˆœìˆ˜í•œ Bean Validation ì‚¬ìš©ë²•
### Bean Validation ì˜ì¡´ê´€ê³„ ì¶”ê°€
```properties
[build.gradle]

implementation 'org.springframework.boot:spring-boot-starter-validation'
```
`spring-boot-starter-validation` ì˜ì¡´ê´€ê³„ë¥¼ ì¶”ê°€í•˜ë©´ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¶”ê°€ëœë‹¤.
#### Jakarta Bean Validation
- `jakarta.validation-api`: Bean Validation ì¸í„°í˜ì´ìŠ¤
- `hibernate-validator`: êµ¬í˜„ì²´

### í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±
1. `Item.java` ìˆ˜ì •í•˜ê¸°
```java
@Data
public class Item {

    private Long id;
    
    @NotBlank
    private String itemName;
    
    @NotNull
    @Range(min = 1_000, max = 1_000_000)
    private Integer price;
    
    @NotNull
    @Max(9_999)
    private Integer quantity;

    public Item() {
    }

    public Item(String itemName, Integer price, Integer quantity) {
        this.itemName = itemName;
        this.price = price;
        this.quantity = quantity;
    }
}
```
**ê²€ì¦ ì• ë…¸í…Œì´ì…˜**
- `@NotBlank`: ë¹ˆê°’ + ê³µë°±ë§Œ ìˆëŠ” ê²½ìš°ë¥¼ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- `@NotNull`: `null`ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- `@Range(min = 1, max = 100)`: ë²”ìœ„ ì•ˆì˜ ê°’ì´ì–´ì•¼ í•œë‹¤.
- `@Max(999)`: í•´ë‹¹ ìˆ«ì ì´ìƒì˜ ê°’ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.

> ğŸ€ì°¸ê³   
> `javax.validation.constraints.NotNull`  
> `org.hibernate.validator.constraints.Range`  
>   
> `javax.validation`ìœ¼ë¡œ ì‹œì‘í•˜ë©´ íŠ¹ì • êµ¬í˜„ì— ê´€ê³„ì—†ì´ ì œê³µë˜ëŠ” í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ì´ê³ ,   
> `org.hibernate.validator`ë¡œ ì‹œì‘í•˜ë©´ í•˜ì´ë²„ë„¤ì´íŠ¸ validator êµ¬í˜„ì²´ë¥¼ ì‚¬ìš©í•  ë•Œë§Œ ì œê³µë˜ëŠ” ê²€ì¦ê¸°ëŠ¥ì´ë‹¤.
2. BeanValidationTest - Bean Validation í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±
```java
public class BeanValidationTest {

    @Test
    void beanValidation() {
        // ê²€ì¦ê¸° ìƒì„±
        ValidatorFactory factory = Validation.buildDefaultValidatorFactory();
        Validator validator = factory.getValidator();

        Item item = new Item();
        item.setItemName("   ");
        item.setPrice(0);
        item.setQuantity(10_000);

        // ê²€ì¦ ì‹¤í–‰
        Set<ConstraintViolation<Item>> violations = validator.validate(item);

        for (ConstraintViolation<Item> violation : violations) {
            System.out.println("violation = " + violation);
            System.out.println("violation.message = " + violation.getMessage());
        }
    }
}
```
- ê²€ì¦ ì‹¤í–‰
  - ê²€ì¦ ëŒ€ìƒ(`item`)ì„ ì§ì ‘ ê²€ì¦ê¸°ì— ë„£ê³  ê·¸ ê²°ê³¼ë¥¼ ë°›ëŠ”ë‹¤. `Set`ì—ëŠ” `ConstraintViolation`ì´ë¼ëŠ” ê²€ì¦ ì˜¤ë¥˜ê°€ ë‹´ê¸´ë‹¤.
ë”°ë¼ì„œ ê²°ê³¼ê°€ ë¹„ì–´ìˆìœ¼ë©´ ê²€ì¦ ì˜¤ë¥˜ê°€ ì—†ëŠ” ê²ƒì´ë‹¤.
- ì‹¤í–‰ ê²°ê³¼
    ```text
    violation={interpolatedMessage='ê³µë°±ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', propertyPath=itemName, rootBeanClass=class hello.itemservice.domain.item.Item, messageTemplate='{javax.validation.constraints.NotBlank.message}'}
    violation.message=ê³µë°±ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
    
    violation={interpolatedMessage='9999 ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤', propertyPath=quantity, rootBeanClass=class hello.itemservice.domain.item.Item, messageTemplate='{javax.validation.constraints.Max.message}'}
    violation.message=9999 ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤
    
    violation={interpolatedMessage='1000ì—ì„œ 1000000 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤', propertyPath=price, rootBeanClass=class hello.itemservice.domain.item.Item, messageTemplate='{org.hibernate.validator.constraints.Range.message}'}
    violation.message=1000ì—ì„œ 1000000 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤
    ```
    - `ConstraintViolation` ì¶œë ¥ ê²°ê³¼ë¥¼ ë³´ë©´, ê²€ì¦ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê°ì²´, í•„ë“œ, ë©”ì‹œì§€ ì •ë³´ ë“± ë‹¤ì–‘í•œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

> ğŸ€ ì°¸ê³   
> íŠ¹ì • í•„ë“œì˜ ë²”ìœ„ë¥¼ ë„˜ì–´ì„œëŠ” ê²€ì¦(ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ 10,000ì› ì´ìƒ) ê¸°ëŠ¥ì´ ë¹ ì¡ŒëŠ”ë°, ì´ ë¶€ë¶„ì€ ë’¤ì—ì„œ ì„¤ëª…í•œë‹¤.

## ìŠ¤í”„ë§ Bean Validation ì ìš©
### ìŠ¤í”„ë§ MVCëŠ” ì–´ë–»ê²Œ Bean Validatorë¥¼ ì‚¬ìš©í• ê¹Œ?
- ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ `spring-boot-starter-validation` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë„£ìœ¼ë©´ ìë™ìœ¼ë¡œ Bean Validatorë¥¼ ì¸ì§€í•˜ê³  ìŠ¤í”„ë§ì— í†µí•©í•œë‹¤.
- ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ìë™ìœ¼ë¡œ ê¸€ë¡œë²Œ Validatorë¡œ ë“±ë¡í•œë‹¤.
  - `LocalValidatorFactoryBean`ì„ ê¸€ë¡œë²Œ Validatorë¡œ ë“±ë¡í•œë‹¤. ì´ ValidatorëŠ” `@NotNull`ê°™ì€ ì• ë…¸í…Œì´ì…˜ì„ ë³´ê³  ê²€ì¦ì„ ìˆ˜í–‰í•œë‹¤.
ì´ë ‡ê²Œ ê¸€ë¡œë²Œ Validatorê°€ ì ìš©ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—, `@Valid`, `@Validated`ë§Œ ì ìš©í•˜ë©´ ëœë‹¤.
  - ê²€ì¦ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´, `FieldError`, `ObjectError`ë¥¼ ìƒì„±í•´ì„œ `BindingResult`ì— ë‹´ì•„ì¤€ë‹¤.

> ğŸš¨ ì£¼ì˜  
> ì§ì ‘ ê¸€ë¡œë²Œ Validatorë¥¼ ì§ì ‘ ë“±ë¡í•˜ë©´ ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” Bean Validatorë¥¼ ê¸€ë¡œë²Œ `Validator`ë¡œ ë“±ë¡í•˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ì˜ ë¹ˆ ê²€ì¦ê¸°ê°€ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.

> ğŸ€ ì°¸ê³   
> ê²€ì¦ ì‹œ `@Validated`, `@Valid` ë‘˜ë‹¤ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.  
> `javax.validation.@Valid`ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ `build.gradle`ì— ì˜ì¡´ê´€ê³„ ì¶”ê°€ê°€ í•„ìš”í•˜ë‹¤.  
> `@Validated`ëŠ” ìŠ¤í”„ë§ ì „ìš© ê²€ì¦ ì• ë…¸í…Œì´ì…˜ì´ê³ , `@Valid`ëŠ” ìë°” í‘œì¤€ ê²€ì¦ ì• ë…¸í…Œì´ì…˜ì´ë‹¤. ë‘˜ì¤‘ ì•„ë¬´ê±°ë‚˜ ì‚¬ìš©í•´ë„ ë™ì¼í•˜ê²Œ ì‘ë™í•˜ì§€ë§Œ, `@Validated`ëŠ” ë‚´ë¶€ì— `groups`ë¼ëŠ” ê¸°ëŠ¥ì„ í¬í•¨í•˜ê³  ìˆë‹¤.

### ê²€ì¦ ìˆœì„œ
1. `@ModelAttribute` ê°ê°ì˜ í•„ë“œì— íƒ€ì… ë³€í™˜ ì‹œë„
   1. ì„±ê³µí•˜ë©´ ë‹¤ìŒìœ¼ë¡œ
   2. ì‹¤íŒ¨í•˜ë©´ `typeMismatch`ë¡œ `FieldError` ì¶”ê°€ 
2. Validator ì ìš©

### ë°”ì¸ë”©ì— ì„±ê³µí•œ í•„ë“œë§Œ Bean Validation ì ìš©
BeanValidatorëŠ” ë°”ì¸ë”©ì— ì‹¤íŒ¨í•œ í•„ë“œëŠ” BeanValidationì„ ì ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.  
`@ModelAttribute` -> ê°ê°ì˜ í•„ë“œ íƒ€ì… ë³€í™˜ì‹œë„ -> **ë³€í™˜ì— ì„±ê³µí•œ í•„ë“œë§Œ BeanValidation ì ìš©**  

## Bean Validation ì—ëŸ¬ ì½”ë“œ
Bean Validationì´ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ìì„¸íˆ ë³€ê²½í•˜ê³  ì‹¶ë‹¤ë©´?  
Bean Validationì„ ì ìš©í•˜ê³  `bindingResult`ì— ë“±ë¡ëœ ê²€ì¦ ì˜¤ë¥˜ ì½”ë“œë¥¼ ë³´ì.  
ì˜¤ë¥˜ ì½”ë“œê°€ ì• ë…¸í…Œì´ì…˜ ì´ë¦„ìœ¼ë¡œ ë“±ë¡ëœë‹¤. ë§ˆì¹˜ `typeMismatch`ì™€ ìœ ì‚¬í•˜ë‹¤.  
`NotBlank`ë¼ëŠ” ì˜¤ë¥˜ ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ `MessageCodesResolver`ë¥¼ í†µí•´ ë‹¤ì–‘í•œ ë©”ì‹œì§€ ì½”ë“œê°€ ìˆœì„œëŒ€ë¡œ ìƒì„±ëœë‹¤.

### @NotBlank
- NotBlank.item.itemName
- NotBlank.itemName
- NotBlank.java.lang.String
- NotBlank

### @Range
- Range.item.price
- Range.price
- Range.java.lang.Integer
- Range

### ë©”ì‹œì§€ ë“±ë¡
```properties
[errors.properties]

#Bean Validation ì¶”ê°€
NotBlank={0} ê³µë°±X
Range={0}, {2} ~ {1} í—ˆìš©
Max={0}, ìµœëŒ€ {1}
```
- `{0}`ì€ í•„ë“œëª…ì´ê³ , `{1}`, `{2}`...ì€ ê° ì• ë…¸í…Œì´ì…˜ ë§ˆë‹¤ ë‹¤ë¥´ë‹¤.

### Bean Validation ë©”ì‹œì§€ ì°¾ëŠ” ìˆœì„œ
1. ìƒì„±ëœ ë©”ì‹œì§€ ì½”ë“œ ìˆœì„œëŒ€ë¡œ `messageSource`ì—ì„œ ì°¾ê¸°
2. ì• ë…¸í…Œì´ì…˜ì˜ `message` ì†ì„± ì‚¬ìš© -> `@NotBlank(message = "ê³µë°±! {0}")
3. ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì œê³µí•˜ëŠ” ê¸°ë³¸ ê°’ ì‚¬ìš© -> ê³µë°±ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

### ì• ë…¸í…Œì´ì…˜ì˜ message ì‚¬ìš© ì˜ˆ
```java
@NotBlank(message = "ê³µë°±ì€ ì…ë ¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
private String itemName;
```

## Bean Validation - ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜
Bean Validationì—ì„œ íŠ¹ì • í•„ë“œ(`FieldError`)ê°€ ì•„ë‹Œ í•´ë‹¹ ì˜¤ë¸Œì íŠ¸ ê´€ë ¨ ì˜¤ë¥˜(`ObjectError`)ëŠ” ì–´ë–»ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆì„ê¹Œ?  
ë‹¤ìŒê³¼ ê°™ì´ `@ScriptAssert()`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
```java
@Data
@ScriptAssert(lang = "javascript", script = "_this.price * _this.quantity >= 10000")
public class Item {
    //...
}
```
ì‹¤í–‰í•´ë³´ë©´ ì •ìƒ ìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë©”ì‹œì§€ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ìƒì„±ëœë‹¤.
- `ScriptAssert.item`
- `ScriptAssert`  

ê·¸ëŸ°ë° ì‹¤ì œ ì‚¬ìš©í•´ë³´ë©´ ì œì•½ì´ ë§ê³  ë³µì¡í•˜ë‹¤. ê·¸ë¦¬ê³  ì‹¤ë¬´ì—ì„œëŠ” ê²€ì¦ ê¸°ëŠ¥ì´ í•´ë‹¹ ê°ì²´ì˜ ë²”ìœ„ë¥¼ ë„˜ì–´ì„œëŠ” ê²½ìš°ë“¤ë„ ìˆê¸° ë•Œë¬¸ì—, ê·¸ëŸ° ê²½ìš° ëŒ€ì‘ì´ ì–´ë µë‹¤.  
ë”°ë¼ì„œ ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜(ê¸€ë¡œë²Œ ì˜¤ë¥˜)ì˜ ê²½ìš° `@ScriptAssert`ë¥¼ ì–µì§€ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒ ë³´ë‹¤ ë‹¤ìŒê³¼ ê°™ì´ ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜ ê´€ë ¨ ë¶€ë¶„ë§Œ ì§ì ‘ ìë°” ì½”ë“œë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.
```java
public String addItem(@Validated @ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes) {
    // íŠ¹ì • í•„ë“œ ì˜ˆì™¸ê°€ ì•„ë‹Œ ì „ì²´ ì˜ˆì™¸
    if (item.getPrice() != null && item.getQuantity() != null) {
        int resultPrice = item.getPrice() * item.getQuantity();

        if (resultPrice < 10_000) {
            bindingResult.reject("totalPriceMin", new Object[]{10_000, resultPrice}, null);
        }
    }
    
    //ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
    if (bindingResult.hasErrors()) {
        log.info("errors={} ", bindingResult);
        return "items/addForm";
    }

    //ì„±ê³µ ë¡œì§
    Item savedItem = itemRepository.save(item);
    redirectAttributes.addAttribute("itemId", savedItem.getId());
    redirectAttributes.addAttribute("status", true);
    return "redirect:/items/items/{itemId}";
}
```

## Bean Validation - ìˆ˜ì • í˜ì´ì§€ì— ì ìš©
### ValidationItemController - edit() ë³€ê²½
```java
public String edit(@PathVariable Long itemId, @Validated @ModelAttribute Item item, BindingResult bindingResult) {
    // íŠ¹ì • í•„ë“œ ì˜ˆì™¸ê°€ ì•„ë‹Œ ì „ì²´ ì˜ˆì™¸
    if (item.getPrice() != null && item.getQuantity() != null) {
        int resultPrice = item.getPrice() * item.getQuantity();

        if (resultPrice < 10_000) {
            bindingResult.reject("totalPriceMin", new Object[]{10_000, resultPrice}, null);
        }
    }

    if (bindingResult.hasErrors()) {
        log.info("errors={}", bindingResult);
        return "items/editForm";

    }
    itemRepository.update(itemId, item);
    return "redirect:/items/items/{itemId}";
}
```

### items/editForm.html ë³€ê²½
[editForm.html](src%2Fmain%2Fresources%2Ftemplates%2Fvalidation%2FeditForm.html)

## Bean Validationì˜ í•œê³„
ìˆ˜ì • ì‹œ ê²€ì¦ ìš”êµ¬ì‚¬í•­  
ë°ì´í„°ë¥¼ ë“±ë¡í•  ë•Œì™€ ìˆ˜ì •í•  ë•ŒëŠ” ìš”êµ¬ì‚¬í•­ì´ ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤.

#### ë“±ë¡ ê¸°ì¡´ ìš”êµ¬ì‚¬í•­
- íƒ€ì… ê²€ì¦
  - ê°€ê²©, ìˆ˜ëŸ‰ì— ë¬¸ìê°€ ë“¤ì–´ê°€ë©´ ê²€ì¦ ì˜¤ë¥˜ ì²˜ë¦¬
- í•„ë“œ ê²€ì¦
  - ìƒí’ˆëª…: í•„ìˆ˜, ê³µë°± X
  - ê°€ê²©: 1,000ì› ì´ìƒ, 1,000,000ì› ì´í•˜
  - ìˆ˜ëŸ‰: ìµœëŒ€ 9,999
- íŠ¹ì • í•„ë“œì˜ ë²”ìœ„ë¥¼ ë„˜ì–´ì„œëŠ” ê²€ì¦
  - ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ 10,000ì› ì´ìƒ

#### ìˆ˜ì • ìš”êµ¬ì‚¬í•­
- id: í•„ìˆ˜
- ìˆ˜ëŸ‰: ë¬´ì œí•œ
> ğŸ€ ì°¸ê³   
> í˜„ì¬ êµ¬ì¡°ì—ì„œëŠ” ìˆ˜ì • ì‹œ `item`, `id` ê°’ì€ í•­ìƒ ë“¤ì–´ìˆë„ë¡ ë¡œì§ì´ êµ¬ì„±ë˜ì–´ ìˆë‹¤. ê²€ì¦í•˜ì§€ ì•Šì•„ë„ ë  ê²ƒê°™ì§€ë§Œ, 
> HTTP ìš”ì²­ì€ ì–¸ì œë“ ì§€ ì•…ì˜ì ìœ¼ë¡œ ë³€ê²½í•´ì„œ ìš”ì²­í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì„œë²„ì—ì„œ í•­ìƒ ê²€ì¦í•´ì•¼ í•œë‹¤. ë”°ë¼ì„œ ìµœì¢… ê²€ì¦ì€ ì„œë²„ì—ì„œ ì§„í–‰í•˜ëŠ” ê²ƒì´ ì•ˆì „í•˜ë‹¤.

### ìˆ˜ì • ìš”êµ¬ì‚¬í•­ ì ìš©
ìˆ˜ì • ìš”êµ¬ì‚¬í•­ì„ ì ìš©í•˜ê¸° ìœ„í•´ `Item.java`ë¥¼ ìˆ˜ì •í•˜ê²Œ ë˜ë©´, ë“±ë¡ì—ì„œ ë¬¸ì œê°€ ë°œìƒí•œë‹¤. ì¦‰, `item`ì€ ë“±ë¡ê³¼ ìˆ˜ì •ì—ì„œ ê²€ì¦ ì¡°ê±´ì˜ ì¶©ëŒì´ ë°œìƒí•˜ê³ ,
ë“±ë¡ê³¼ ìˆ˜ì •ì€ ê°™ì€ BeanValidationì„ ì ìš©í•  ìˆ˜ ì—†ë‹¤. 

## Form ì „ì†¡ ê°ì²´ ë¶„ë¦¬
ì‹¤ë¬´ì—ì„œëŠ” ë“±ë¡ ì‹œ í¼ì—ì„œ ì „ë‹¬í•˜ëŠ” ë°ì´í„°ê°€ ë„ë©”ì¸ ê°ì²´ì™€ ë”± ë§ì§€ ì•ŠëŠ”ë‹¤. (ì˜ˆ: íšŒì› ë“±ë¡ ì‹œ íšŒì›ê³¼ ê´€ë ¨ëœ ë°ì´í„°ë§Œ ì „ë‹¬ë°›ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì•½ê´€ ì •ë³´ë„ ì¶”ê°€ë¡œ ë°›ëŠ” ë“± ë„ë©”ì¸ê³¼ ê´€ê³„ì—†ëŠ” ìˆ˜ ë§ì€ ë¶€ê°€ ë°ì´í„°ê°€ ë„˜ì–´ì˜¨ë‹¤.)  
ê·¸ë˜ì„œ ë³´í†µ ë„ë©”ì¸ì„ ì§ì ‘ ì „ë‹¬ë°›ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë³µì¡í•œ í¼ì˜ ë°ì´í„°ë¥¼ ì»¨íŠ¸ë¡¤ëŸ¬ê¹Œì§€ ì „ë‹¬í•  ë³„ë„ì˜ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ì „ë‹¬í•œë‹¤.
ì˜ˆë¥¼ ë“¤ë©´ `ItemSaveForm`ì´ë¼ëŠ” í¼ì„ ì „ë‹¬ë°›ëŠ” ì „ìš© ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ `@ModelAttribute`ë¡œ ì‚¬ìš©í•œë‹¤. ì´ê²ƒì„ í†µí•´ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ í¼ ë°ì´í„°ë¥¼ ì „ë‹¬ë°›ê³ , ì´í›„ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ `Item`ì„ ìƒì„±í•œë‹¤.

### í¼ ë°ì´í„° ì „ë‹¬ì— Item ë„ë©”ì¸ ê°ì²´ ì‚¬ìš©
`HTML Form -> Item -> Controller -> Item > Repository`  
- ì¥ì : Item ë„ë©”ì¸ ê°ì²´ë¥¼ ì»¨íŠ¸ë¡¤ëŸ¬, ë¦¬í¬ì§€í† ë¦¬ê¹Œì§€ ì§ì ‘ ì „ë‹¬í•˜ì—¬ ì¤‘ê°„ì— Itemì„ ë§Œë“œëŠ” ê³¼ì •ì´ ì—†ë‹¤.
- ë‹¨ì : ê°„ë‹¨í•œ ê²½ìš°ì—ë§Œ ì ìš©í•  ìˆ˜ ìˆë‹¤. ìˆ˜ì • ì‹œ ê²€ì¦ì´ ì¤‘ë³µë  ìˆ˜ ìˆê³ , groupsë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

### í¼ ë°ì´í„° ì „ë‹¬ì„ ìœ„í•œ ë³„ë„ì˜ ê°ì²´ ì‚¬ìš©
`HTML Form -> ItemSaveForm -> Controller -> Item ìƒì„± -> Repository`
- ì¥ì : ì „ì†¡í•˜ëŠ” í¼ ë°ì´í„°ê°€ ë³µì¡í•´ë„ ê±°ê¸°ì— ë§ì¶˜ ë³„ë„ì˜ í¼ ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ ë°ì´í„°ë¥¼ ì „ë‹¬ ë°›ì„ ìˆ˜ ìˆë‹¤. ë³´í†µ ë“±ë¡ê³¼ ìˆ˜ì •ìš©ìœ¼ë¡œ ë³„ë„ì˜ í¼ ê°ì²´ë¥¼ ë§Œë“¤ê¸° ë•Œë¬¸ì— ê²€ì¦ì´ ì¤‘ë³µë˜ì§€ ì•ŠëŠ”ë‹¤.
- ë‹¨ì : í¼ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ Item ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ë³€í™˜ ê³¼ì •ì´ ì¶”ê°€ëœë‹¤.

> ğŸ€ ì´ë¦„ì€ ì–´ë–»ê²Œ ì§€ì–´ì•¼ í• ê¹Œ?  
> ì˜ë¯¸ìˆê²Œ ì§€ìœ¼ë©´ ëœë‹¤. `ItemSave`, `ItemSaveForm`, `ItemSaveRequest`, `ItemSaveDto` ë“±ìœ¼ë¡œ ì‚¬ìš©í•´ë„ ë˜ì§€ë§Œ, ì¼ê´€ë˜ê²Œ ì§€ì–´ì•¼ í•œë‹¤.

## ì ìš©í•˜ê¸°
1. `Item.java` ì›ë³µ
```java
@Data
public class Item {

    private Long id;
    private String itemName;
    private Integer price;
    private Integer quantity;

    public Item() {
    }

    public Item(String itemName, Integer price, Integer quantity) {
        this.itemName = itemName;
        this.price = price;
        this.quantity = quantity;
    }
}
```
2. `ItemSaveForm.java` ìƒì„±
```java
@Data
public class ItemSaveForm {

    @NotBlank
    private String itemName;

    @NotNull
    @Range(min = 1000, max = 1000000)
    private Integer price;

    @NotNull
    @Max(value = 9999)
    private Integer quantity;
}
```
3. `ItemUpdateForm.java` ìƒì„±
```java
@Data
public class ItemUpdateForm {

    @NotNull
    private Long id;

    @NotBlank
    private String itemName;

    @NotNull
    @Range(min = 1000, max = 1000000)
    private Integer price;
    
    private Integer quantity;
}
```
4. `ValidationItemController.java` ìˆ˜ì •
```java
public class ValidationItemController {
    //...
  
    @PostMapping("/add")
    public String addItem(@Validated @ModelAttribute("item") ItemSaveForm form, BindingResult bindingResult, RedirectAttributes redirectAttributes) {

      //íŠ¹ì • í•„ë“œê°€ ì•„ë‹Œ ë³µí•© ë£° ê²€ì¦
      if (form.getPrice() != null && form.getQuantity() != null) {
        int resultPrice = form.getPrice() * form.getQuantity();
        if (resultPrice < 10000) {
          bindingResult.reject("totalPriceMin", new Object[]{10000, resultPrice}, null);
        }
      }

      //ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
      if (bindingResult.hasErrors()) {
        log.info("errors={} ", bindingResult);
        return "items/addForm";
      }

      //ì„±ê³µ ë¡œì§
      Item item = new Item(form.getItemName(), form.getPrice(), form.getQuantity());

      Item savedItem = itemRepository.save(item);
      redirectAttributes.addAttribute("itemId", savedItem.getId());
      redirectAttributes.addAttribute("status", true);
      return "redirect:/items/items/{itemId}";
    }
    
    //...

  @PostMapping("/{itemId}/edit")
  public String edit(@PathVariable Long itemId, @Validated @ModelAttribute("item") ItemUpdateForm form, BindingResult bindingResult) {

    //íŠ¹ì • í•„ë“œê°€ ì•„ë‹Œ ë³µí•© ë£° ê²€ì¦
    if (form.getPrice() != null && form.getQuantity() != null) {
      int resultPrice = form.getPrice() * form.getQuantity();
      if (resultPrice < 10000) {
        bindingResult.reject("totalPriceMin", new Object[]{10000, resultPrice}, null);
      }
    }

    if (bindingResult.hasErrors()) {
      log.info("errors={}", bindingResult);
      return "items/editForm";
    }

    Item itemParam = new Item(form.getItemName(), form.getPrice(), form.getQuantity());

    itemRepository.update(itemId, itemParam);
    return "redirect:/items/items/{itemId}";
  }
  
    //...
}
```

> ğŸš¨ ì£¼ì˜  
> `@ModelAttribute("item")`ì— `item` ì´ë¦„ì„ ë„£ì–´ì¤€ ë¶€ë¶„ì„ ì£¼ì˜í•˜ì. ì´ê²ƒì„ ë„£ì§€ ì•Šìœ¼ë©´ `ItemSaveForm`ì˜ ê²½ìš° ê·œì¹™ì— ì˜í•´
> `itemSaveForm`ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ MVC Model ì— ë‹´ê¸°ê²Œ ëœë‹¤. ì´ë ‡ê²Œ ë˜ë©´ ë·° í…œí”Œë¦¿ì—ì„œ ì ‘ê·¼í•œ `th:object` ì´ë¦„ë„ ë³€ê²½í•´ì£¼ì–´ì•¼ í•œë‹¤.  
> **ì¦‰, html íŒŒì¼ì—ì„œ ì´ë¦„ì„ ëª¨ë‘ itemSaveFormìœ¼ë¡œ ì„¤ì •í•˜ê±°ë‚˜, ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ @ModelAttribute("item") ì²˜ëŸ¼ ì´ë¦„ì„ ë³€ê²½í•´ì£¼ë©´ ëœë‹¤.** 


## Bean Validation - HTTP ë©”ì‹œì§€ ì»¨ë²„í„°
`@Valid`, `@Validated`ëŠ” `httpMessageConverter`(`@RequestBody`)ì—ë„ ì ìš©í•  ìˆ˜ ìˆë‹¤.

> ğŸ€ ì°¸ê³   
> `@ModelAttribute`ëŠ” HTTP ìš”ì²­ íŒŒë¼ë¯¸í„°(URL ì¿¼ë¦¬ ìŠ¤íŠ¸ë§, POST Form)ì„ ë‹¤ë£° ë•Œ ì‚¬ìš©í•œë‹¤.  
> `@RequestBody`ëŠ” HTTP Bodyì˜ ë°ì´í„°ë¥¼ ê°ì²´ë¡œ ë³€í™˜í•  ë•Œ ì‚¬ìš©í•œë‹¤. ì£¼ë¡œ API JSON ìš”ì²­ì„ ë‹¤ë£° ë•Œ ì‚¬ìš©í•œë‹¤.

### `ValidationItemApiController.java` ìƒì„±
```java
@Slf4j
@RestController
@RequestMapping("/items/api/items")
public class ValidationItemApiController {

    @PostMapping("/add")
    public Object addItem(@RequestBody @Validated ItemSaveForm form, BindingResult bindingResult) {
        log.info("API ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ");

        if (bindingResult.hasErrors()) {
            log.info("ê²€ì¦ ì˜¤ë¥˜ ë°œìƒ errors={}", bindingResult);
            return bindingResult.getAllErrors();
        }
        
        log.info("ì„±ê³µ ë¡œì§ ì‹¤í–‰");
        return form;
    }
    
}
```

### APIì˜ ê²½ìš° 3ê°€ì§€ ê²½ìš°ë¥¼ ë‚˜ëˆ„ì–´ ìƒê°í•´ì•¼ í•œë‹¤.
- ì„±ê³µ ìš”ì²­: ì„±ê³µ
- ì‹¤íŒ¨ ìš”ì²­: JSONì„ ê°ì²´ë¡œ ìƒì„±í•˜ëŠ” ê²ƒ ìì²´ê°€ ì‹¤íŒ¨
- ê²€ì¦ ì˜¤ë¥˜ ìš”ì²­: JSONì„ ê°ì²´ë¡œ ìƒì„±í•˜ëŠ” ê²ƒì€ ì„±ê³µ, ê²€ì¦ì—ì„œ ì‹¤íŒ¨

### ì„±ê³µ ìš”ì²­
```text
POST http://localhost:8080/items/api/items/add

{"itemName":"hello", "price":1000, "quantity": 10}
```
> ğŸ€ Postmanì—ì„œ Body > raw > JSONì„ ì„ íƒí•´ì•¼ í•œë‹¤.

#### ì„±ê³µ ìš”ì²­ ë¡œê·¸
```text
API ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ
ì„±ê³µ ë¡œì§ ì‹¤í–‰
```

### ì‹¤íŒ¨ ìš”ì²­
```text
POST http://localhost:8080/items/api/items/add

{"itemName":"hello", "price":"a", "quantity": 10}
```
`price`ì˜ ê°’ì´ ìˆ«ìê°€ ì•„ë‹Œ ë¬¸ìë¥¼ ì…ë ¥í•˜ì—¬ ì‹¤íŒ¨í•˜ê²Œ ë§Œë“¤ê¸°

#### ì‹¤íŒ¨ ìš”ì²­ ê²°ê³¼
```text
{
    "timestamp": "2024-04-04T10:43:53.658+00:00",
    "status": 400,
    "error": "Bad Request",
    "message": "",
    "path": "/items/api/items/add"
}
```

#### ì‹¤íŒ¨ ìš”ì²­ ë¡œê·¸
```text
.w.s.m.s.DefaultHandlerExceptionResolver : Resolved [org.springframework.http.converter.HttpMessageNotReadableException: JSON parse error: Cannot deserialize value of type `java.lang.Integer` from String "a": not a valid Integer value; nested exception is com.fasterxml.jackson.databind.exc.InvalidFormatException: Cannot deserialize value of type `java.lang.Integer` from String "a": not a valid Integer value at [Source: (PushbackInputStream); line: 1, column: 30] (through reference chain: hello.itemservice.web.validation.form.ItemSaveForm["price"])]
```
`HttpMessageConverter`ì—ì„œ ìš”ì²­ JSONì„ `ItemSaveForm` ê°ì²´ë¡œ ìƒì„±í•˜ëŠ”ë° ì‹¤íŒ¨í•œë‹¤.
ì´ ê²½ìš°ëŠ” `ItemSaveForm`ê°ì²´ë¥¼ ë§Œë“¤ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì— ì»¨íŠ¸ë¡¤ëŸ¬ ìì²´ê°€ í˜¸ì¶œë˜ì§€ ì•Šê³  ê·¸ ì „ì— ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤. ë¬¼ë¡  Validatorë„ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.

### ê²€ì¦ ì˜¤ë¥˜ ìš”ì²­
`HttpMessageConverter`ëŠ” ì„±ê³µí•˜ì§€ë§Œ ê²€ì¦(Validator)ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°
```text
POST http://localhost:8080/items/api/items/add

{"itemName":"hello", "price":1000, "quantity": 10000}
```

#### ê²€ì¦ ì˜¤ë¥˜ ê²°ê³¼
```text
[
    {
        "codes": [
            "Max.itemSaveForm.quantity",
            "Max.quantity",
            "Max.java.lang.Integer",
            "Max"
        ],
        "arguments": [
            {
                "codes": [
                    "itemSaveForm.quantity",
                    "quantity"
                ],
                "arguments": null,
                "defaultMessage": "quantity",
                "code": "quantity"
            },
            9999
        ],
        "defaultMessage": "9999 ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤",
        "objectName": "itemSaveForm",
        "field": "quantity",
        "rejectedValue": 10000,
        "bindingFailure": false,
        "code": "Max"
    }
]
```
`return bindingResult.getAllErrors();`ëŠ” `ObjectError`ì™€ `FieldError`ë¥¼ ë°˜í™˜í•œë‹¤.
ìŠ¤í”„ë§ì´ ì´ ê°ì²´ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•´ì„œ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬í–ˆë‹¤.
ì—¬ê¸°ì„œëŠ” ì—ì‹œë¡œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ê²€ì¦ ì˜¤ë¥˜ ê°ì²´ë“¤ì„ ê·¸ëŒ€ë¡œ ë°˜í™˜í–ˆë‹¤. ì‹¤ì œ ê°œë°œí•  ë•ŒëŠ” ì´ ê°ì²´ë“¤ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šê³ , í•„ìš”í•œ ë°ì´í„°ë§Œ ë½‘ì•„ì„œ ë³„ë„ì˜ API ìŠ¤í™ì„ ì •ì˜í•˜ê³  ê·¸ì— ë§ëŠ” ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ë°˜í™˜í•´ì•¼ í•œë‹¤.

#### ê²€ì¦ ì˜¤ë¥˜ ìš”ì²­ ë¡œê·¸
```text
API ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ
h.i.w.v.ValidationItemApiController      : ê²€ì¦ ì˜¤ë¥˜ ë°œìƒ errors=org.springframework.validation.BeanPropertyBindingResult: 1 errors Field error in object 'itemSaveForm' on field 'quantity': rejected value [10000]; codes [Max.itemSaveForm.quantity,Max.quantity,Max.java.lang.Integer,Max]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [itemSaveForm.quantity,quantity]; arguments []; default message [quantity],9999]; default message [9999 ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤]
```

ë¡œê·¸ë¥¼ ë³´ë©´ ê²€ì¦ ì˜¤ë¥˜ê°€ ì •ìƒ ìˆ˜í–‰ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### `@ModelAttribute` vs `@RequestBody`
HTTP ìš”ì²­ íŒŒë¼ë¯¸í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” `@ModelAttribute`ëŠ” ê°ê°ì˜ í•„ë“œ ë‹¨ìœ„ë¡œ ì„¸ë°€í•˜ê²Œ ì ìš©ëœë‹¤. ê·¸ë˜ì„œ íŠ¹ì • í•„ë“œì— íƒ€ì…ì´ ë§ì§€ ì•ŠëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ë‚˜ë¨¸ì§€ í•„ë“œëŠ” ì •ìƒ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.  
`HttpMessageConverter`ëŠ” `@ModelAttribute`ì™€ ë‹¤ë¥´ê²Œ ê°ê°ì˜ í•„ë“œ ë‹¨ìœ„ë¡œ ì ìš©ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì „ì²´ ê°ì²´ ë‹¨ìœ„ë¡œ ì ìš©ëœë‹¤.  
ë”°ë¼ì„œ ë©”ì‹œì§€ ì»¨ë²„í„°ì˜ ì‘ë™ì´ ì„±ê³µí•´ì„œ `ItemSaveForm` ê°ì²´ë¥¼ ë§Œë“¤ì–´ì•¼ `@Valid`, `@Validated`ê°€ ì ìš©ëœë‹¤.

- `@ModelAttribute`ëŠ” í•„ë“œ ë‹¨ìœ„ë¡œ ì •êµí•˜ê²Œ ë°”ì¸ë”©ì´ ì ìš©ëœë‹¤. íŠ¹ì • í•„ë“œê°€ ë°”ì¸ë”© ë˜ì§€ ì•Šì•„ë„ ë‚˜ë¨¸ì§€ í•„ë“œëŠ” ì •ìƒ ë°”ì¸ë”© ë˜ê³ , Validatorë¥¼ ì‚¬ìš©í•œ ê²€ì¦ë„ ì ìš©í•  ìˆ˜ ìˆë‹¤.
- `@RequestBody`ëŠ” HttpMessageConverter ë‹¨ê³„ì—ì„œ JSON ë°ì´í„°ë¥¼ ê°ì²´ë¡œ ë³€ê²½í•˜ì§€ ëª»í•˜ë©´ ì´í›„ ë‹¨ê³„ ìì²´ê°€ ì§„í–‰ë˜ì§€ ì•Šê³  ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤. ì»¨íŠ¸ë¡¤ëŸ¬ë„ í˜¸ì¶œë˜ì§€ ì•Šê³ , Validatorë„ ì ìš©í•  ìˆ˜ ì—†ë‹¤.

> ğŸ€ ì°¸ê³   
> `HttpMessageConverter` ë‹¨ê³„ì—ì„œ ì‹¤íŒ¨í•˜ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤ ì˜ˆì™¸ ë°œìƒ ì‹œ ì›í•˜ëŠ” ëª¨ì–‘ìœ¼ë¡œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì€ ì˜ˆì™¸ ì²˜ë¦¬ ë¶€ë¶„ì—ì„œ ë‹¤ë£¬ë‹¤.