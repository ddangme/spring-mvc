# Ch04. ê²€ì¦1 - Validation

## ê²€ì¦ ìš”êµ¬ì‚¬í•­
ìƒí’ˆ ê´€ë¦¬ ì‹œìŠ¤í…œì— ìƒˆë¡œìš´ ìš”êµ¬ì‚¬í•­ì´ ì¶”ê°€ë˜ì—ˆë‹¤.

**ìš”êµ¬ì‚¬í•­: ê²€ì¦ ë¡œì§ ì¶”ê°€**  
- íƒ€ì… ê²€ì¦
  - ê°€ê²©, ìˆ˜ëŸ‰ì— ë¬¸ìê°€ ë“¤ì–´ê°€ë©´ ê²€ì¦ ì˜¤ë¥˜ ì²˜ë¦¬
- í•„ë“œ ê²€ì¦
  - ìƒí’ˆëª…: í•„ìˆ˜, ê³µë°±X
  - ê°€ê²©: 1_000ì› ì´ìƒ, 1_000_000ì› ì´í•˜
  - ìˆ˜ëŸ‰: ìµœëŒ€ 9999
- íŠ¹ì • í•„ë“œì˜ ë²”ìœ„ë¥¼ ë„˜ì–´ì„œëŠ” ê²€ì¦
  - ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ 10_000ì› ì´ìƒ

ì§€ê¸ˆê¹Œì§€ ë§Œë“  ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ í¼ ì…ë ¥ ì‹œ ìˆ«ìë¥¼ ë¬¸ìë¡œ ì‘ì„±í•˜ê±°ë‚˜í•´ì„œ ê²€ì¦ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ì˜¤ë¥˜ í™”ë©´ìœ¼ë¡œ ë°”ë¡œ ì´ë™í•œë‹¤.
ì´ë ‡ê²Œ ë””ë©´ ì‚¬ìš©ìëŠ” í•´ë‹¹ í¼ìœ¼ë¡œ ì´ë™í•´ì„œ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì…ë ¥ì„ í•´ì•¼í•œë‹¤.
ì›¹ ì„œë¹„ìŠ¤ëŠ” í¼ ì…ë ¥ ì‹œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´, ê³ ê°ì´ ì…ë ¥í•œ ë°ì´í„°ë¥¼ ìœ ì§€í•œ ìƒíƒœë¡œ ì–´ë–¤ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆëŠ”ì§€ ì•Œë ¤ì£¼ì–´ì•¼ í•œë‹¤.

**ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì¤‘ìš”í•œ ì—­í•  ì¤‘ í•˜ë‚˜ëŠ” HTTP ìš”ì²­ì´ ì •ìƒì¸ì§€ ê²€ì¦í•˜ëŠ” ê²ƒì´ë‹¤.**
ê·¸ë¦¬ê³  ì •ìƒ ë¡œì§ë³´ë‹¤ ì´ëŸ° ê²€ì¦ ë¡œì§ì„ ì˜ ê°œë°œí•˜ëŠ” ê²ƒì´ ì–´ì©Œë©´ ë” ì–´ë ¤ìš¸ ìˆ˜ ìˆë‹¤.

> ğŸ€ì°¸ê³ 
> í´ë¼ì´ì–¸íŠ¸ ê²€ì¦ê³¼ ì„œë²„ ê²€ì¦
> - í´ë¼ì´ì–¸íŠ¸ ê²€ì¦ì€ ì¡°ì‘í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë³´ì•ˆì— ì·¨ì•½í•˜ë‹¤.
> - ì„œë²„ë§Œìœ¼ë¡œ ê²€ì¦í•˜ë©´, ì¦‰ê°ì ì¸ ê³ ê° ì‚¬ìš©ì„±ì´ ë¶€ì¡±í•´ì§„ë‹¤.
> - ë‘˜ì„ ì ì ˆíˆ ì„ì–´ì„œ ì‚¬ìš©í•˜ë˜, ìµœì¢…ì ìœ¼ë¡œ ì„œë²„ ê²€ì¦ì€ í•„ìˆ˜ì´ë‹¤.
> - API ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´ API ìŠ¤í™ì„ ì˜ ì •ì˜í•´ì„œ ê²€ì¦ ì˜¤ë¥˜ë¥¼ API ì‘ë‹µ ê²°ê³¼ì— ì˜ ë‚¨ê²¨ì£¼ì–´ì•¼ í•œë‹¤.

ë¨¼ì € ê²€ì¦ì„ ì§ì ‘ êµ¬í˜„í•´ë³´ê³ , ë’¤ì—ì„œ ìŠ¤í”„ë§ê³¼ íƒ€ì„ë¦¬í”„ê°€ ì œê³µí•˜ëŠ” ê²€ì¦ ê¸°ëŠ¥ì„ í™œìš©í•´ë³´ì.


## ê²€ì¦ ì§ì ‘ ì²˜ë¦¬ - ì†Œê°œ
![ìƒí’ˆ ì €ì¥ ì„±ê³µ.png](imgs%2F%EC%83%81%ED%92%88%20%EC%A0%80%EC%9E%A5%20%EC%84%B1%EA%B3%B5.png)  
ì‚¬ìš©ìê°€ ìƒí’ˆ ë“±ë¡ í¼ì—ì„œ ì •ìƒ ë²”ìœ„ì˜ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ë©´, ì„œë²„ì—ì„œëŠ” ê²€ì¦ ë¡œì§ì´ í†µê³¼í•˜ê³ , ìƒí’ˆì„ ì €ì¥í•˜ê³ , ìƒí’ˆ ìƒì„¸ í™”ë©´ìœ¼ë¡œ redirect í•œë‹¤.
![ìƒí’ˆ ì €ì¥ ê²€ì¦ ì‹¤íŒ¨.png](imgs%2F%EC%83%81%ED%92%88%20%EC%A0%80%EC%9E%A5%20%EA%B2%80%EC%A6%9D%20%EC%8B%A4%ED%8C%A8.png)  
ê³ ê°ì´ ìƒí’ˆ ë“±ë¡ í¼ì—ì„œ ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì§€ ì•Šê±°ë‚˜, ê°€ê²©, ìˆ˜ëŸ‰ ë“±ì´ ë„ˆë¬´ ì ê±°ë‚˜ ì»¤ì„œ ê²€ì¦ ë²”ìœ„ë¥¼ ë„˜ì–´ì„œë©´, ì„œë²„ ê²€ì¦ ë¡œì§ì´ ì‹¤íŒ¨í•´ì•¼ í•œë‹¤.
ì´ë ‡ê²Œ ê²€ì¦ì— ì‹¤íŒ¨í•œ ê²½ìš° ê³ ê°ì—ê²Œ ë‹¤ì‹œ ìƒí’ˆ ë“±ë¡ í¼ì„ ë³´ì—¬ì£¼ê³ , ì–´ë–¤ ê°’ì„ ì˜ëª» ì…ë ¥í–ˆëŠ”ì§€ ì¹œì ˆí•˜ê²Œ ì•Œë ¤ì£¼ì–´ì•¼ í•œë‹¤.


## ê²€ì¦ ì§ì ‘ ì²˜ë¦¬ - ê°œë°œ
### ìƒí’ˆ ë“±ë¡ ê²€ì¦
ìƒí’ˆ ë“±ë¡ ê²€ì¦ ì½”ë“œë¥¼ ì‘ì„±í•˜ì.
```java
  @PostMapping("/add")
  public String addItem(@ModelAttribute Item item, RedirectAttributes redirectAttributes, Model model) {
      // ê²€ì¦ ì˜¤ë¥˜ ê²°ê³¼ë¥¼ ë³´ê´€
      Map<String, String> errors = new HashMap<>();

      // ê²€ì¦ ë¡œì§
      if (!StringUtils.hasText(item.getItemName())) {
          errors.put("itemName", "ìƒí’ˆ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
      }

      if (item.getPrice() == null || item.getPrice() < 1000 || item.getPrice() > 1000000) {
          errors.put("price", "ê°€ê²©ì€ 1,000 ~ 1,000,000 ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤.");
      }

      if (item.getQuantity() == null || item.getQuantity() >= 9999) {
          errors.put("quantity", "ìˆ˜ëŸ‰ì€ ìµœëŒ€ 9,999 ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤.");
      }

      //íŠ¹ì • í•„ë“œê°€ ì•„ë‹Œ ë³µí•© ë£° ê²€ì¦
      if (item.getPrice() != null && item.getQuantity() != null) {
          int resultPrice = item.getPrice() * item.getQuantity();

          if (resultPrice < 10000) {
              errors.put("globalError", "ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ 10,000ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤. í˜„ì¬ ê°’ = " + resultPrice);
          }
      }

      //ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
      if (!errors.isEmpty()) {
          model.addAttribute("errors", errors);
          return "validation/v1/addForm";
      }

      //ì„±ê³µ ë¡œì§
      Item savedItem = itemRepository.save(item);
      redirectAttributes.addAttribute("itemId", savedItem.getId());
      redirectAttributes.addAttribute("status", true);
      return "redirect:/validation/v1/items/{itemId}";
  }
```

### ê²€ì¦ ì˜¤ë¥˜ ë³´ê´€
`Map<String, String> errors = new HashMap<>();`
ë§Œì•½ ê²€ì¦ ì‹œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ì–´ë–¤ ê²€ì¦ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆëŠ”ì§€ ì •ë³´ë¥¼ ë‹´ì•„ë‘”ë‹¤.

### ê²€ì¦ ë¡œì§
```java
  if (!StringUtils.hasText(item.getItemName())) {
    errors.put("itemNames", "ìƒí’ˆ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");  
  }
```
ê²€ì¦ ì‹œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ `erros`ì— ë‹´ì•„ë‘”ë‹¤. ì´ë•Œ ì–´ë–¤ í•„ë“œì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆëŠ”ì§€ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ì˜¤ë¥˜ê°€ ë°œìƒí•œ í•„ë“œëª…ì„ `key`ë¡œ ì‚¬ìš©í•œë‹¤.
ì´í›„ ë·°ì—ì„œ ì´ ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ì„œ ê³ ê°ì—ê²Œ ì¹œì ˆí•œ ì˜¤ë¥˜ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•  ìˆ˜ ìˆë‹¤.

### íŠ¹ì • í•„ë“œì˜ ë²”ìœ„ë¥¼ ë„˜ì–´ì„œëŠ” ê²€ì¦ ë¡œì§
```java
  //íŠ¹ì • í•„ë“œê°€ ì•„ë‹Œ ë³µí•© ë£° ê²€ì¦
  if (item.getPrice() != null && item.getQuantity() != null) {
      int resultPrice = item.getPrice() * item.getQuantity();

      if (resultPrice < 10000) {
          errors.put("globalError", "ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ 10,000ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤. í˜„ì¬ ê°’ = " + resultPrice);
      }
  }
```
íŠ¹ì • í•„ë“œë¥¼ ë„˜ì–´ì„œëŠ” ì˜¤ë¥˜ë¥¼ ì²˜ë¦¬í•´í– í•  ìˆ˜ë„ ìˆë‹¤. ì´ë•ŒëŠ” í•„ë“œ ì´ë¦„ì„ ë„£ì„ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ `globalError`ë¼ëŠ” `key`ë¥¼ ì‚¬ìš©í•œë‹¤.

### ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
```java
  //ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
  if (!errors.isEmpty()) {
    model.addAttribute("errors", errors);
    return "validation/v1/addForm";
  }
```
ë§Œì•½ ê²€ì¦ì—ì„œ ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ê¸° ìœ„í•´ `model`ì— `errors`ë¥¼ ë‹´ê³ , ì…ë ¥ í¼ì´ ìˆëŠ” ë·° í…œí”Œë¦¿ìœ¼ë¡œ ë³´ë‚¸ë‹¤.

### HTML ìˆ˜ì •
```html
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <link th:href="@{/css/bootstrap.min.css}"
          href="../css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            max-width: 560px;
        }
        .field-error {
            border-color: #dc3545;
            color: #dc3545;
        }
    </style>
</head>
<body>

<div class="container">

    <div class="py-5 text-center">
        <h2 th:text="#{page.addItem}">ìƒí’ˆ ë“±ë¡</h2>
    </div>

    <form action="item.html" th:action th:object="${item}" method="post">

        <div th:if="${errors?.containsKey('globalError')}">
            <p class="field-error" th:text="${errors['globalError']}">ì „ì²´ ì˜¤ë¥˜ ë©”ì‹œì§€</p>
        </div>

        <div>
            <label for="itemName" th:text="#{label.item.itemName}">ìƒí’ˆëª…</label>
            <input type="text" id="itemName" th:field="*{itemName}"
                   th:class="${errors?.containsKey('itemName')} ? 'form-control field-error' : 'form-control'"
                   class="form-control" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            <div class="field-error" th:if="${errors?.containsKey('itemName')}" th:text="${errors['itemName']}">
                ìƒí’ˆëª… ì˜¤ë¥˜
            </div>
        </div>
        <div>
            <label for="price" th:text="#{label.item.price}">ê°€ê²©</label>
            <input type="text" id="price" th:field="*{price}"
                   th:class="${errors?.containsKey('price')} ? 'form-control field-error' : 'form-control'"
                   class="form-control" placeholder="ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš”">
            <div class="field-error" th:if="${errors?.containsKey('price')}" th:text="${errors['price']}">
                ê°€ê²© ì˜¤ë¥˜
            </div>
        </div>

        <div>
            <label for="quantity" th:text="#{label.item.quantity}">ìˆ˜ëŸ‰</label>
            <input type="text" id="quantity" th:field="*{quantity}"
                   th:class="${errors?.containsKey('quantity')} ? 'form-control field-error' : 'form-control'"
                   class="form-control" placeholder="ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”">
            <div class="field-error" th:if="${errors?.containsKey('quantity')}" th:text="${errors['quantity']}">
                ìˆ˜ëŸ‰ ì˜¤ë¥˜
            </div>

        </div>

        <hr class="my-4">

        <div class="row">
            <div class="col">
                <button class="w-100 btn btn-primary btn-lg" type="submit" th:text="#{button.save}">ìƒí’ˆ ë“±ë¡</button>
            </div>
            <div class="col">
                <button class="w-100 btn btn-secondary btn-lg"
                        onclick="location.href='items.html'"
                        th:onclick="|location.href='@{/validation/v1/items}'|"
                        type="button" th:text="#{button.cancel}">ì·¨ì†Œ</button>
            </div>
        </div>

    </form>

</div> <!-- /container -->
</body>
</html>
```

### ê¸€ë¡œë²Œ ì˜¤ë¥˜ ë©”ì‹œì§€
```html
<div th:if="${errors?.containsKey('globalError')}">
  <p class="field-error" th:text="${errors['globalError']}">ì „ì²´ ì˜¤ë¥˜ ë©”ì‹œì§€</p>
</div>
```
ì˜¤ë¥˜ ë©”ì‹œì§€ëŠ” `errors`ì— ë‚´ìš©ì´ ìˆì„ ë•Œë§Œ ì¶œë ¥í•˜ë©´ ëœë‹¤. íƒ€ì„ë¦¬í”„ì˜ `th:if`ë¥¼ ì‚¬ìš©í•˜ë©´ ì¡°ê±´ì— ë§Œì¡±í•  ë•Œë§Œ í•´ë‹¹ HTML íƒœê·¸ë¥¼ ì¶œë ¥í•  ìˆ˜ ìˆë‹¤.

> ğŸ€ ì°¸ê³  Safe Navigation Operator
> ë§Œì•½ ì—¬ê¸°ì—ì„œ `errors`ê°€ `null`ì´ë¼ë©´ ì–´ë–»ê²Œ ë ê¹Œ?  
> ìƒê°í•´ë³´ë©´ ë“±ë¡í¼ì— ì§„ì…í•œ ì‹œì ì—ëŠ” `errors`ê°€ ì—†ë‹¤.  
> ë”°ë¼ì„œ `errors.containsKey()`ë¥¼ í˜¸ì¶œí•˜ëŠ” ìˆœê°„ `NullPointerException`ì´ ë°œìƒí•œë‹¤.  
> `error?.`ì€ `errors`ê°€ `null`ì¼ ë•Œ `NullPointerException`ì„ ë°œìƒí•˜ëŠ” ëŒ€ì‹ , `null`ì„ ë°˜í™˜í•˜ëŠ” ë¬¸ë²•ì´ë‹¤.  
> `th:if`ì—ì„œ `null`ì€ ì‹¤íŒ¨ë¡œ ì²˜ë¦¬ë˜ë¯€ë¡œ ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ì¶œë ¥ë˜ì§€ ì•ŠëŠ”ë‹¤.  
> [Spring Elì´ ì œê³µí•˜ëŠ” ë¬¸ë²•](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions-operator-safe-navigation)

ê°€ê²© 1,000ì›, ìˆ˜ëŸ‰ 1ê°œë¥¼ ì„ íƒí•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ HTML ê²°ê³¼ í™”ë©´ì„ ë³¼ ìˆ˜ ìˆë‹¤.
```html
<div>
    <p class="field-error">ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ 10,000ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤. í˜„ì¬ ê°’ = 1000</p>
</div>
```

### í•„ë“œ ì˜¤ë¥˜ ì²˜ë¦¬
```html
<input type="text" th:classappend="${errors?.containsKey('itemName')} ? 'field-error' : _" class="form-control">
```
`classappend`ë¥¼ ì‚¬ìš©í•´ì„œ í•´ë‹¹ í•„ë“œì— ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´ `field-error`ë¼ëŠ” í´ë˜ìŠ¤ ì •ë³´ë¥¼ ë”í•´ì„œ í¼ì˜ ìƒ‰ê¹”ì„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ê°•ì¡°í•œë‹¤.
ë§Œì•½ ê°’ì´ ì—†ìœ¼ë©´ `_`(No-Operation)ì„ ì‚¬ìš©í•´ì„œ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ”ë‹¤.

### í•„ë“œ ì˜¤ë¥˜ ì²˜ë¦¬ - ì…ë ¥ í¼ ìƒ‰ìƒ ì ìš©
```html
<input type="text" class="form-control field-error">
```

### í•„ë“œ ì˜¤ë¥˜ ì²˜ë¦¬ - ë©”ì‹œì§€
```html
<div class="field-error" th:if="${errors?.containsKey('itemName')}" th:text="${errors['itemName']}">ìƒí’ˆëª… ì˜¤ë¥˜</div>
```
ê¸€ë¡œë²Œ ì˜¤ë¥˜ ë©”ì‹œì§€ì—ì„œ ì„¤ì •í•œ ë‚´ìš©ê³¼ ë™ì¼í•˜ê³ , í•„ë“œ ì˜¤ë¥˜ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•œë‹¤.

### ì •ë¦¬
- ë§Œì•½ ê²€ì¦ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ì…ë ¥ í¼ì„ ë‹¤ì‹œ ë³´ì—¬ì¤€ë‹¤.
- ê²€ì¦ ì˜¤ë¥˜ë“¤ì„ ê³ ê°ì—ê²Œ ì¹œì ˆí•˜ê²Œ ì•ˆë‚´í•´ì„œ ë‹¤ì‹œ ì…ë ¥í•  ìˆ˜ ìˆê²Œ í•œë‹¤.
- ê²€ì¦ ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ê³ ê°ì´ ì…ë ¥í•œ ë°ì´í„°ê°€ ìœ ì§€ëœë‹¤.

### ë‚¨ì€ ë¬¸ì œì 
- ë·° í…œí”Œë¦¬ì—ì„œ ì¤‘ë³µ ì²˜ë¦¬ê°€ ë§ë‹¤.
- íƒ€ì… ì˜¤ë¥˜ ì²˜ë¦¬ê°€ ì•ˆëœë‹¤. `Item`ì˜ `price`, `quantity`ê°™ì€ ìˆ«ì í•„ë“œëŠ” íƒ€ì…ì´ `Integer`ì´ë¯€ë¡œ ë¬¸ì íƒ€ì…ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
ìˆ«ì íƒ€ì…ì— ë¬¸ìê°€ ë“¤ì–´ì˜¤ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.
ê·¸ëŸ°ë° ì´ëŸ¬í•œ ì˜¤ë¥˜ëŠ” ìŠ¤í”„ë§ MVCì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ì— ì§„ì…í•˜ê¸°ë„ ì „ì— ì˜ˆì™¸ê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸ì—, ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í˜¸ì¶œë˜ì§€ë„ ì•Šê³ , 400ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ì„œ ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ ë„ì›Œì¤€ë‹¤.
- `Item`ì˜ `price`ì— ë¬¸ìë¥¼ ì…ë ¥í•˜ëŠ” ê²ƒ ì²˜ëŸ¼ íƒ€ì… ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ê³ ê°ì´ ì…ë ¥í•œ ë¬¸ìë¥¼ í™”ë©´ì— ë‚¨ê²¨ì•¼ í•œë‹¤.
ë§Œì•½ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í˜¸ì¶œëœë‹¤ê³  ê°€ì •í•´ë„ `Item`ì˜ `price`ëŠ” `Integer`ì´ë¯€ë¡œ ë¬¸ìë¥¼ ë³´ê´€í•  ìˆ˜ê°€ ì—†ë‹¤.
ê²°êµ­ ë¬¸ìëŠ” ë°”ì¸ë”©ì´ ë¶ˆê°€ëŠ¥í•˜ë¯€ë¡œ ê³ ê°ì´ ì…ë ¥í•œ ë¬¸ìê°€ ì‚¬ë¼ì§€ê²Œ ë˜ê³ , ê³ ê°ì€ ë³¸ì¸ì´ ì–´ë–¤ ë‚´ìš©ì„ ì…ë ¥í•´ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆëŠ”ì§€ ì´í•´í•˜ê¸° ì–´ë µë‹¤.
- ê²°êµ­ ê³ ê°ì´ ì…ë ¥í•œ ê°’ë„ ì–´ë”˜ê°€ì— ë³„ë„ë¡œ ê´€ë¦¬ê°€ ë˜ì–´ì•¼ í•œë‹¤.

## BindingResult1
ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ê²€ì¦ ì˜¤ë¥˜ ì²˜ë¦¬ ë°©ë²•
```java
public String addItem(@ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes) {
  //ê²€ì¦ ë¡œì§
  if (!StringUtils.hasText(item.getItemName())) {
      bindingResult.addError(new FieldError("item", "itemName", "ìƒí’ˆ ì´ë¦„ì€ í•„ìˆ˜ ì…ë‹ˆë‹¤."));
  }
  if (item.getPrice() == null || item.getPrice() < 1000 || item.getPrice() > 1000000) {
      bindingResult.addError(new FieldError("item", "price", "ê°€ê²©ì€ 1,000 ~ 1,000,000 ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤."));
  }
  if (item.getQuantity() == null || item.getQuantity() >= 9999) {
      bindingResult.addError(new FieldError("item", "quantity", "ìˆ˜ëŸ‰ì€ ìµœëŒ€ 9,999 ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤."));
  }

  //íŠ¹ì • í•„ë“œê°€ ì•„ë‹Œ ë³µí•© ë£° ê²€ì¦
  if (item.getPrice() != null && item.getQuantity() != null) {
      int resultPrice = item.getPrice() * item.getQuantity();
      if (resultPrice < 10000) {
          bindingResult.addError(new ObjectError("item", "ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ 10,000ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤. í˜„ì¬ ê°’ = " + resultPrice));
      }
  }

  //ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
  if (bindingResult.hasErrors()) {
      log.info("errors={} ", bindingResult);
      return "validation/v2/addForm";
  }

  //ì„±ê³µ ë¡œì§
  Item savedItem = itemRepository.save(item);
  redirectAttributes.addAttribute("itemId", savedItem.getId());
  redirectAttributes.addAttribute("status", true);
  return "redirect:/validation/v2/items/{itemId}";
}
```

ğŸš¨ ì£¼ì˜: `BindingResult bindingResult` íŒŒë¼ë¯¸í„°ì˜ ìœ„ì¹˜ëŠ” `@ModelAttribute Item item` ë‹¤ìŒì— ì™€ì•¼ í•œë‹¤.

### í•„ë“œ ì˜¤ë¥˜ - FieldError
```java
if (!StringUtils.hasText(item.getItemName())) {
  bindingResult.addError(new FieldError("item", "itemName", "ìƒí’ˆ ì´ë¦„ì€ í•„ìˆ˜ ì…ë‹ˆë‹¤."));
}
```

### FieldError ìƒì„±ì ìš”ì•½
```java
public FieldError(String objectName, String field, String defaultMessage) {}
```
í•„ë“œì— ì˜¤ë¥˜ê°€ ìˆë‹¤ë©´ `FieldError`ê°ì²´ë¥¼ ìƒì„±í•´ì„œ `bindingResult`ì— ë‹´ì•„ë‘ë©´ ëœë‹¤.
- `objectName`: `@ModelAttribute`ì´ë¦„
- `field`: ì˜¤ë¥˜ê°€ ë°œìƒí•œ í•„ë“œ ì´ë¦„
- `defualtMessage`: ì˜¤ë¥˜ ê¸°ë³¸ ë©”ì‹œì§€

### ê¸€ë¡œë²Œ ì˜¤ë¥˜ - ObjectError
```java
bindingResult.addError(new ObjectError("item", "ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ 10,000ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤. í˜„ì¬ ê°’ = " + resultPrice));
```

### ObjectError ìƒì„±ì ìš”ì•½
```java
public ObjectError(String objectName, String defaultMessage) {}
```
íŠ¹ì • í•„ë“œë¥¼ ë„˜ì–´ì„œëŠ” ì˜¤ë¥˜ê°€ ìˆë‹¤ë©´ `ObjectError` ê°ì²´ë¥¼ ìƒì„±í•´ì„œ `bingdingResult`ì— ë‹´ì•„ë‘ë©´ ëœë‹¤.
- `objectName`: `@ModelAttribute`ì˜ ì´ë¦„
- `defaultMessage`: ì˜¤ë¥˜ ê¸°ë³¸ ë©”ì‹œì§€

### html íŒŒì¼ ìˆ˜ì •
```html
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <link th:href="@{/css/bootstrap.min.css}"
          href="../css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            max-width: 560px;
        }
        .field-error {
            border-color: #dc3545;
            color: #dc3545;
        }
    </style>
</head>
<body>

<div class="container">

    <div class="py-5 text-center">
        <h2 th:text="#{page.addItem}">ìƒí’ˆ ë“±ë¡</h2>
    </div>

    <form action="item.html" th:action th:object="${item}" method="post">

        <div th:if="${#fields.hasGlobalErrors()}">
            <p class="field-error" th:each="err : ${#fields.globalErrors()}" th:text="${err}">ê¸€ë¡œë²Œ ì˜¤ë¥˜ ë©”ì‹œì§€</p>
        </div>

        <div>
            <label for="itemName" th:text="#{label.item.itemName}">ìƒí’ˆëª…</label>
            <input type="text" id="itemName" th:field="*{itemName}"
                   th:errorclass="field-error" class="form-control" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            <div class="field-error" th:errors="*{itemName}">
                ìƒí’ˆëª… ì˜¤ë¥˜
            </div>
        </div>
        <div>
            <label for="price" th:text="#{label.item.price}">ê°€ê²©</label>
            <input type="text" id="price" th:field="*{price}"
                   th:errorclass="field-error" class="form-control" placeholder="ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš”">
            <div class="field-error" th:errors="*{price}">
                ê°€ê²© ì˜¤ë¥˜
            </div>
        </div>

        <div>
            <label for="quantity" th:text="#{label.item.quantity}">ìˆ˜ëŸ‰</label>
            <input type="text" id="quantity" th:field="*{quantity}"
                   th:errorclass="field-error" class="form-control" placeholder="ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”">
            <div class="field-error" th:errors="*{quantity}">
                ìˆ˜ëŸ‰ ì˜¤ë¥˜
            </div>

        </div>

        <hr class="my-4">

        <div class="row">
            <div class="col">
                <button class="w-100 btn btn-primary btn-lg" type="submit" th:text="#{button.save}">ìƒí’ˆ ë“±ë¡</button>
            </div>
            <div class="col">
                <button class="w-100 btn btn-secondary btn-lg"
                        onclick="location.href='items.html'"
                        th:onclick="|location.href='@{/validation/v2/items}'|"
                        type="button" th:text="#{button.cancel}">ì·¨ì†Œ</button>
            </div>
        </div>

    </form>

</div> <!-- /container -->
</body>
</html>
```

### íƒ€ì„ë¦¬í”„ ìŠ¤í”„ë§ ê²€ì¦ ì˜¤ë¥˜ í†µí•© ê¸°ëŠ¥
íƒ€ì„ë¦¬í”„ëŠ” ìŠ¤í”„ë§ì˜ `bindingResult`ë¥¼ í™œìš©í•´ì„œ í¸ë¦¬í•˜ê²Œ ê²€ì¦ ì˜¤ë¥˜ë¥¼ í‘œí˜„í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
- `#fields`: `#fields`ë¡œ `BindingResult`ê°€ ì œê³µí•˜ëŠ” ê²€ì¦ ì˜¤ë¥˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
- `th:errors`: í•´ë‹¹ í•„ë“œì— ì˜¤ë¥˜ê°€ ìˆëŠ” ê²½ìš°ì— íƒœê·¸ë¥¼ ì¶œë ¥í•œë‹¤. `th:if`ì˜ í¸ì˜ ë²„ì „ì´ë‹¤.
- `th:errorclass`: `th:field`ì—ì„œ ì§€ì •í•œ í•„ë“œì— ì˜¤ë¥˜ê°€ ìˆë‹¤ë©´ `class`ì •ë³´ë¥¼ ì¶”ê°€í•œë‹¤.

> ğŸ€ ì°¸ê³ : [ê²€ì¦ê³¼ ì˜¤ë¥˜ ë©”ì‹œì§€ ê³µì‹ ë©”ë‰´ì–¼](https://www.thymeleaf.org/doc/tutorials/3.0/thymeleafspring.html#validation-and-error-messages)

### ê¸€ë¡œë²Œ ì˜¤ë¥˜ ì²˜ë¦¬
```html
<div th:if="${#fields.hasGlobalErrors()}">
  <p class="field-error" th:each="err : ${#fields.globalErrors()}" th:text="${err}">ì „ì²´ ì˜¤ë¥˜ ë©”ì‹œì§€</p>
</div>
```

### í•„ë“œ ì˜¤ë¥˜ ì²˜ë¦¬
```html
<input type="text" id="itemName" th:field="*{itemName}" th:errorclass="field-error" class="form-control" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
<div class="field-error" th:errors="*{itemName}">ìƒí’ˆëª… ì˜¤ë¥˜</div>
```

## BindingResult2
ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ê²€ì¦ ì˜¤ë¥˜ë¥¼ ë³´ê´€í•˜ëŠ” ê°ì²´ì´ë‹¤. ê²€ì¦ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ì—¬ê¸°ì— ë³´ê´€í•œë‹¤.  
`BindingResult`ê°€ ìˆìœ¼ë©´ `@ModelAttribute`ì— ë°ì´í„° ë°”ì¸ë”© ì‹œ ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í˜¸ì¶œëœë‹¤!

### ì˜ˆ) @ModelAttributeì— ë°”ì¸ë”© ì‹œ íƒ€ì… ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´?
- `BindingResult`ê°€ ì—†ìœ¼ë©´: 400 ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í˜¸ì¶œë˜ì§€ ì•Šê³ , ì˜¤ë¥˜ í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤.  
- `BindingResult`ê°€ ìˆìœ¼ë©´: ì˜¤ë¥˜ ì •ë³´(`FieldError`)ë¥¼ `BindingResult`ì— ë‹´ì•„ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì •ìƒ í˜¸ì¶œí•œë‹¤.

### BindingResultì— ê²€ì¦ ì˜¤ë¥˜ë¥¼ ì ìš©í•˜ëŠ” 3ê°€ì§€ ë°©ë²•
- `@ModelAttribute`ì˜ ê°ì²´ì— íƒ€ì… ì˜¤ë¥˜ ë“±ìœ¼ë¡œ ë°”ì¸ë”©ì´ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš° ìŠ¤í”„ë§ì´ `FieldError`ë¥¼ ìƒì„±í•´ì„œ `BindingResult`ì— ë„£ì–´ì¤€ë‹¤.
- ê°œë°œìê°€ ì§ì ‘ ë„£ì–´ì¤€ë‹¤.
- `Validator` ì‚¬ìš©

### BindingResultì™€ Errors
- `org.springframework.validation.Errors`
- `org.springframework.validation.BindingResult`

`BindingResult`ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ `Errors` ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ê³  ìˆë‹¤.  
ì‹¤ì œ ë„˜ì–´ì˜¤ëŠ” êµ¬í˜„ì²´ëŠ” `BeanPropertyBindingResult`ë¼ëŠ” ê²ƒì¸ë°, ë‘˜ë‹¤ êµ¬í˜„í•˜ê³  ìˆìœ¼ë¯€ë¡œ `BindingResult` ëŒ€ì‹ ì— `Errors`ë¥¼ ì‚¬ìš©í•´ë„ ëœë‹¤.  
`Errors`ì¸í„°í˜ì´ìŠ¤ëŠ” ë‹¨ìˆœí•œ ì˜¤ë¥˜ ì €ì¥ê³¼ ì¡°íšŒ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. `BindingResult`ëŠ” ì—¬ê¸°ì— ë”í•´ì„œ ì¶”ê°€ì ì¸ ê¸°ëŠ¥ë“¤ì„ ì œê³µí•œë‹¤.
`addError()`ë„ `BindingResult`ê°€ ì œê³µí•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” `BindingResult`ë¥¼ ì‚¬ìš©í•˜ì. ì£¼ë¡œ ê´€ë¡€ìƒ `BindingResult`ë¥¼ ë§ì´ ì‚¬ìš©í•œë‹¤.

### ì •ë¦¬
`BindingResult`, `FieldError`, `ObjectError`ë¥¼ ì‚¬ìš©í•´ì„œ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì•˜ë‹¤. í•˜ì§€ë§Œ, ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²½ìš° ê³ ê°ì´ ì…ë ¥í•œ ë‚´ìš©ì´ ëª¨ë‘ ì‚¬ë¼ì§„ë‹¤.


## FieldError, ObjectError
### ëª©í‘œ
ì‚¬ìš©ì ì…ë ¥ ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ í™”ë©´ì— ë‚¨ë„ë¡ í•˜ì. (ì˜ˆ: ê°€ê²©ì„ 1000ì› ë¯¸ë§Œìœ¼ë¡œ ì„¤ì • ì‹œ ì…ë ¥í•œ ê°’ì´ ë‚¨ì•„ìˆì–´ì•¼ í•œë‹¤.)  
`FieldError`, `ObjectError`ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ì.
```java
public String addItem(@ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes) {
  //ê²€ì¦ ë¡œì§
  if (!StringUtils.hasText(item.getItemName())) {
      bindingResult.addError(new FieldError("item", "itemName", item.getItemName(), false, null, null, "ìƒí’ˆ ì´ë¦„ì€ í•„ìˆ˜ ì…ë‹ˆë‹¤."));
  }
  if (item.getPrice() == null || item.getPrice() < 1000 || item.getPrice() > 1000000) {
      bindingResult.addError(new FieldError("item", "price", item.getPrice(), false, null, null, "ê°€ê²©ì€ 1,000 ~ 1,000,000 ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤."));
  }
  if (item.getQuantity() == null || item.getQuantity() >= 9999) {
      bindingResult.addError(new FieldError("item", "quantity", item.getQuantity(), false, null ,null, "ìˆ˜ëŸ‰ì€ ìµœëŒ€ 9,999 ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤."));
  }

  //íŠ¹ì • í•„ë“œê°€ ì•„ë‹Œ ë³µí•© ë£° ê²€ì¦
  if (item.getPrice() != null && item.getQuantity() != null) {
      int resultPrice = item.getPrice() * item.getQuantity();
      if (resultPrice < 10000) {
          bindingResult.addError(new ObjectError("item",null ,null, "ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ 10,000ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤. í˜„ì¬ ê°’ = " + resultPrice));
      }
  }

  //ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
  if (bindingResult.hasErrors()) {
      log.info("errors={} ", bindingResult);
      return "validation/addForm";
  }

  //ì„±ê³µ ë¡œì§
  Item savedItem = itemRepository.save(item);
  redirectAttributes.addAttribute("itemId", savedItem.getId());
  redirectAttributes.addAttribute("status", true);
  return "redirect:/validation/items/{itemId}";
}
```

### FieldError ìƒì„±ì
```java
public FieldError(String objectName, String field, String defaultMessage);

public FieldError(String objectName, String field, @Nullable Object rejectedValue, boolean bindingFailure, @Nullable String[] codes, @Nullable Object[] arguments, @Nullable String defaultMessage);
```
íŒŒë¼ë¯¸í„° ëª©ë¡
- `objectName`: ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê°ì²´ ì´ë¦„
- 'field': ì˜¤ë¥˜ í•„ë“œ
- `rejectedValue`: ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê°’(ê±°ì ˆëœ ê°’)
- `bindingFailure`: íƒ€ì… ì˜¤ë¥˜ ê°™ì€ ë°”ì¸ë”© ì‹¤íŒ¨ì¸ì§€, ê²€ì¦ ì‹¤íŒ¨ì¸ì§€ êµ¬ë¶„í•˜ëŠ” ê°’
- `codes`: ë©”ì‹œì§€ ì½”ë“œ
- `arguments`: ë©”ì‹œì§€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì¸ì
- `defaultMessage`: ê¸°ë³¸ ì˜¤ë¥˜ ë©”ì‹œì§€

`FieldError`, `ObjectError`ì˜ ìƒì„±ìëŠ” `codes`, `arguments`ë¥¼ ì œê³µí•œë‹¤. ì´ê²ƒì€ ì˜¤ë¥˜ ë°œìƒ ì‹œ ì˜¤ë¥˜ ì½”ë“œë¡œ ë©”ì‹œì§€ë¥¼ ì°¾ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.

### ì˜¤ë¥˜ ë°œìƒ ì‹œ ì‚¬ìš©ì ì…ë ¥ ê°’ ìœ ì§€
```java
new FieldError("item", "price", item.getPrice(), false, null, null, "ê°€ê²©ì€ 1,000 ~ 1,000,000 ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤.")
```
ì‚¬ìš©ìì˜ ì…ë ¥ ë°ì´í„°ê°€ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ `@ModelAttribute` ì— ë°”ì¸ë”©ë˜ëŠ” ì‹œì ì— ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ëª¨ë¸
ê°ì²´ì— ì‚¬ìš©ì ì…ë ¥ ê°’ì„ ìœ ì§€í•˜ê¸° ì–´ë µë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ ê°€ê²©ì— ìˆ«ìê°€ ì•„ë‹Œ ë¬¸ìê°€ ì…ë ¥ëœë‹¤ë©´ ê°€ê²©ì€
`Integer` íƒ€ì…ì´ë¯€ë¡œ ë¬¸ìë¥¼ ë³´ê´€í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ì—†ë‹¤. ê·¸ë˜ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²½ìš° ì‚¬ìš©ì ì…ë ¥ ê°’ì„
ë³´ê´€í•˜ëŠ” ë³„ë„ì˜ ë°©ë²•ì´ í•„ìš”í•˜ë‹¤. ê·¸ë¦¬ê³  ì´ë ‡ê²Œ ë³´ê´€í•œ ì‚¬ìš©ì ì…ë ¥ ê°’ì„ ê²€ì¦ ì˜¤ë¥˜ ë°œìƒì‹œ í™”ë©´ì— ë‹¤ì‹œ
ì¶œë ¥í•˜ë©´ ëœë‹¤.
`FieldError` ëŠ” ì˜¤ë¥˜ ë°œìƒì‹œ ì‚¬ìš©ì ì…ë ¥ ê°’ì„ ì €ì¥í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.  

ì—¬ê¸°ì„œ `rejectedValue` ê°€ ë°”ë¡œ ì˜¤ë¥˜ ë°œìƒì‹œ ì‚¬ìš©ì ì…ë ¥ ê°’ì„ ì €ì¥í•˜ëŠ” í•„ë“œë‹¤.
bindingFailure ëŠ” íƒ€ì… ì˜¤ë¥˜ ê°™ì€ ë°”ì¸ë”©ì´ ì‹¤íŒ¨í–ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ì ì–´ì£¼ë©´ ëœë‹¤. ì—¬ê¸°ì„œëŠ” ë°”ì¸ë”©ì´
ì‹¤íŒ¨í•œ ê²ƒì€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— `false` ë¥¼ ì‚¬ìš©í•œë‹¤.

### íƒ€ì„ë¦¬í”„ì˜ ì‚¬ìš©ì ì…ë ¥ ê°’ ìœ ì§€
`th:field="*{price}"`  
íƒ€ì„ë¦¬í”„ì˜ `th:field` ëŠ” ë§¤ìš° ë˜‘ë˜‘í•˜ê²Œ ë™ì‘í•˜ëŠ”ë°, ì •ìƒ ìƒí™©ì—ëŠ” ëª¨ë¸ ê°ì²´ì˜ ê°’ì„ ì‚¬ìš©í•˜ì§€ë§Œ, ì˜¤ë¥˜ê°€
ë°œìƒí•˜ë©´ `FieldError` ì—ì„œ ë³´ê´€í•œ ê°’ì„ ì‚¬ìš©í•´ì„œ ê°’ì„ ì¶œë ¥í•œë‹¤

### ìŠ¤í”„ë§ì˜ ë°”ì¸ë”© ì˜¤ë¥˜ ì²˜ë¦¬
íƒ€ì… ì˜¤ë¥˜ë¡œ ë°”ì¸ë”©ì— ì‹¤íŒ¨í•˜ë©´ ìŠ¤í”„ë§ì€ `FieldError` ë¥¼ ìƒì„±í•˜ë©´ì„œ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê°’ì„ ë„£ì–´ë‘”ë‹¤.
ê·¸ë¦¬ê³  í•´ë‹¹ ì˜¤ë¥˜ë¥¼ `BindingResult` ì— ë‹´ì•„ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œí•œë‹¤. ë”°ë¼ì„œ íƒ€ì… ì˜¤ë¥˜ ê°™ì€ ë°”ì¸ë”©
ì‹¤íŒ¨ì‹œì—ë„ ì‚¬ìš©ìì˜ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì •ìƒ ì¶œë ¥í•  ìˆ˜ ìˆë‹¤.

## ì˜¤ë¥˜ ì½”ë“œì™€ ë©”ì‹œì§€ ì²˜ë¦¬ 1

### errors ë©”ì‹œì§€ íŒŒì¼ ìƒì„±
`messages.properties`ë¥¼ ì‚¬ìš©í•´ë„ ë˜ì§€ë§Œ, ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ êµ¬ë¶„í•˜ê¸° ì‰½ê²Œ `errors.properties`ë¼ëŠ” ë³„ë„ì˜ íŒŒì¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤.  
ë¨¼ì € ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ í•´ë‹¹ ë©”ì‹œì§€ íŒŒì¼ì„ ì¸ì‹í•  ìˆ˜ ìˆê²Œ ë‹¤ìŒ ì„¤ì •ì„ ì¶”ê°€í•œë‹¤. ì´ë ‡ê²Œí•˜ë©´ `messages,properties`, `errors.properties` ë‘ íŒŒì¼ì„ ëª¨ë‘ ì¸ì‹í•œë‹¤. (ìƒëµí•˜ë©´ `messages.properties`ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì¸ì‹)

### ìŠ¤í”„ë§ ë¶€íŠ¸ ë©”ì‹œì§€ ì„¤ì • ì¶”ê°€
```text
[application.properties]  

string.messages.basename=messages, errors
```

```text
[src/main/resources/errors.properties]

required.item.itemName=ìƒí’ˆ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.
range.item.price=ê°€ê²©ì€ {0} ~ {1} ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤.
max.item.quantity=ìˆ˜ëŸ‰ì€ ìµœëŒ€ {0} ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤.
totalPriceMin=ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ {0}ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤. í˜„ì¬ ê°’ = {1}
```

ğŸ€ ì°¸ê³ : `errors_en.properties` íŒŒì¼ì„ ìƒì„±í•˜ë©´ ì˜² ë©”ì‹œì§€ë„ êµ­ì œí™” ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤.

### ì˜ˆì‹œ ì½”ë“œ
```java
public String addItemV3(@ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes) {
  //ê²€ì¦ ë¡œì§
  if (!StringUtils.hasText(item.getItemName())) {
      bindingResult.addError(new FieldError("item", "itemName", item.getItemName(), false, new String[]{"required.item.itemName"}, null, null));
  }
  if (item.getPrice() == null || item.getPrice() < 1000 || item.getPrice() > 1000000) {
      bindingResult.addError(new FieldError("item", "price", item.getPrice(), false, new String[]{"range.item.price"}, new Object[]{1000, 1000000}, null));
  }
  if (item.getQuantity() == null || item.getQuantity() >= 9999) {
      bindingResult.addError(new FieldError("item", "quantity", item.getQuantity(), false, new String[]{"max.item.quantity"} ,new Object[]{9999}, null));
  }

  //íŠ¹ì • í•„ë“œê°€ ì•„ë‹Œ ë³µí•© ë£° ê²€ì¦
  if (item.getPrice() != null && item.getQuantity() != null) {
      int resultPrice = item.getPrice() * item.getQuantity();
      if (resultPrice < 10000) {
          bindingResult.addError(new ObjectError("item",new String[]{"totalPriceMin"} ,new Object[]{10000, resultPrice}, null));
      }
  }

  //ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
  if (bindingResult.hasErrors()) {
      log.info("errors={} ", bindingResult);
      return "validation/addForm";
  }

  //ì„±ê³µ ë¡œì§
  Item savedItem = itemRepository.save(item);
  redirectAttributes.addAttribute("itemId", savedItem.getId());
  redirectAttributes.addAttribute("status", true);
  return "redirect:/validation/items/{itemId}";
}
```

```java
// range.item.price=ê°€ê²©ì€ {0} ~ {1} ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤.
new FieldError("item", "price", item.getPrice(), false, new String[]{"range.item.price"}, new Object[]{1_000, 1_000_000}));
```
- `codes`: `required.item.itemName`ì„ ì‚¬ìš©í•´ì„œ ë©”ì‹œì§€ ì½”ë“œë¥¼ ì§€ì •í•œë‹¤. ë©”ì‹œì§€ ì½”ë“œëŠ” í•˜ë‚˜ê°€ ì•„ë‹ˆë¼ ë°°ì—´ë¡œ ì—¬ëŸ¬ ê°’ì„ ì „ë‹¬í•  ìˆ˜ ìˆëŠ”ë°, ìˆœì„œëŒ€ë¡œ ë§¤ì¹­í•´ì„œ ì²˜ìŒ ë§¤ì¹­ë˜ëŠ” ë©”ì‹œì§€ê°€ ì‚¬ìš©ëœë‹¤.
- `arguements`: `Object[]{1_000, 1_000_000}`ë¥¼ ì‚¬ìš©í•´ì„œ ì½”ë“œì˜ {0}, {1}ë¡œ ì¹˜í™˜í•  ê°’ì„ ì „ë‹¬í•œë‹¤.


## ì˜¤ë¥˜ ì½”ë“œì™€ ë©”ì‹œì§€ ì²˜ë¦¬ 2
### ëª©í‘œ
- `fieldError`, `ObjectError`ëŠ” ë‹¤ë£¨ê¸° ë„ˆë¬´ ë²ˆê±°ë¡­ë‹¤. ì´ë¥¼ ìë™í™”í•´ë³´ì.

ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ `BindingResult`ëŠ” ê²€ì¦í•´ì•¼ í•  ê°ì²´ì¸ `target` ë°”ë¡œ ë‹¤ìŒì— ì˜¨ë‹¤. ë”°ë¼ì„œ `BindingResult`ëŠ” ì´ë¯¸ ë³¸ì¸ì´ ê²€ì¦í•´ì•¼ í•  ê°ì²´ì¸ `target`ì„ ì•Œê³  ìˆë‹¤.

ë‹¤ìŒì„ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì‹¤í–‰í•´ë³´ì.
```java
log.info("objectName={}", bindingResult.getObjectName());
log.info("target={}", bindingResult.getTarget());
```
```text
[ì¶œë ¥ ê²°ê³¼]
objectName=item // @ModelAttribute name
target=Item(id=null, itemName=ìƒí’ˆ, price=100, quantity=1234)
```

### `rejectValue()`, `reject()`
`BindingResult`ê°€ ì œê³µí•˜ëŠ” `rejectValue()`, `reject()`ë¥¼ ì‚¬ìš©í•˜ë©´ `FeildError`, `ObjectError`ë¥¼ ì§ì ‘ ìƒì„±í•˜ì§€ ì•Šê³ , ê¹”ë”í•˜ê²Œ ê²€ì¦ ì˜¤ë¥˜ë¥¼ ë‹¤ë£° ìˆ˜ ìˆë‹¤.

`rejectValue()`, `reject()`ë¥¼ ì‚¬ìš©í•´ì„œ ê¸°ì¡´ ì½”ë“œë¥¼ ë‹¨ìˆœí™”í•´ë³´ì.
```java
public String addItem(@ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes) {
  log.info("objectName={}", bindingResult.getObjectName());
  log.info("target={}", bindingResult.getTarget());

  if (!StringUtils.hasText(item.getItemName())) {
      bindingResult.rejectValue("itemName", "required");
  }
  if (item.getPrice() == null || item.getPrice() < 1000 || item.getPrice() > 1000000) {
      bindingResult.rejectValue("price", "range", new Object[]{1000, 10000000}, null);
  }
  if (item.getQuantity() == null || item.getQuantity() >= 9999) {
      bindingResult.rejectValue("quantity", "max", new Object[]{9999}, null);
  }

  //íŠ¹ì • í•„ë“œê°€ ì•„ë‹Œ ë³µí•© ë£° ê²€ì¦
  if (item.getPrice() != null && item.getQuantity() != null) {
      int resultPrice = item.getPrice() * item.getQuantity();
      if (resultPrice < 10000) {
          bindingResult.reject("totalPriceMin", new Object[]{10000, resultPrice}, null);
      }
  }

  //ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
  if (bindingResult.hasErrors()) {
      log.info("errors={} ", bindingResult);
      return "validation/addForm";
  }

  //ì„±ê³µ ë¡œì§
  Item savedItem = itemRepository.save(item);
  redirectAttributes.addAttribute("itemId", savedItem.getId());
  redirectAttributes.addAttribute("status", true);
  return "redirect:/validation/items/{itemId}";
}
```

### ì‹¤í–‰
ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ì •ìƒ ì¶œë ¥ëœë‹¤. `errors.properties`ì— ìˆëŠ” ì½”ë“œë¥¼ ì§ì ‘ ì…ë ¥í•˜ì§€ ì•Šì•˜ëŠ”ë° ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ì¶œë ¥ëœë‹¤.

### rejectValue()
```java
void rejectValue(@Nullable String field, String errorCode, @Nullable Object[] errorArgs, @Nullable String defaultMessage);
```
- `field`: ì˜¤ë¥˜ í•„ë“œëª…
- `errorCode`: ì˜¤ë¥˜ ì½”ë“œ(ì´ ì˜¤ë¥˜ ì½”ë“œëŠ” ë©”ì‹œì§€ì— ë“±ë¡ëœ ì½”ë“œê°€ ì•„ë‹ˆë‹¤. ë’¤ì—ì„œ ì„¤ëª…í•  messageResolverë¥¼ ìœ„í•œ ì˜¤ë¥˜ ì½”ë“œì´ë‹¤.)
- `errorArgs`: ì˜¤ë¥˜ ë©”ì‹œì§€ì—ì„œ `{0}`ë¥¼ ì¹˜í™˜í•˜ê¸° ìœ„í•œ ê°’
- `defaultMessage`: ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ ë©”ì‹œì§€

```java
bindingResult.rejectValue("price", "range", new Object[]{1_000, 1_000_000}, null);
```
`BindingResult`ëŠ” ì–´ë–¤ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ì¦í•˜ëŠ”ì§€ targetì„ ì´ë¯¸ ì•Œê³  ìˆë‹¤.
ë”°ë¼ì„œ target(item)ì— ëŒ€í•œ ì •ë³´ëŠ” ì—†ì–´ë„ ëœë‹¤. ì˜¤ë¥˜ í•„ë“œëª…ì€ ë™ì¼í•˜ê²Œ `price`ë¥¼ ì‚¬ìš©í–ˆë‹¤.


### ì¶•ì•½ëœ ì˜¤ë¥˜ ì½”ë“œ
`FiedldError()`ë¥¼ ì§ì ‘ ë‹¤ë£° ë•ŒëŠ” ì˜¤ë¥˜ ì½”ë“œë¥¼ `range.item.price`ì™€ ê°™ì´ ëª¨ë‘ ì…ë ¥í–ˆë‹¤.
ê·¸ëŸ°ë° `rejectValue()`ë¥¼ ì‚¬ìš©í•˜ê³  ë¶€í„°ëŠ” ì˜¤ë¥˜ ì½”ë“œë¥¼ `range`ë¡œ ê°„ë‹¨í•˜ê²Œ ì…ë ¥í–ˆë‹¤.
ê·¸ë˜ë„ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì˜ ì°¾ì•„ì„œ ì¶œë ¥í•œë‹¤.
ì´ ê·œì¹™ì„ ì´í•´í•˜ë ¤ë©´ `MessageCodesResolver`ë¥¼ ì´í•´í•´ì•¼ í•œë‹¤.
```text
[errors.properties]

range.item.price=ê°€ê²©ì€ {0} ~ {1} ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤.
```

#### reject()
```java
void reject(String errorCode, @Nullable Object[] errorsArgs, @Nullable String defaultMessage);
```

## ì˜¤ë¥˜ ì½”ë“œì™€ ë©”ì‹œì§€ ì²˜ë¦¬ 3
ì˜¤ë¥˜ ì½”ë“œë¥¼ ë§Œë“¤ ë•Œ ë‹¤ìŒê³¼ ê°™ì´ ìì„¸íˆ ë§Œë“¤ ìˆ˜ë„ ìˆê³ ,  
`required.item.itemName`: ìƒí’ˆ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.  
`range.item.price`: ìƒí’ˆì˜ ê°€ê²© ë²”ìœ„ ì˜¤ë¥˜ì…ë‹ˆë‹¤.

ë˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë‹¨ìˆœí•˜ê²Œ ë§Œë“¤ ìˆ˜ë„ ìˆë‹¤.
`required`: í•„ìˆ˜ ê°’ ì…ë‹ˆë‹¤.
`range`: ë²”ìœ„ ì˜¤ë¥˜ ì…ë‹ˆë‹¤.  

ë‹¨ìˆœí•˜ê²Œ ë§Œë“¤ë©´ ë²”ìš©ì„±ì´ ì¢‹ì•„ì„œ ì—¬ëŸ¬ ê³³ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ë©”ì‹œì§€ë¥¼ ì„¸ë°€í•˜ê²Œ ì‘ì„±í•˜ê¸° ì–´ë µë‹¤.  
ë°˜ëŒ€ë¡œ ë„ˆë¬´ ìì„¸í•˜ê²Œ ë§Œë“¤ë©´ ë²”ìš©ì„±ì´ ë–¨ì–´ì§„ë‹¤.  
ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€ ë²”ìš©ì„±ìœ¼ë¡œ ì‚¬ìš©í•˜ë‹¤ê°€, ì„¸ë°€í•˜ê²Œ ì‘ì„±í•´ì•¼ í•˜ëŠ” ê²½ìš°ì—ëŠ” ì„¸ë°€í•œ ë‚´ìš©ì´ ì ìš©ë˜ë„ë¡ ë©”ì‹œì§€ì— ë‹¨ê³„ë¥¼ ë‘ëŠ” ë°©ë²•ì´ë‹¤.  

ì˜ˆë¥¼ ë“¤ì–´ì„œ `required`ë¼ê³  ì˜¤ë¥˜ ì½”ë“œë¥¼ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í•´ë³´ì.  
ë‹¤ìŒê°€ ê°™ì´ `required`ë¼ëŠ” ë©”ì‹œì§€ë§Œ ìˆìœ¼ë©´ ì´ ë©”ì‹œì§€ë¥¼ ì„ íƒí•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.
```text
required: í•„ìˆ˜ ê°’ ì…ë‹ˆë‹¤.
```
ê·¸ëŸ°ë° ì˜¤ë¥˜ ë©”ì‹œì§€ì— `required.item.itemName`ê³¼ ê°™ì´ ê°ì²´ëª…ê³¼ í•„ë“œëª…ì„ ì¡°í•©í•œ ì„¸ë°€í•œ ë©”ì‹œì§€ ì½”ë“œê°€ ìˆìœ¼ë©´ ì´ ë©”ì‹œì§€ë¥¼ ë†’ì€ ìš°ì„ ìˆœìœ„ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.
```text
#Level1
required.item.itemName: ìƒí’ˆ ì´ë¦„ì€ í•„ìˆ˜ ì…ë‹ˆë‹¤.

#Level2
required: í•„ìˆ˜ ê°’ ì…ë‹ˆë‹¤.
```
ë¬¼ë¡  ì´ë ‡ê²Œ ê°ì²´ëª…ê³¼ í•„ë“œëª…ì„ ì¡°í•©í•œ ë©”ì‹œì§€ê°€ ìˆëŠ”ì§€ ìš°ì„  í™•ì¸í•˜ê³ , ì—†ìœ¼ë©´ ì¢€ ë” ë²”ìš©ì ì¸ ë©”ì‹œì§€ë¥¼ ì„ íƒí•˜ë„ë¡ ì¶”ê°€ ê°œë°œì„ í•´ì•¼ê² ì§€ë§Œ,
ë²”ìš©ì„± ìˆê²Œ ì˜ ê°œë°œí•´ë‘ë©´, ë©”ì‹œì§€ì˜ ì¶”ê°€ ë§Œìœ¼ë¡œ ë§¤ìš° í¸ë¦¬í•˜ê²Œ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

ìŠ¤í”„ë§ì€ `MessageCodesResolver`ë¼ëŠ” ê²ƒìœ¼ë¡œ ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ ì§€ì›í•œë‹¤.

## ì˜¤ë¥˜ ì½”ë“œì™€ ë©”ì‹œì§€ ì²˜ë¦¬ 4
```java
[MessageCodesResolverTest]

public class MessageCodesResolverTest {

  MessageCodesResolver codesResolver = new DefaultMessageCodesResolver();

  @Test
  void messageCodesResolverObject() {
    String[] messageCodes = codesResolver.resolveMessageCodes("required", "item");
    assertThat(messageCodes).containsExactly("required.item", "required");
  }

  @Test
  void messageCodesResolverField() {
    String[] messageCodes = codesResolver.resolveMessageCodes("required", "item", "itemName", String.class);

    assertThat(messageCodes).containsExactly(
            "required.item.itemName",
            "required.itemName",
            "required.java.lang.String",
            "required"
    );
  }
}
```

### MessageCodesResolver
- ê²€ì¦ ì˜¤ë¥˜ ì½”ë“œë¡œ ë©”ì‹œì§€ ì½”ë“œë“¤ì„ ìƒì„±í•œë‹¤.
- `MessagecodesResolver`ì¸í„°í˜ì´ìŠ¤ì´ê³ , `DefaultMessageCodesResolver`ëŠ” ê¸°ë³¸ êµ¬í˜„ì²´ì´ë‹¤.
- ì£¼ë¡œ ë‹¤ìŒê³¼ í•¨ê»˜ ì‚¬ìš©í•œë‹¤. `ObjectError`, `FieldError`

### DefaultMessageCodesResolverì˜ ê¸°ë³¸ ë©”ì‹œì§€ ìƒì„± ê·œì¹™
#### ê°ì²´ ì˜¤ë¥˜
```text
ê°ì²´ ì˜¤ë¥˜ì˜ ê²½ìš° ë‹¤ìŒ ìˆœì„œë¡œ 2ê°€ì§€ë¥¼ ìƒì„±í•œë‹¤.
1. code + "." + object name
2. code

ì˜ˆ) ì˜¤ë¥˜ ì½”ë“œ: required, object name: item
1. required.item
2. required
```

#### í•„ë“œ ì˜¤ë¥˜
```text
í•„ë“œ ì˜¤ë¥˜ì˜ ê²½ìš° ë‹¤ìŒ ìˆœì„œë¡œ 4ê°€ì§€ ë©”ì‹œì§€ ì½”ë“œë¥¼ ìƒì„±í•œë‹¤.
1. code + "." + object name + "." + field
2. code + "." + field
3. code + "." + field type
4. code

ì˜ˆ) ì˜¤ë¥˜ ì½”ë“œ: typeMismatch, object name "user", field "age", field type: int
1. "typeMismatch.user.age"
2. "typeMismatch.age"
3. "typeMismatch.int"
4. "typeMismatch"
```

### ë™ì‘ ë°©ì‹
- `rejectValue()`, `reject()`ëŠ” ë‚´ë¶€ì—ì„œ `MessageCodesResolver`ë¥¼ ì‚¬ìš©í•œë‹¤. ì—¬ê¸°ì—ì„œ ë©”ì‹œì§€ ì½”ë“œë“¤ì„ ìƒì„±í•œë‹¤.
- `FieldError`, `ObjectError`ì˜ ìƒì„±ìë¥¼ ë³´ë©´, ì˜¤ë¥˜ ì½”ë“œë¥¼ í•˜ë‚˜ê°€ ì•„ë‹ˆë¼ ì—¬ëŸ¬ ì˜¤ë¥˜ ì½”ë“œë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤. `MessageCodesResolver`ë¥¼ í†µí•´ì„œ ìƒì„±ëœ ìˆœì„œëŒ€ë¡œ ì˜¤ë¥˜ ì½”ë“œë¥¼ ë³´ê´€í•œë‹¤.
- ì´ë¶€ë¶„ì„ `BindingResult`ì˜ ë¡œê·¸ë¥¼ í†µí•´ì„œ í™•ì¸í•˜ë©´ `codes [range.item.price, range.price, range.java.lang.Integer, range]`

### FiledError `rejectValue("itemName", "required")`
ë‹¤ìŒ 4ê°€ì§€ ì˜¤ë¥˜ ì½”ë“œë¥¼ ìë™ìœ¼ë¡œ ìƒì„±
- `required.item.itemName`
- `required.itemName`
- `required.java.lang.String`
- `required`

### ObjectError `reject("totalPriceMin")`
ë‹¤ìŒ 2ê°€ì§€ ì˜¤ë¥˜ ì½”ë“œë¥¼ ìë™ìœ¼ë¡œ ìƒì„±
- `totalPriceMin.item`
- `totalPriceMin`

### ì˜¤ë¥˜ ë©”ì‹œì§€ ì¶œë ¥
íƒ€ì„ë¦¬í”„ í™”ë©´ìœ¼ë¡œ ë Œë”ë§í•  ë•Œ `th:errors`ê°€ ì‹¤í–‰ëœë‹¤. ë§Œì•½ ì´ë•Œ ì˜¤ë¥˜ê°€ ìˆë‹¤ë©´ ìƒì„±ëœ ì˜¤ë¥˜ ë©”ì‹œì§€ ì½”ë“œë¥¼ ìˆœì„œëŒ€ë¡œ ëŒì•„ê°€ë©´ì„œ ë©”ì‹œì§€ë¥¼ ì°¾ëŠ”ë‹¤. ê·¸ë¦¬ê³  ì—†ìœ¼ë©´ ë””í´íŠ¸ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•œë‹¤.

## ì˜¤ë¥˜ ì½”ë“œì™€ ë©”ì‹œì§€ ì²˜ë¦¬ 5
### ì˜¤ë¥˜ ì½”ë“œ ê´€ë¦¬ ì „ëµ
#### í•µì‹¬ì€ êµ¬ì²´ì ì¸ ê²ƒì—ì„œ ëœ êµ¬ì²´ì ì¸ ê²ƒìœ¼ë¡œ
`MessageCodesResolver`ëŠ” `required.item.itemName`ì²˜ëŸ¼ êµ¬ì²´ì ì¸ ê²ƒì„ ë¨¼ì € ë§Œë“¤ì–´ì£¼ê³ , `required`ì²˜ëŸ¼ ëœ êµ¬ì²´ì ì¸ ê²ƒì„ ê°€ì¥ ë‚˜ì¤‘ì— ë§Œë“ ë‹¤.
ì´ë ‡ê²Œí•˜ë©´ ì•ì„œ ë§í•œ ê²ƒì²˜ëŸ¼ ë©”ì‹œì§€ì™€ ê´€ë ¨ëœ ê³µí†µ ì „ëµì„ í¸ë¦¬í•˜ê²Œ ë„ì…í•  ìˆ˜ ìˆë‹¤.

#### ì™œ ì´ë ‡ê²Œ ë³µì¡í•˜ê²Œ ì‚¬ìš©í•˜ëŠ”ê°€?
ëª¨ë“  ì˜¤ë¥˜ ì½”ë“œì— ëŒ€í•´ì„œ ë©”ì‹œì§€ë¥¼ ê°ê° ë‹¤ ì •ì˜í•˜ë©´ ê°œë°œì ì…ì¥ì—ì„œ ê´€ë¦¬í•˜ê¸° í˜ë“¤ë‹¤.  
í¬ê²Œ ì¤‘ìš”í•˜ì§€ ì•Šì€ ë©”ì‹œì§€ëŠ” ë²”ìš©ì„±ì´ ìˆëŠ” `required` ê°™ì€ ë©”ì‹œì§€ë¡œ ëë‚´ê³ , ì •ë§ ì¤‘ìš”í•œ ë©”ì‹œì§€ëŠ” ê¼­ í•„ìš”í•  ë•Œ êµ¬ì²´ì ìœ¼ë¡œ ì ì–´ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ íš¨ê³¼ì ì´ë‹¤.

### ì ìš©í•˜ê¸°
[errors.properties](src%2Fmain%2Fresources%2Ferrors.properties)
```properties
#==ObjectError==
#Level1
totalPriceMin.item=ìƒí’ˆì˜ ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ {0}ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤. í˜„ì¬ ê°’ = {1}

#Level2 - ìƒëµ
totalPriceMin=ì „ì²´ ê°€ê²©ì€ {0}ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤. í˜„ì¬ ê°’ = {1}

#==FieldError==
#Level1
required.item.itemName=ìƒí’ˆ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.
range.item.price=ê°€ê²©ì€ {0} ~ {1} ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤.
max.item.quantity=ìˆ˜ëŸ‰ì€ ìµœëŒ€ {0} ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤.

#Level2 - ìƒëµ

#Level3
required.java.lang.String = í•„ìˆ˜ ë¬¸ìì…ë‹ˆë‹¤.
required.java.lang.Integer = í•„ìˆ˜ ìˆ«ìì…ë‹ˆë‹¤.
min.java.lang.String = {0} ì´ìƒì˜ ë¬¸ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
min.java.lang.Integer = {0} ì´ìƒì˜ ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
range.java.lang.String = {0} ~ {1} ê¹Œì§€ì˜ ë¬¸ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
range.java.lang.Integer = {0} ~ {1} ê¹Œì§€ì˜ ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
max.java.lang.String = {0} ê¹Œì§€ì˜ ìˆ«ìë¥¼ í—ˆìš©í•©ë‹ˆë‹¤.
max.java.lang.Integer = {0} ê¹Œì§€ì˜ ìˆ«ìë¥¼ í—ˆìš©í•©ë‹ˆë‹¤.

#Level4
required = í•„ìˆ˜ ê°’ ì…ë‹ˆë‹¤.
min= {0} ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.
range= {0} ~ {1} ë²”ìœ„ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤.
max= {0} ê¹Œì§€ í—ˆìš©í•©ë‹ˆë‹¤.
```

í¬ê²Œ ê°ì²´ ì˜¤ë¥˜ì™€ í•„ë“œ ì˜¤ë¥˜ë¥¼ ë‚˜ëˆ„ì—ˆë‹¤. ê·¸ë¦¬ê³  ë²”ìš©ì„±ì— ë”°ë¼ ë ˆë¹Œì„ ë‚˜ëˆ„ì—ˆë‹¤.

`itemName`ì˜ ê²½ìš° `required` ê²€ì¦ ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ë°œìƒí•˜ë©´ ë‹¤ìŒ ì½”ë“œ ìˆœì„œëŒ€ë¡œ ë©”ì‹œì§€ê°€ ìƒì„±ëœë‹¤.
1. `required.item.itemName`
2. `required.itemName`
3. `required.java.lang.String`
4. `required`  

ê·¸ë¦¬ê³  ì´ë ‡ê²Œ ìƒì„±ëœ ë©”ì‹œì§€ ì½”ë“œë¥¼ ê¸°ë³¸ìœ¼ë¡œ ìˆœì„œëŒ€ë¡œ `MessageSource`ì˜ ë©”ì‹œì§€ì—ì„œ ì°¾ëŠ”ë‹¤.  
êµ¬ì²´ì ì¸ ê²ƒì—ì„œ ëœ êµ¬ì²´ì ì¸ ìˆœì„œëŒ€ë¡œ ì°¾ëŠ”ë‹¤. ë©”ì‹œì§€ì— 1ë²ˆì´ ì—†ìœ¼ë©´ 2ë²ˆì„ ì°¾ê³ , 2ë²ˆì´ ì—†ìœ¼ë©´ 3ë²ˆì„ ì°¾ëŠ”ë‹¤.  
ì´ë ‡ê²Œ ë˜ë©´ ë§Œì•½ì— í¬ê²Œ ì¢…ìš”í•˜ì§€ ì•Šì€ ì˜¤ë¥˜ ë©”ì‹œì§€ëŠ” ê¸°ì¡´ì— ì •ì˜ëœ ê²ƒì„ ì¬í™œìš©í•˜ë©´ ëœë‹¤.

### ValidationUtils
#### ValidationUtils ì‚¬ìš© ì „
```java
if (!StringUtils.hasText(item.getItemName())) {
    bindingResult.rejectValue("itemName", "required", "ê¸°ë³¸: ìƒí’ˆ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");    
}
```

#### ValidationUtils ì‚¬ìš© í›„
ë‹¤ìŒê³¼ ê°™ì´ í•œì¤„ë¡œ ê°€ëŠ¥í•˜ë‹¤. ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì€ `Empty`, ê³µë°± ê°™ì€ ë‹¨ìˆœí•œ ê¸°ëŠ¥ë§Œ ì œê³µí•œë‹¤.
```java
ValidationUtils.rejectIfEmptyOrWhitespace(bindingResult, "itemName", "required");
```

### ì •ë¦¬
1. `rejectValue()` í˜¸ì¶œ
2. `MessageCodesResolver`ë¥¼ ì‚¬ìš©í•´ì„œ ê²€ì¦ ì˜¤ë¥˜ ì½”ë“œë¡œ ë©”ì‹œì§€ ì½”ë“œë“¤ì„ ìƒì„±
3. `new FieldError()`ë¥¼ ìƒì„±í•˜ë©´ì„œ ë©”ì‹œì§€ ì½”ë“œë“¤ì„ ë³´ê´€
4. `th:errors`ì—ì„œ ë©”ì‹œì§€ ì½”ë“œë“¤ë¡œ ë©”ì‹œì§€ë¥¼ ìˆœì„œëŒ€ë¡œ ë©”ì‹œì§€ì—ì„œ ì°¾ê³  ë…¸ì¶œ ì‹œí‚¨ë‹¤.

## ì˜¤ë¥˜ ì½”ë“œì™€ ë©”ì‹œì§€ ì²˜ë¦¬ 6
### ìŠ¤í”„ë§ì´ ì§ì ‘ ë§Œë“  ì˜¤ë¥˜ ë©”ì‹œì§€ ì²˜ë¦¬
ê²€ì¦ ì˜¤ë¥˜ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ 2ê°€ì§€ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤.
- ê°œë°œìê°€ ì§ì ‘ ì„¤ì •í•œ ì˜¤ë¥˜ ì½”ë“œ: `rejectValue()`ë¥¼ ì§ì ‘ í˜¸ì¶œí•œë‹¤.
- ìŠ¤í”„ë§ì´ ì§ì ‘ ê²€ì¦ ì˜¤ë¥˜ì— ì¶”ê°€í•œ ê²½ìš°(ì£¼ë¡œ íƒ€ì… ì •ë³´ê°€ ë§ì§€ ì•Šì„ ê²½ìš°)

### í™•ì¸í•˜ê¸°
1. ìƒí’ˆ ë“±ë¡ í˜ì´ì§€ì—ì„œ `price`í•„ë“œì— ë¬¸ìë¥¼ ì…ë ¥í•œë‹¤. (ex: "A")
2. ë¡œê·¸ë¥¼ í™•ì¸í•˜ë©´ `BindingResult`ì— `FieldError`ê°€ ë‹´ê²¨ìˆê³ , ë‹¤ìŒê³¼ ê°™ì€ ë©”ì‹œì§€ ì½”ë“œë“¤ì´ ìƒì„±ëœë‹¤.  
   ```text
    codes[typeMismatch.item.price,typeMismatch.price,typeMismatch.java.lang.Integer,typeMismatch]
   ```
3. ë‹¤ìŒê³¼ ê°™ì´ 4ê°€ì§€ ë©”ì‹œì§€ ì½”ë“œê°€ ì…ë ¥ë˜ì–´ ìˆë‹¤.
   - `typeMismatch.item.price`
   - `typeMismatch.price`
   - `typeMismatch.java.lang.Integer`
   - `typeMismatch`

ì´ë ‡ê²Œ ìŠ¤í”„ë§ì€ íƒ€ì… ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ `typeMismatch`ë¼ëŠ” ì˜¤ë¥˜ ì½”ë“œë¥¼ ì‚¬ìš©í•œë‹¤. ì´ ì˜¤ë¥˜ ì½”ë“œê°€ `MessageCodesResolver`ë¥¼ í†µí•˜ë©´ì„œ 4ê°€ì§€ ë©”ì‹œì§€ ì½”ë“œê°€ ìƒì„±ëœ ê²ƒì´ë‹¤.

## Validator ë¶„ë¦¬
**ğŸ”‘ ëª©í‘œ: ë³µì¡í•œ ê²€ì¦ ë¡œì§ì„ ë³„ë„ë¡œ ë¶„ë¦¬í•˜ì!**

ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ê²€ì¦ ë¡œì§ì´ ì°¨ì§€í•˜ëŠ” ë¶€ë¶„ì€ ë§¤ìš° í¬ë‹¤. ì´ëŸ° ê²½ìš° ë³„ë„ì˜ í´ë˜ìŠ¤ë¡œ ì—­í• ì„ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

### `ItemValidator` ë§Œë“¤ê¸°
```java
public class ItemValidator implements Validator {
    
    @Override
    public boolean supports(Class<?> aClass) {
        return Item.class.isAssignableFrom(aClass);
    }

    @Override
    public void validate(Object target, Errors errors) {
        Item item = (Item) target;

        ValidationUtils.rejectIfEmptyOrWhitespace(errors, "itemName", "required");

        if (item.getPrice() == null || item.getPrice() < 1_000 || item.getPrice() > 1_000_000) {
            errors.rejectValue("price", "range", new Object[]{1_000, 1_000_000}, null);
        }

        if (item.getQuantity() == null || item.getQuantity() > 10_000) {
            errors.rejectValue("quantity", "max", new Object[]{9_999}, null);
        }
        
        // íŠ¹ì • í•„ë“œ ì˜ˆì™¸ê°€ ì•„ë‹Œ ì „ì²´ ì˜ˆì™¸
        if (item.getPrice() != null && item.getQuantity() != null) {
            int resultPrice = item.getPrice() * item.getQuantity();

            if (resultPrice < 10_000) {
                errors.reject("totalPriceMin", new Object[]{10_000, resultPrice}, null);
            }
        }
    }
}
```

ìŠ¤í”„ë§ì€ ê²€ì¦ì„ ì²´ê³„ì ìœ¼ë¡œ ì œê³µí•˜ê¸° ìœ„í•´ ë‹¤ìŒ ì¸í„° í˜ì´ìŠ¤ë¥¼ ì œê³µí•œë‹¤.
```java
public interface Validator {
    boolean supports(Class<?> aClass);

    void validate(Obejct target, Errors errors);
}
```
- `supports() {}`: í•´ë‹¹ ê²€ì¦ê¸°ë¥¼ ì§€ì›í•˜ëŠ” ì—¬ë¶€ í™•ì¸(ë’¤ì—ì„œ ì„¤ëª…)
- `validate(Obejct target, Errors errors`: ê²€ì¦ ëŒ€ìƒ ê°ì²´ì™€ `BindingResult`

### ItemValidator ì§ì ‘ í˜¸ì¶œí•˜ê¸°
```java
public class ValidationItemController {

    private final ItemValidator itemValidator;
    
    ...

    @PostMapping("/add")
    public String addItem(@ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes) {
        itemValidator.validate(item, bindingResult);

        //ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
        if (bindingResult.hasErrors()) {
            log.info("errors={} ", bindingResult);
            return "validation/v2/addForm";
        }

        //ì„±ê³µ ë¡œì§
        Item savedItem = itemRepository.save(item);
        redirectAttributes.addAttribute("itemId", savedItem.getId());
        redirectAttributes.addAttribute("status", true);
        return "redirect:/validation/v2/items/{itemId}";
    }
}
```

### ì‹¤í–‰
ì‹¤í–‰í•´ë³´ë©´ ê¸°ì¡´ê³¼ ì™„ì „íˆ ë™ì¼í•˜ê²Œ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ê²€ì¦ê³¼ ê´€ë ¨ëœ ë¶€ë¶„ì´ ê¹”ë”í•˜ê²Œ ë¶„ë¦¬ë˜ì—ˆë‹¤.